

==================================================
FILE: ./backend/export_code.py
==================================================

import os

# Files to ignore
IGNORE_DIRS = {'venv', '__pycache__', '.git', 'migrations'}
# Extensions to include
INCLUDE_EXT = {'.py', '.html', '.css', '.js'}

output_file = 'full_project_code.txt'

with open(output_file, 'w', encoding='utf-8') as outfile:
    for root, dirs, files in os.walk("."):
        # Filter out ignored directories
        dirs[:] = [d for d in dirs if d not in IGNORE_DIRS]
        
        for file in files:
            if any(file.endswith(ext) for ext in INCLUDE_EXT):
                file_path = os.path.join(root, file)
                outfile.write(f"\n\n{'='*50}\n")
                outfile.write(f"FILE: {file_path}\n")
                outfile.write(f"{'='*50}\n\n")
                
                try:
                    with open(file_path, 'r', encoding='utf-8') as infile:
                        outfile.write(infile.read())
                except Exception as e:
                    outfile.write(f"Could not read file: {e}")

print(f"Done! All code saved to {output_file}")

==================================================
FILE: ./backend/manage.py
==================================================

#!/usr/bin/env python
"""Django's command-line utility for administrative tasks."""
import os
import sys


def main():
    """Run administrative tasks."""
    os.environ.setdefault('DJANGO_SETTINGS_MODULE', 'ems_core.settings')
    try:
        from django.core.management import execute_from_command_line
    except ImportError as exc:
        raise ImportError(
            "Couldn't import Django. Are you sure it's installed and "
            "available on your PYTHONPATH environment variable? Did you "
            "forget to activate a virtual environment?"
        ) from exc
    execute_from_command_line(sys.argv)


if __name__ == '__main__':
    main()


==================================================
FILE: ./backend/customers/models.py
==================================================

from django.db import models


class Customer(models.Model):
    customer_id = models.AutoField(primary_key=True)
    # Keep single name column per ERD, but we will build it from first+last in forms
    name = models.CharField(max_length=150)
    email = models.EmailField(max_length=254, unique=True)
    phone = models.CharField(max_length=50, blank=True, null=True)

    # New fields per professor requirement
    dob = models.DateField(null=True, blank=True)
    address = models.CharField(max_length=255, null=True, blank=True)   # street
    city = models.CharField(max_length=100, null=True, blank=True)
    state = models.CharField(max_length=100, null=True, blank=True)
    zipcode = models.CharField(max_length=20, null=True, blank=True)
    country = models.CharField(max_length=100, null=True, blank=True)

    class Meta:
        db_table = "CUSTOMER"

    def __str__(self):
        return f"{self.name} ({self.email})"


==================================================
FILE: ./backend/customers/__init__.py
==================================================



==================================================
FILE: ./backend/customers/apps.py
==================================================

from django.apps import AppConfig


class CustomersConfig(AppConfig):
    default_auto_field = 'django.db.models.BigAutoField'
    name = 'customers'


==================================================
FILE: ./backend/customers/forms.py
==================================================

# backend/customers/forms.py

from django import forms
from .models import Customer


class AdminCustomerForm(forms.ModelForm):
    """
    Admin-facing form to manage customers from the custom admin portal.
    We keep a single 'name' field (matches ERD) plus the new profile fields.
    """

    class Meta:
        model = Customer
        fields = [
            "name",
            "email",
            "phone",
            "dob",
            "address",
            "city",
            "state",
            "zipcode",
            "country",
        ]
        widgets = {
            "name": forms.TextInput(
                attrs={"class": "form-control", "placeholder": "Full name"}
            ),
            "email": forms.EmailInput(
                attrs={"class": "form-control", "placeholder": "name@example.com"}
            ),
            "phone": forms.TextInput(
                attrs={"class": "form-control", "placeholder": "Optional phone"}
            ),
            "dob": forms.DateInput(
                attrs={"class": "form-control", "type": "date"}
            ),
            "address": forms.TextInput(
                attrs={"class": "form-control", "placeholder": "Street address"}
            ),
            "city": forms.TextInput(
                attrs={"class": "form-control", "placeholder": "City"}
            ),
            "state": forms.TextInput(
                attrs={"class": "form-control", "placeholder": "State"}
            ),
            "zipcode": forms.TextInput(
                attrs={"class": "form-control", "placeholder": "ZIP / Postal code"}
            ),
            "country": forms.TextInput(
                attrs={"class": "form-control", "placeholder": "Country"}
            ),
        }


==================================================
FILE: ./backend/customers/admin.py
==================================================

from django.contrib import admin
from .models import Customer


@admin.register(Customer)
class CustomerAdmin(admin.ModelAdmin):
    list_display = ("customer_id", "name", "email", "phone")
    search_fields = ("name", "email")

==================================================
FILE: ./backend/customers/tests.py
==================================================

from django.test import TestCase

# Create your tests here.


==================================================
FILE: ./backend/customers/views.py
==================================================

from django.shortcuts import render

# Create your views here.


==================================================
FILE: ./backend/bookings/models.py
==================================================

from django.db import models
from django.core.validators import MinValueValidator, MaxValueValidator

from customers.models import Customer
from events.models import Event

#Booking Table
class Booking(models.Model):
    STATUS_CHOICES = [
        ("PENDING", "Pending"),
        ("APPROVED", "Approved"),
        ("CANCELLED", "Cancelled"),
    ]

    booking_id = models.AutoField(primary_key=True)
    event = models.ForeignKey(Event, on_delete=models.CASCADE)
    customer = models.ForeignKey(Customer, on_delete=models.CASCADE)
    ticket_qty = models.IntegerField(validators=[MinValueValidator(1)])
    unit_price = models.DecimalField(max_digits=10, decimal_places=2, default=0)
    total_price = models.DecimalField(max_digits=10, decimal_places=2, default=0)
    status = models.CharField(max_length=50, choices=STATUS_CHOICES, default="PENDING")
    booked_at = models.DateTimeField(auto_now_add=True)

    class Meta:
        db_table = "BOOKING"

    def __str__(self):
        return f"Booking #{self.booking_id} for {self.event}"


#Payment Table


class Payment(models.Model):
    """
    Payment details for BOOKINGS.

    Per your updated requirements, payment for ticketed events is done only via
    credit or debit card. We drop the old CASH/CARD/ONLINE values and keep:
    - CREDIT
    - DEBIT
    """

    METHOD_CHOICES = [
        ("CREDIT", "Credit card"),
        ("DEBIT", "Debit card"),
    ]

    payment_id = models.AutoField(primary_key=True)
    booking = models.ForeignKey(Booking, on_delete=models.CASCADE)
    customer = models.ForeignKey(Customer, on_delete=models.CASCADE)
    amount = models.DecimalField(
        max_digits=10,
        decimal_places=2,
        validators=[MinValueValidator(0)],
    )
    method = models.CharField(
        max_length=20,
        choices=METHOD_CHOICES,
    )
    # e.g. "Visa •••• 4242 | Day: 2025-12-20"
    card_details = models.CharField(max_length=100, null=True, blank=True)
    paid_at = models.DateTimeField(auto_now_add=True)

    class Meta:
        db_table = "PAYMENT"

    def __str__(self):
        return f"Payment #{self.payment_id} - {self.get_method_display()} - ${self.amount}"




==================================================
FILE: ./backend/bookings/__init__.py
==================================================



==================================================
FILE: ./backend/bookings/apps.py
==================================================

from django.apps import AppConfig


class BookingsConfig(AppConfig):
    default_auto_field = 'django.db.models.BigAutoField'
    name = 'bookings'


==================================================
FILE: ./backend/bookings/forms.py
==================================================

# backend/bookings/forms.py

from django import forms
from .models import Booking, Payment


# ---------- Public booking forms (participants) -----------------------------

class BaseBookingForm(forms.Form):
    name = forms.CharField(max_length=120, label="First and last name")
    email = forms.EmailField(max_length=150, label="Email")
    phone = forms.CharField(max_length=20, label="Phone (optional)", required=False)
    ticket_qty = forms.IntegerField(min_value=1, max_value=10, label="Number of tickets")


class ConferenceBookingForm(BaseBookingForm):
    """
    Free conference booking, capacity-limited, no payment.
    """
    pass


class PaidBookingForm(BaseBookingForm):
    """
    Paid events (Concert / Sports):
    - Ticketed events must be paid by credit/debit.
    - For multi-day concerts we will also show a session_date field
      whose choices are injected from the view.
    """

    PAYMENT_METHOD_CHOICES = [
        ("CREDIT", "Credit card"),
        ("DEBIT", "Debit card"),
    ]

    method = forms.ChoiceField(
        choices=PAYMENT_METHOD_CHOICES,
        label="Payment method",
    )

    card_details = forms.CharField(
        max_length=100,
        required=False,
        label="Card details",
        help_text="e.g., 'Visa •••• 4242'",
    )

    # Used only for multi-day concerts; choices are set in the view.
    session_date = forms.ChoiceField(
        required=False,
        choices=[],
        label="Which day will you attend?",
    )

    def clean(self):
        cleaned = super().clean()
        method = cleaned.get("method")
        card_details = cleaned.get("card_details")

        # Require card details whenever a card method is chosen
        if method in ("CREDIT", "DEBIT") and not card_details:
            self.add_error("card_details", "Please enter card details for card payments.")
        return cleaned


# ---------- Admin ModelForms (custom admin portal) -------------------------

class AdminBookingForm(forms.ModelForm):
    """
    Admin CRUD over BOOKING rows.
    Admin can adjust ticket quantity, prices and status.
    """

    class Meta:
        model = Booking
        fields = [
            "event",
            "customer",
            "ticket_qty",
            "unit_price",
            "total_price",
            "status",
        ]
        widgets = {
            "event": forms.Select(attrs={"class": "form-select"}),
            "customer": forms.Select(attrs={"class": "form-select"}),
            "ticket_qty": forms.NumberInput(attrs={"class": "form-control", "min": 1}),
            "unit_price": forms.NumberInput(
                attrs={"class": "form-control", "step": "0.01", "min": 0}
            ),
            "total_price": forms.NumberInput(
                attrs={"class": "form-control", "step": "0.01", "min": 0}
            ),
            "status": forms.Select(attrs={"class": "form-select"}),
            "booked_at": forms.DateTimeInput(
                attrs={"class": "form-control", "type": "datetime-local"}
            ),
        }


class AdminPaymentForm(forms.ModelForm):
    """
    Admin CRUD over PAYMENT rows.
    """

    class Meta:
        model = Payment
        fields = [
            "booking",
            "customer",
            "amount",
            "method",
            "card_details",
        ]
        widgets = {
            "booking": forms.Select(attrs={"class": "form-select"}),
            "customer": forms.Select(attrs={"class": "form-select"}),
            "amount": forms.NumberInput(
                attrs={"class": "form-control", "step": "0.01", "min": 0}
            ),
            "method": forms.Select(attrs={"class": "form-select"}),
            "card_details": forms.TextInput(
                attrs={"class": "form-control", "placeholder": "Masked card (optional)"}
            ),
            "paid_at": forms.DateTimeInput(
                attrs={"class": "form-control", "type": "datetime-local"}
            ),
        }


==================================================
FILE: ./backend/bookings/admin.py
==================================================

from django.contrib import admin
from .models import Booking, Payment


@admin.register(Booking)
class BookingAdmin(admin.ModelAdmin):
    list_display = (
        "booking_id",
        "event",
        "customer",
        "ticket_qty",
        "unit_price",
        "total_price",
        "status",
        "booked_at",
    )
    # Remove event__venue__type – that field no longer exists
    list_filter = ("status",)
    search_fields = ("event__title", "customer__name", "customer__email")


@admin.register(Payment)
class PaymentAdmin(admin.ModelAdmin):
    list_display = (
        "payment_id",
        "booking",
        "customer",
        "amount",
        "method",
        "paid_at",
    )
    list_filter = ("method",)
    search_fields = ("customer__name", "customer__email", "booking__event__title")


==================================================
FILE: ./backend/bookings/tests.py
==================================================

from django.test import TestCase

# Create your tests here.


==================================================
FILE: ./backend/bookings/urls.py
==================================================

from django.urls import path
from . import views

app_name = "bookings"

urlpatterns = [
    path("book/<int:event_id>/", views.book_event, name="book_event"),
    path("organizer/", views.organizer_bookings, name="organizer_bookings"),
    path(
        "organizer/event/<int:event_id>/",
        views.organizer_event_bookings,
        name="organizer_event_bookings",
    ),
    path("my/", views.my_bookings, name="my_bookings"),
    path("<int:booking_id>/receipt/", views.booking_receipt, name="booking_receipt"),
    path("<int:booking_id>/cancel/", views.cancel_booking, name="cancel_booking"),
]


==================================================
FILE: ./backend/bookings/views.py
==================================================

# backend/bookings/views.py

from decimal import Decimal
from datetime import timedelta

from django.db.models import Sum
from django.shortcuts import get_object_or_404, redirect, render
from django.utils import timezone
from django.contrib import messages
from django.contrib.auth.decorators import login_required

from .models import Booking, Payment
from .forms import ConferenceBookingForm, PaidBookingForm
from customers.models import Customer
from events.models import Event
from accounts.models import UserProfile
from django.db.models import Sum


@login_required
def book_event(request, event_id):
    """
    Booking flow for an event, driven by Event.event_type:

    - EXHIBITION:
        * announcement only, NO booking allowed.

    - CONFERENCE:
        * free booking, capacity-limited
        * no payment
        * exactly one ticket per customer per event

    - CONCERT / SPORTS:
        * paid booking
        * capacity-limited
        * payment by credit/debit card only
        * for multi-day concerts, user must select which day they attend
    """
    event = get_object_or_404(Event.objects.select_related("venue"), pk=event_id)
    event_type_code = event.event_type  # EXHIBITION / CONFERENCE / CONCERT / SPORTS
    event_type_label = event.get_event_type_display()

    # EXHIBITION: no booking allowed
    if event_type_code == "EXHIBITION":
        messages.error(
            request,
            "This exhibition is for announcement only and does not require bookings.",
        )
        return redirect("events:event_detail", event_id=event.event_id)

    # Determine form class and whether it's a paid event
    if event_type_code == "CONFERENCE":
        FormClass = ConferenceBookingForm
        is_paid_event = False
    else:
        # CONCERT or SPORTS => paid events
        FormClass = PaidBookingForm
        is_paid_event = event_type_code in ("CONCERT", "SPORTS")

    # Capacity calculation based on non-cancelled bookings
    booked_qty = (
        Booking.objects.filter(
            event=event,
            status__in=["PENDING", "APPROVED"],
        ).aggregate(total=Sum("ticket_qty"))["total"]
        or 0
    )
    remaining_capacity = None
    if event.capacity is not None:
        remaining_capacity = event.capacity - booked_qty

    # Multi-day Concert detection (booking by day)
    start_date = event.start_time.date()
    end_date = event.end_time.date()
    is_multi_day_concert = (
        event_type_code == "CONCERT"
        and end_date > start_date
    )

    def _apply_concert_date_choices(form_instance):
        """
        For multi-day concerts, populate the session_date choices and mark as required.
        Safe even if the field is missing.
        """
        if not isinstance(form_instance, PaidBookingForm):
            return

        # If the form doesn't have session_date for some reason, just exit.
        if "session_date" not in form_instance.fields:
            return

        if not is_multi_day_concert:
            # If not multi-day, remove the field from the form entirely
            form_instance.fields.pop("session_date", None)
            return

        # Build list of day options between start and end (inclusive)
        days = []
        current = start_date
        while current <= end_date:
            days.append(current)
            current = current + timedelta(days=1)

        choices = [
            (d.isoformat(), d.strftime("%b %d, %Y"))
            for d in days
        ]
        form_instance.fields["session_date"].choices = choices
        form_instance.fields["session_date"].required = True

    # ------------- HANDLE POST & GET ----------------------------------------
    if request.method == "POST":
        form = FormClass(request.POST)

        # Conferences: lock ticket_qty to 1 (logical + visual)
        if event_type_code == "CONFERENCE" and "ticket_qty" in form.fields:
            form.fields["ticket_qty"].initial = 1
            form.fields["ticket_qty"].widget.attrs["readonly"] = True

        _apply_concert_date_choices(form)

        if form.is_valid():
            name = form.cleaned_data["name"]
            form_email = form.cleaned_data["email"]
            user_email = request.user.email or form_email
            email = user_email
            phone = form.cleaned_data.get("phone") or ""

            # Conference: force ticket_qty = 1
            if event_type_code == "CONFERENCE":
                ticket_qty = 1
            else:
                ticket_qty = form.cleaned_data["ticket_qty"]

            # Capacity check
            if remaining_capacity is not None and ticket_qty > remaining_capacity:
                form.add_error(
                    "ticket_qty",
                    f"Only {remaining_capacity} tickets remaining. Please choose a smaller quantity.",
                )
            else:
                # Get or create customer
                customer, _ = Customer.objects.get_or_create(
                    email=email,
                    defaults={"name": name, "phone": phone},
                )
                # Keep customer name/phone reasonably in sync
                if customer.name != name or (phone and customer.phone != phone):
                    customer.name = name
                    if phone:
                        customer.phone = phone
                    customer.save()

                # Conference: one booking per customer per event
                if event_type_code == "CONFERENCE":
                    existing = Booking.objects.filter(
                        event=event,
                        customer=customer,
                        status__in=["PENDING", "APPROVED"],
                    ).exists()
                    if existing:
                        form.add_error(
                            None,
                            "You already have a reservation for this conference."
                        )
                        return render(
                            request,
                            "bookings/book_event.html",
                            {
                                "form": form,
                                "event": event,
                                "event_type": event_type_label,
                                "remaining_capacity": remaining_capacity,
                                "is_paid_event": is_paid_event,
                            },
                        )

                # ----- PRICE LOGIC -----
                if is_paid_event:
                    if event.ticket_price is None or event.ticket_price <= 0:
                        form.add_error(
                            None,
                            "This event does not have a valid ticket price set by the organizer.",
                        )
                        return render(
                            request,
                            "bookings/book_event.html",
                            {
                                "form": form,
                                "event": event,
                                "event_type": event_type_label,
                                "remaining_capacity": remaining_capacity,
                                "is_paid_event": is_paid_event,
                            },
                        )
                    unit_price = event.ticket_price
                    total_price = unit_price * Decimal(ticket_qty)
                else:
                    unit_price = Decimal("0.00")
                    total_price = Decimal("0.00")
                # ----- END PRICE LOGIC -----

                # Create booking
                booking = Booking.objects.create(
                    event=event,
                    customer=customer,
                    ticket_qty=ticket_qty,
                    unit_price=unit_price,
                    total_price=total_price,
                    status="APPROVED",
                    booked_at=timezone.now(),
                )

                # Payment record only for paid events
                if is_paid_event:
                    method = form.cleaned_data["method"]          # "CREDIT" or "DEBIT"
                    card_details = form.cleaned_data.get("card_details") or ""

                    # Multi-day concert: ensure session_date is chosen and append to card_details
                    if is_multi_day_concert and "session_date" in form.cleaned_data:
                        session_date_str = form.cleaned_data.get("session_date")
                        if not session_date_str:
                            form.add_error(
                                "session_date",
                                "Please select the day you will attend."
                            )
                            return render(
                                request,
                                "bookings/book_event.html",
                                {
                                    "form": form,
                                    "event": event,
                                    "event_type": event_type_label,
                                    "remaining_capacity": remaining_capacity,
                                    "is_paid_event": is_paid_event,
                                },
                            )

                        if card_details:
                            card_details = f"{card_details} | Day: {session_date_str}"
                        else:
                            card_details = f"Day: {session_date_str}"

                    Payment.objects.create(
                        booking=booking,
                        customer=customer,
                        amount=total_price,
                        method=method,
                        card_details=card_details,
                        paid_at=timezone.now(),
                    )

                messages.success(
                    request,
                    f"Booking successful for {event.title}! "
                    f"Tickets: {ticket_qty}, Total: ${total_price}",
                )
                return redirect(
                    "bookings:booking_receipt",
                    booking_id=booking.booking_id,
                )

    else:
        # GET
        form = FormClass()
        if event_type_code == "CONFERENCE" and "ticket_qty" in form.fields:
            form.fields["ticket_qty"].initial = 1
            form.fields["ticket_qty"].widget.attrs["readonly"] = True

        _apply_concert_date_choices(form)

    context = {
        "event": event,
        "event_type": event_type_label,
        "form": form,
        "remaining_capacity": remaining_capacity,
        "is_paid_event": is_paid_event,
    }
    return render(request, "bookings/book_event.html", context)


@login_required
def organizer_bookings(request):
    """
    Show all bookings for events that belong to the logged-in organizer.
    """
    profile, _ = UserProfile.objects.get_or_create(user=request.user)

    if not profile.organizer:
        messages.error(request, "Only organizers can view bookings for events.")
        return redirect("accounts:become_organizer")

    bookings = (
        Booking.objects.filter(event__organizer=profile.organizer)
        .select_related("event", "customer")
        .order_by("-booked_at")
    )

    return render(
        request,
        "bookings/organizer_bookings.html",
        {"bookings": bookings, "selected_event": None},
    )


@login_required
def organizer_event_bookings(request, event_id):
    """
    Show bookings only for a specific event that belongs to the logged-in organizer.
    """
    profile, _ = UserProfile.objects.get_or_create(user=request.user)

    if not profile.organizer:
        messages.error(request, "Only organizers can view bookings for events.")
        return redirect("accounts:become_organizer")

    event = get_object_or_404(Event, pk=event_id)

    if event.organizer != profile.organizer:
        messages.error(request, "You do not have permission to view bookings for this event.")
        return redirect("bookings:organizer_bookings")

    bookings = (
        Booking.objects.filter(event=event)
        .select_related("customer")
        .order_by("-booked_at")
    )

    return render(
        request,
        "bookings/organizer_bookings.html",
        {"bookings": bookings, "selected_event": event},
    )


@login_required
def my_bookings(request):
    """
    List bookings made by the currently logged-in user as a participant.

    We link user -> booking via Customer.email == request.user.email.
    """
    email = request.user.email
    bookings = (
        Booking.objects.filter(customer__email=email)
        .select_related("event", "customer")
        .order_by("-booked_at")
    )
    
    total_bookings = bookings.count()
    total_spent = (
        bookings.aggregate(total=Sum("total_price"))["total"] or Decimal("0.00")
    )


    return render(
        request,
        "bookings/my_bookings.html",
        {
            "bookings": bookings,
            "now": timezone.now(),  # for cancel button conditions in template
            "total_bookings": total_bookings,
            "total_spent": total_spent,
        },
    )


@login_required
def booking_receipt(request, booking_id):
    """
    Simple receipt view for one booking – can be printed by the user.
    """
    booking = get_object_or_404(
        Booking.objects.select_related("event", "customer"),
        pk=booking_id,
    )
    payment = (
        Payment.objects.filter(booking=booking)
        .order_by("-paid_at")
        .first()
    )

    return render(
        request,
        "bookings/booking_receipt.html",
        {"booking": booking, "payment": payment},
    )


@login_required
def cancel_booking(request, booking_id):
    """
    Allow a participant to cancel their own upcoming booking.
    """
    booking = get_object_or_404(
        Booking.objects.select_related("event", "customer"),
        pk=booking_id,
        customer__email=request.user.email,  # ensure they own this booking
    )

    # Prevent canceling events that already happened
    if booking.event.start_time <= timezone.now():
        messages.error(request, "You cannot cancel a booking for an event that has already happened.")
        return redirect("bookings:my_bookings")

    if request.method == "POST":
        booking.status = "CANCELLED"
        booking.save()

        messages.success(
            request,
            f"Your booking for '{booking.event.title}' has been cancelled."
        )
        return redirect("bookings:my_bookings")

    return render(
        request,
        "bookings/booking_cancel_confirm.html",
        {"booking": booking},
    )


==================================================
FILE: ./backend/ems_core/asgi.py
==================================================

"""
ASGI config for ems_core project.

It exposes the ASGI callable as a module-level variable named ``application``.

For more information on this file, see
https://docs.djangoproject.com/en/4.2/howto/deployment/asgi/
"""

import os

from django.core.asgi import get_asgi_application

os.environ.setdefault('DJANGO_SETTINGS_MODULE', 'ems_core.settings')

application = get_asgi_application()


==================================================
FILE: ./backend/ems_core/__init__.py
==================================================



==================================================
FILE: ./backend/ems_core/settings.py
==================================================

"""
Django settings for ems_core project.

Generated by 'django-admin startproject' using Django 4.2.26.

For more information on this file, see
https://docs.djangoproject.com/en/4.2/topics/settings/

For the full list of settings and their values, see
https://docs.djangoproject.com/en/4.2/ref/settings/
"""

from pathlib import Path

# Build paths inside the project like this: BASE_DIR / 'subdir'.
BASE_DIR = Path(__file__).resolve().parent.parent


# Quick-start development settings - unsuitable for production
# See https://docs.djangoproject.com/en/4.2/howto/deployment/checklist/

# SECURITY WARNING: keep the secret key used in production secret!
SECRET_KEY = 'django-insecure-r*bw%x#i5!g7h85g37i!k=+ni4u^!==ih$h4+uq#e65x!ola#d'

# SECURITY WARNING: don't run with debug turned on in production!
DEBUG = True

ALLOWED_HOSTS = []


# Application definition

INSTALLED_APPS = [
    'django.contrib.admin',
    'django.contrib.auth',
    'django.contrib.contenttypes',
    'django.contrib.sessions',
    'django.contrib.messages',
    'django.contrib.staticfiles',
    
    # Our EMS apps
    "accounts",
    "customers",
    "events",
    "bookings",
    "ai"
]

MIDDLEWARE = [
    'django.middleware.security.SecurityMiddleware',
    'django.contrib.sessions.middleware.SessionMiddleware',
    'django.middleware.common.CommonMiddleware',
    'django.middleware.csrf.CsrfViewMiddleware',
    'django.contrib.auth.middleware.AuthenticationMiddleware',
    'django.contrib.messages.middleware.MessageMiddleware',
    'django.middleware.clickjacking.XFrameOptionsMiddleware',
]

ROOT_URLCONF = 'ems_core.urls'

TEMPLATES = [
    {
        'BACKEND': 'django.template.backends.django.DjangoTemplates',
        'DIRS': [BASE_DIR / "templates"],
        'APP_DIRS': True,
        'OPTIONS': {
            'context_processors': [
                'django.template.context_processors.debug',
                'django.template.context_processors.request',
                'django.contrib.auth.context_processors.auth',
                'django.contrib.messages.context_processors.messages',
            ],
        },
    },
]

WSGI_APPLICATION = 'ems_core.wsgi.application'


# Database
# https://docs.djangoproject.com/en/4.2/ref/settings/#databases

DATABASES = {
    'default': {
        'ENGINE': 'django.db.backends.sqlite3',
        'NAME': BASE_DIR / 'db.sqlite3',
    }
}


# Password validation
# https://docs.djangoproject.com/en/4.2/ref/settings/#auth-password-validators

AUTH_PASSWORD_VALIDATORS = [
    {
        'NAME': 'django.contrib.auth.password_validation.UserAttributeSimilarityValidator',
    },
    {
        'NAME': 'django.contrib.auth.password_validation.MinimumLengthValidator',
    },
    {
        'NAME': 'django.contrib.auth.password_validation.CommonPasswordValidator',
    },
    {
        'NAME': 'django.contrib.auth.password_validation.NumericPasswordValidator',
    },
]


# Internationalization
# https://docs.djangoproject.com/en/4.2/topics/i18n/

LANGUAGE_CODE = 'en-us'

TIME_ZONE = 'America/Chicago'

USE_I18N = True

USE_TZ = True


# Static files (CSS, JavaScript, Images)
# https://docs.djangoproject.com/en/4.2/howto/static-files/

STATIC_URL = 'static/'

LOGIN_URL = "login"
LOGIN_REDIRECT_URL = "home"
LOGOUT_REDIRECT_URL = "home"


# Default primary key field type
# https://docs.djangoproject.com/en/4.2/ref/settings/#default-auto-field

DEFAULT_AUTO_FIELD = 'django.db.models.BigAutoField'



# ------- Email for password reset (development) -------

EMAIL_BACKEND = "django.core.mail.backends.console.EmailBackend"
DEFAULT_FROM_EMAIL = "no-reply@ems.local"



==================================================
FILE: ./backend/ems_core/urls.py
==================================================

# backend/ems_core/urls.py

from django.urls import path, include
from django.views.generic import RedirectView
from django.contrib.auth import views as auth_views

from . import views  # home + chat views
from accounts import views as accounts_views  # register + custom admin views

urlpatterns = [
    # ─── Custom Admin Portal (no Django admin.site) ────────────────────────
    # /admin/ will just redirect to the admin login (or you can change it later)
    path("admin/", RedirectView.as_view(pattern_name="admin_login", permanent=False)),
    path("admin/login/", accounts_views.admin_login, name="admin_login"),
    path("admin/logout/", accounts_views.admin_logout, name="admin_logout"),
    path("admin/dashboard/", accounts_views.admin_dashboard, name="admin_dashboard"),
    
    path("admin/organizers/", accounts_views.admin_organizer_list, name="admin_organizers"),
    path(
        "admin/organizers/<int:organizer_id>/approve/",
        accounts_views.admin_organizer_approve,
        name="admin_organizer_approve",
    ),
    path(
        "admin/organizers/<int:organizer_id>/reject/",
        accounts_views.admin_organizer_reject,
        name="admin_organizer_reject",
    ),
    # Admin: events
    path("admin/events/", accounts_views.admin_event_list, name="admin_events"),
    path("admin/events/new/", accounts_views.admin_event_create, name="admin_event_create"),
    path("admin/events/<int:event_id>/edit/", accounts_views.admin_event_edit, name="admin_event_edit"),
    path("admin/events/<int:event_id>/delete/", accounts_views.admin_event_delete, name="admin_event_delete"),

    # Admin: venues
    path("admin/venues/", accounts_views.admin_venue_list, name="admin_venues"),
    path("admin/venues/new/", accounts_views.admin_venue_create, name="admin_venue_create"),
    path("admin/venues/<int:venue_id>/edit/", accounts_views.admin_venue_edit, name="admin_venue_edit"),
    path("admin/venues/<int:venue_id>/delete/", accounts_views.admin_venue_delete, name="admin_venue_delete"),
    # Admin: customers
    path("admin/customers/", accounts_views.admin_customer_list, name="admin_customers"),
    path("admin/customers/new/", accounts_views.admin_customer_create, name="admin_customer_create"),
    path("admin/customers/<int:customer_id>/edit/", accounts_views.admin_customer_edit, name="admin_customer_edit"),
    path("admin/customers/<int:customer_id>/delete/", accounts_views.admin_customer_delete, name="admin_customer_delete"),
    # Admin: bookings
    path("admin/bookings/", accounts_views.admin_booking_list, name="admin_bookings"),
    path("admin/bookings/new/", accounts_views.admin_booking_create, name="admin_booking_create"),
    path("admin/bookings/<int:booking_id>/edit/", accounts_views.admin_booking_edit, name="admin_booking_edit"),
    path("admin/bookings/<int:booking_id>/delete/", accounts_views.admin_booking_delete, name="admin_booking_delete"),

    # Admin: payments
    path("admin/payments/", accounts_views.admin_payment_list, name="admin_payments"),
    path("admin/payments/new/", accounts_views.admin_payment_create, name="admin_payment_create"),
    path("admin/payments/<int:payment_id>/edit/", accounts_views.admin_payment_edit, name="admin_payment_edit"),
    path("admin/payments/<int:payment_id>/delete/", accounts_views.admin_payment_delete, name="admin_payment_delete"),

    # Admin: manage Admin users
    path("admin/admins/", accounts_views.admin_admin_list, name="admin_admins"),
    path("admin/admins/new/", accounts_views.admin_admin_create, name="admin_admin_create"),
    path("admin/admins/<int:admin_id>/edit/", accounts_views.admin_admin_edit, name="admin_admin_edit"),
    path("admin/admins/<int:admin_id>/delete/", accounts_views.admin_admin_delete, name="admin_admin_delete"),


    # Home page
    path("", views.home, name="home"),

    # Events & bookings
    path("events/", include(("events.urls", "events"), namespace="events")),
    path("bookings/", include(("bookings.urls", "bookings"), namespace="bookings")),

    # Chatbot
    path("chat/", views.chat_page, name="chat_page"),
    path("chat/api/", views.chat_api, name="chat_api"),

    # Auth (normal user login/logout)
    path(
        "login/",
        auth_views.LoginView.as_view(
            template_name="accounts/login.html"
        ),
        name="login",
    ),
    path("logout/", auth_views.LogoutView.as_view(), name="logout"),

    # Password reset flow
    path(
        "password-reset/",
        auth_views.PasswordResetView.as_view(
            template_name="accounts/password_reset_form.html"
        ),
        name="password_reset",
    ),
    path(
        "password-reset/done/",
        auth_views.PasswordResetDoneView.as_view(
            template_name="accounts/password_reset_done.html"
        ),
        name="password_reset_done",
    ),
    path(
        "reset/<uidb64>/<token>/",
        auth_views.PasswordResetConfirmView.as_view(
            template_name="accounts/password_reset_confirm.html"
        ),
        name="password_reset_confirm",
    ),
    path(
        "reset/done/",
        auth_views.PasswordResetCompleteView.as_view(
            template_name="accounts/password_reset_complete.html"
        ),
        name="password_reset_complete",
    ),

    # Registration
    path("register/", accounts_views.register, name="register"),

    # Accounts app (profile, become_organizer, etc.)
    path("accounts/", include("accounts.urls", namespace="accounts")),
]


==================================================
FILE: ./backend/ems_core/views.py
==================================================

from decimal import Decimal
import json

from django.views.decorators.csrf import csrf_exempt
from django.http import JsonResponse
from django.views.decorators.http import require_POST
from django.contrib.auth.decorators import login_required
from django.utils import timezone
from django.db.models import Count, Sum
from django.shortcuts import render, get_object_or_404

from ai.services.ai_client import ask_llm, AIError
from ai.services.query_planner import plan_query  # your existing read planner
from ai.services.action_planner import plan_action
from ai.models import PendingAIAction

from events.models import Event, Organizer, Venue
from bookings.models import Booking
from accounts.models import UserProfile
from ai.services.query_planner import answer_question
from django.core.exceptions import ValidationError


def home(request):
    """
    Home page with a small preview of upcoming events.
    """
    events = (
        Event.objects.select_related("venue")
        .filter(status="PUBLISHED", start_time__gte=timezone.now())
        .order_by("start_time")[:3]
    )
    return render(request, "home.html", {"events": events})


@login_required
def chat_page(request):
    """
    Render the chatbot page. Conversation handled via AJAX /chat/api/.
    """
    return render(request, "chat/chat_page.html")


# ---------- Helper to get organizer ----------

def _get_user_organizer(request):
    try:
        profile = request.user.userprofile
    except UserProfile.DoesNotExist:
        return None
    return profile.organizer


# ---------- Internal helper: execute create_event pending action ----------

def _execute_create_event(pending: PendingAIAction, user):
    """
    Commit a previously planned create_event action.

    pending.payload is expected to contain the "fields" dict from the planner.
    """
    organizer = _get_user_organizer(type("Req", (), {"user": user})())
    if not organizer:
        pending.delete()
        return "You are not registered as an organizer, so I cannot create events for you."

    fields = pending.payload or {}
    title = fields.get("title") or "Untitled event"
    description = fields.get("description") or ""

    # Event type / venue type
    event_type = fields.get("type") or None  # Exhibition|Conference|Concert|Sports
    venue_type = fields.get("venue_type") or event_type

    # Simple mapping: if no venue_type, default based on event_type
    if venue_type is None and event_type in ("Exhibition", "Conference", "Concert", "Sports"):
        venue_type = event_type

    # Dates come as free-form strings from LLM; we will try to parse them,
    # but if parsing fails we abort safely.
    from datetime import datetime
    from django.utils import timezone as dj_tz

    def parse_dt(value):
        if not value:
            return None
        text = str(value).strip().replace("T", " ")
        # Try a few simple formats
        for fmt in ("%Y-%m-%d %H:%M", "%Y-%m-%d %H:%M:%S"):
            try:
                dt = datetime.strptime(text, fmt)
                return dj_tz.make_aware(dt)
            except ValueError:
                continue
        # As last resort, try fromisoformat (may still fail)
        try:
            dt = datetime.fromisoformat(str(value))
            if dj_tz.is_naive(dt):
                dt = dj_tz.make_aware(dt)
            return dt
        except Exception:
            return None

    start_time = parse_dt(fields.get("start_time"))
    end_time = parse_dt(fields.get("end_time"))

    capacity = fields.get("capacity")
    try:
        capacity = int(capacity) if capacity is not None else None
    except (TypeError, ValueError):
        capacity = None

    status = fields.get("status") or "PUBLISHED"

    # Ticket price required for Concert / Sports
    ticket_price = fields.get("ticket_price")
    try:
        if ticket_price is not None:
            ticket_price = Decimal(str(ticket_price))
    except Exception:
        ticket_price = None

    if event_type in ("Concert", "Sports") and (ticket_price is None or ticket_price <= 0):
        pending.delete()
        return (
            "I tried to create a Concert/Sports event but the ticket price was missing or invalid. "
            "Please specify a valid positive ticket price."
        )

    # Venue resolution: use venue_id if provided, else create a new venue
    venue = None
    venue_id = fields.get("venue_id")
    if venue_id is not None:
        try:
            venue = Venue.objects.get(pk=venue_id)
        except Venue.DoesNotExist:
            venue = None

    if venue is None:
        venue_name = fields.get("venue_name") or "Unnamed venue"
        venue_address = fields.get("venue_address") or ""
        venue_capacity = capacity or 0
        venue_type_final = venue_type or "Conference"  # safe default

        venue = Venue.objects.create(
            name=venue_name,
            address=venue_address,
            capacity=venue_capacity,
            type=venue_type_final,
        )

    # Now actually create the Event (this will run model validation)
    event = Event(
        organizer=organizer,
        venue=venue,
        title=title,
        description=description,
        start_time=start_time,
        end_time=end_time,
        capacity=capacity,
        status=status,
        ticket_price=ticket_price,
    )

    from django.core.exceptions import ValidationError

    try:
        event.full_clean()
    except ValidationError as exc:
        pending.delete()
        return (
            "I tried to create the event but validation failed: "
            f"{exc.message_dict}"
        )

    event.save()
    pending.delete()

    return (
        f"Done! I created the event **{event.title}** at **{event.venue.name}**.\n\n"
        f"- Starts: {event.start_time}\n"
        f"- Ends: {event.end_time}\n"
        f"- Capacity: {event.capacity if event.capacity is not None else 'Not set'}\n"
        f"- Ticket price: {event.ticket_price if event.ticket_price else 'Free / not set'}\n"
        "You can further edit this event from the Organizer dashboard."
    )


# ---------- Chat API: preview + confirm + read logic ----------
@csrf_exempt
@require_POST
@login_required
def chat_api(request):
    """
    Main AI entrypoint.

    Behaviour:
    1. If there is a pending action for this user:
       - "yes"/"confirm" -> execute it
       - "no"/"cancel"   -> discard it
    2. Otherwise, call the action planner:
       - if action == "none" -> pure Q&A (read-only assistant)
       - else                -> store PendingAIAction + return a preview
    """
    try:
        body = json.loads(request.body.decode("utf-8"))
    except json.JSONDecodeError:
        return JsonResponse({"error": "Invalid JSON body."}, status=400)

    message = (body.get("message") or "").strip()
    if not message:
        return JsonResponse({"error": "Message is required."}, status=400)

    user = request.user
    normalized = message.lower().strip()

    # ------------------------------------------------------------------
    # 1) Check for existing pending action (confirmation workflow)
    # ------------------------------------------------------------------
    pending = (
        PendingAIAction.objects
        .filter(user=user)
        .order_by("-created_at")
        .first()
    )

    # Drop expired
    if pending and pending.is_expired():
        pending.delete()
        pending = None

    confirm_phrases = {"yes", "y", "confirm", "ok", "okay", "do it", "go ahead"}
    cancel_phrases = {"no", "n", "cancel", "stop", "never mind", "abort"}

    if pending and normalized in confirm_phrases:
        reply = _execute_pending_action(pending, user)
        pending.delete()
        return JsonResponse({"reply": reply})

    if pending and normalized in cancel_phrases:
        pending.delete()
        return JsonResponse({
            "reply": "Okay, I’ve cancelled that action and won’t make any changes."
        })

    # If there *is* a pending action but the user says something else,
    # we can gently remind them while still answering the new query.
    reminder_text = None
    if pending:
        reminder_text = (
            "You still have a pending action waiting for confirmation.\n\n"
            "If you’d like to proceed, type **yes**. To cancel, type **no**.\n\n"
            "I’ll also treat your new message as a separate question."
        )

    # ------------------------------------------------------------------
    # 2) No-confirmation branch -> use action planner
    # ------------------------------------------------------------------
    is_organizer = False
    try:
        profile = user.userprofile
        is_organizer = bool(profile.organizer)
    except UserProfile.DoesNotExist:
        pass

    plan = plan_action(message, is_organizer=is_organizer)
    action = plan.get("action", "none")
    params = plan.get("params") or {}
    reason = plan.get("reason") or ""

    # If no write action -> normal Q&A
    if action == "none":
        answer = answer_question(user=user, message=message)
        if reminder_text:
            answer = f"{reminder_text}\n\n---\n\n{answer}"
        return JsonResponse({"reply": answer})

    # Non-organizers are not allowed to perform write actions
    if not is_organizer:
        return JsonResponse({
            "reply": (
                "It looks like you’re asking me to modify events or bookings, "
                "but you’re not registered as an organizer. "
                "You can still ask me questions about events and your own bookings."
            )
        })

    # ------------------------------------------------------------------
    # 3) Store PendingAIAction and return a preview
    # ------------------------------------------------------------------
    pending = PendingAIAction.create_for(
        user=user,
        action_type=action,
        payload=params,
        minutes=5,
    )

    preview_lines = [f"Here’s what I plan to do (`{action}`):", ""]

    if action == "create_event":
        title = params.get("title", "(missing title)")
        venue_name = params.get("venue_name", "(venue not specified)")
        start = params.get("start")
        end = params.get("end")
        capacity = params.get("capacity")
        price = params.get("ticket_price")
        description = params.get("description")

        preview_lines.append(f"• **Title** (required): {title}")
        preview_lines.append(f"• **Venue** (required): {venue_name}")
        if start:
            preview_lines.append(f"• **Starts at**: {start}")
        if end:
            preview_lines.append(f"• **Ends at**: {end}")
        if capacity is not None:
            preview_lines.append(f"• **Capacity**: {capacity}")
        if price is not None:
            preview_lines.append(f"• **Ticket price**: ${price}")
        if description:
            preview_lines.append(f"• Description: {description}")

    elif action == "delete_event":
        preview_lines.append(
            f"• Delete the event identified by: {params.get('identifier', '(no identifier)')}"
        )

    elif action == "update_event":
        preview_lines.append(
            f"• Update the event identified by: {params.get('identifier', '(no identifier)')}"
        )
        changes = {k: v for k, v in params.items() if k != "identifier"}
        preview_lines.append(f"• With changes: {changes}")

    elif action == "create_venue":
        preview_lines.append(
            f"• Create a **venue** named: {params.get('name', '(missing name)')}"
        )
        addr = params.get("address")
        if addr:
            preview_lines.append(f"• Address: {addr}")
        cap = params.get("capacity")
        if cap is not None:
            preview_lines.append(f"• Capacity: {cap}")
        vtype = params.get("type")
        if vtype:
            preview_lines.append(f"• Type: {vtype}")

    elif action == "cancel_booking":
        preview_lines.append(
            f"• Cancel booking with ID: {params.get('booking_id', '(missing id)')}"
        )

    preview_lines.append("")
    preview_lines.append("If this looks correct, type **yes** to confirm. To cancel, type **no**.")

    if reason:
        preview_lines.append("")
        preview_lines.append(f"_Why I chose this action_: {reason}")

    text = "\n".join(preview_lines)
    return JsonResponse({"reply": text})


def _execute_pending_action(pending: PendingAIAction, user) -> str:
    """
    Actually perform the DB changes for a confirmed pending action.
    Returns a human-readable message describing the result.
    """
    params = pending.payload or {}
    action = pending.action_type

    # Organizer for this user (needed for permissions)
    organizer = None
    try:
        profile = user.userprofile
        organizer = profile.organizer
    except (UserProfile.DoesNotExist, Organizer.DoesNotExist, AttributeError):
        pass

    if action == "create_event":
        if not organizer:
            return (
                "I couldn’t find an organizer profile linked to your account, "
                "so I can’t create the event."
            )

        title = params.get("title") or "Untitled event"
        venue_name = params.get("venue_name")

        if not venue_name:
            return "I’m missing the venue name for this event."

        venue = Venue.objects.filter(name__iexact=venue_name).first()
        if not venue:
            return (
                f"I couldn’t find a venue called '{venue_name}'. "
                "Please create that venue first or specify a different name."
            )

        # NOTE: here we assume start/end are already proper datetimes.
        # If your planner returns strings, parse them before saving.
        start = params.get("start")
        end = params.get("end") or start
        capacity = params.get("capacity")
        ticket_price = params.get("ticket_price")
        description = params.get("description", "")

        event = Event.objects.create(
            organizer=organizer,
            venue=venue,
            title=title,
            description=description,
            start_time=start,
            end_time=end,
            capacity=capacity,
            status=params.get("status", "DRAFT"),
            ticket_price=ticket_price,
        )

        return f"✅ Event '{event.title}' has been created (ID: {event.event_id})."

    if action == "delete_event":
        identifier = params.get("identifier")
        if not identifier:
            return "I didn’t receive an event identifier to delete."

        qs = Event.objects.filter(organizer=organizer)

        # Try ID first, then title
        event = None
        try:
            event = qs.get(pk=int(identifier))
        except (ValueError, Event.DoesNotExist):
            event = qs.filter(title__iexact=identifier).first()

        if not event:
            return (
                f"I couldn’t find an event matching '{identifier}' "
                "under your organizer account."
            )

        title = event.title
        event.delete()
        return f"🗑️ Event '{title}' has been deleted."

    if action == "cancel_booking":
        booking_id = params.get("booking_id")
        if not booking_id:
            return "I didn’t receive a booking id to cancel."

        try:
            booking = Booking.objects.get(pk=booking_id, event__organizer=organizer)
        except Booking.DoesNotExist:
            return "I couldn’t find that booking under your events."

        booking.status = "CANCELLED"
        booking.save()
        return f"✅ Booking {booking.booking_id} has been cancelled."

    # You can implement update_event / create_venue here later.
    return "I don’t yet know how to execute this type of action."


==================================================
FILE: ./backend/ems_core/wsgi.py
==================================================

"""
WSGI config for ems_core project.

It exposes the WSGI callable as a module-level variable named ``application``.

For more information on this file, see
https://docs.djangoproject.com/en/4.2/howto/deployment/wsgi/
"""

import os

from django.core.wsgi import get_wsgi_application

os.environ.setdefault('DJANGO_SETTINGS_MODULE', 'ems_core.settings')

application = get_wsgi_application()


==================================================
FILE: ./backend/accounts/models.py
==================================================

from django.db import models
from django.contrib.auth.models import User
from django.db.models.signals import post_save
from django.dispatch import receiver

from events.models import Organizer
from customers.models import Customer


class Admin(models.Model):
    ROLE_CHOICES = [
        ("ADMIN", "Admin"),
        ("STAFF", "Staff"),
    ]

    admin_id = models.AutoField(primary_key=True)
    username = models.CharField(max_length=60, unique=True)
    email = models.EmailField(max_length=150, unique=True)
    password_hash = models.CharField(max_length=255)
    role = models.CharField(max_length=20, choices=ROLE_CHOICES)

    class Meta:
        db_table = "ADMIN"

    def __str__(self):
        return f"{self.username} ({self.role})"
    

class UserProfile(models.Model):
    user = models.OneToOneField(User, on_delete=models.CASCADE)
    organizer = models.OneToOneField(
        Organizer,
        on_delete=models.SET_NULL,
        null=True,
        blank=True,
        help_text="Linked organizer record if this user is an organizer.",
    )
    
    customer = models.OneToOneField(
        Customer,
        on_delete=models.SET_NULL,
        null=True,
        blank=True,
        related_name="user_profile",
    )

    def is_organizer(self):
        return self.organizer is not None

    def __str__(self):
        return self.user.username


# --- signals: auto-create a profile for each user ---------------------------

@receiver(post_save, sender=User)
def create_user_profile(sender, instance, created, **kwargs):
    if created:
        UserProfile.objects.create(user=instance)


@receiver(post_save, sender=User)
def save_user_profile(sender, instance, **kwargs):
    # Just ensure profile exists (in case of superuser created via CLI)
    UserProfile.objects.get_or_create(user=instance)

==================================================
FILE: ./backend/accounts/__init__.py
==================================================



==================================================
FILE: ./backend/accounts/apps.py
==================================================

from django.apps import AppConfig


class AccountsConfig(AppConfig):
    default_auto_field = 'django.db.models.BigAutoField'
    name = 'accounts'


==================================================
FILE: ./backend/accounts/forms.py
==================================================

# backend/accounts/forms.py

from django import forms
from django.contrib.auth.forms import UserCreationForm
from django.contrib.auth.models import User
from .models import Admin
from django.contrib.auth.hashers import make_password
class RegisterForm(UserCreationForm):
    # Core auth fields
    email = forms.EmailField(
        required=True,
        help_text="Required. Used for password reset and notifications.",
    )

    # New: personal identity fields
    first_name = forms.CharField(
        max_length=150,
        required=True,
        label="First name",
    )
    last_name = forms.CharField(
        max_length=150,
        required=True,
        label="Last name",
    )

    # New: contact + demographic fields (go into CUSTOMER)
    phone = forms.CharField(
        max_length=50,
        required=False,
        label="Phone number",
    )

    dob = forms.DateField(
        required=False,
        label="Date of birth",
        widget=forms.DateInput(
            attrs={
                "type": "date",
            }
        ),
        help_text="Optional, used for analytics and eligibility checks.",
    )

    address = forms.CharField(
        max_length=255,
        required=False,
        label="Street address",
    )
    city = forms.CharField(
        max_length=100,
        required=False,
        label="City",
    )
    state = forms.CharField(
        max_length=100,
        required=False,
        label="State",
    )
    zipcode = forms.CharField(
        max_length=20,
        required=False,
        label="Zip code",
    )
    country = forms.CharField(
        max_length=100,
        required=False,
        label="Country",
    )

    class Meta:
        model = User
        # Note: extra non-User fields are allowed here because they are
        # declared explicitly on the form class.
        fields = (
            "username",
            "email",
            "first_name",
            "last_name",
            "password1",
            "password2",
            "phone",
            "dob",
            "address",
            "city",
            "state",
            "zipcode",
            "country",
        )

    def save(self, commit=True):
        """
        Save the User instance and leave Customer creation to the view.

        - Copies first_name / last_name / email onto the User model.
        - Returns the User object so accounts.views.register can
          build the CUSTOMER record and link UserProfile.customer.
        """
        user = super().save(commit=False)
        user.email = self.cleaned_data["email"]
        user.first_name = self.cleaned_data["first_name"]
        user.last_name = self.cleaned_data["last_name"]

        if commit:
            user.save()
        return user


class AdminForm(forms.ModelForm):
    """
    ModelForm for managing records in the ADMIN table.

    We expose a plain 'password' field and internally hash it
    into the password_hash column. On edit, password is optional.
    """

    password = forms.CharField(
        required=False,
        label="Password",
        widget=forms.PasswordInput,
        help_text=(
            "Set a password for this admin. "
            "Leave blank when editing to keep the current password."
        ),
    )

    class Meta:
        model = Admin
        fields = ["username", "email", "role"]

    def __init__(self, *args, **kwargs):
        super().__init__(*args, **kwargs)
        # On create (no instance.pk yet), make password required
        if self.instance.pk is None:
            self.fields["password"].required = True

    def save(self, commit=True):
        admin = super().save(commit=False)
        pwd = self.cleaned_data.get("password")

        # Only update password_hash if a new password is provided
        if pwd:
            admin.password_hash = make_password(pwd)

        if commit:
            admin.save()
        return admin

==================================================
FILE: ./backend/accounts/admin.py
==================================================

from django.contrib import admin
from .models import Admin as AdminModel


@admin.register(AdminModel)
class AdminTableAdmin(admin.ModelAdmin):
    list_display = ("admin_id", "username", "email", "role")
    list_filter = ("role",)
    search_fields = ("username", "email")


==================================================
FILE: ./backend/accounts/tests.py
==================================================

from django.test import TestCase

# Create your tests here.


==================================================
FILE: ./backend/accounts/urls.py
==================================================

from django.urls import path
from . import views

app_name = "accounts"

urlpatterns = [
    # your existing login/register urls here...

    path("become-organizer/", views.become_organizer, name="become_organizer"),
    path("profile/", views.profile, name="profile"),

]


==================================================
FILE: ./backend/accounts/views.py
==================================================

# backend/accounts/views.py

from functools import wraps

from django.contrib import messages
from django.contrib.auth.decorators import login_required
from django.contrib.auth.hashers import check_password
from django.shortcuts import get_object_or_404, redirect, render
from django.utils import timezone

from .models import UserProfile, Admin
from .forms import RegisterForm
from events.models import Organizer
from bookings.models import Booking
from events.models import Event, Venue           # ← add this
from events.forms import AdminEventForm, AdminVenueForm
from customers.models import Customer
from customers.forms import AdminCustomerForm
from .forms import AdminForm 
from django.db.models import ProtectedError

# ─────────────────────────────────────────────────────────────
# User registration / profile
# ─────────────────────────────────────────────────────────────

def register(request):
    """
    User registration:
    - Create Django auth User
    - Create/Update CUSTOMER row with full details
    - Link Customer to UserProfile.customer
    """
    if request.method == "POST":
        form = RegisterForm(request.POST)
        if form.is_valid():
            # 1) Create the User
            user = form.save()

            # 2) Build full name from first + last
            first_name = form.cleaned_data["first_name"]
            last_name = form.cleaned_data["last_name"]
            full_name = f"{first_name} {last_name}".strip()

            # 3) Extract CUSTOMER-related fields
            email = form.cleaned_data["email"]
            phone = form.cleaned_data.get("phone")

            dob = form.cleaned_data.get("dob")
            address = form.cleaned_data.get("address")
            city = form.cleaned_data.get("city")
            state = form.cleaned_data.get("state")
            zipcode = form.cleaned_data.get("zipcode")
            country = form.cleaned_data.get("country")

            # 4) Create or update Customer (email is unique in CUSTOMER)
            customer, created = Customer.objects.get_or_create(
                email=email,
                defaults={
                    "name": full_name,
                    "phone": phone,
                    "dob": dob,
                    "address": address,
                    "city": city,
                    "state": state,
                    "zipcode": zipcode,
                    "country": country,
                },
            )

            if not created:
                # Keep customer data in sync
                customer.name = full_name
                customer.phone = phone
                customer.dob = dob
                customer.address = address
                customer.city = city
                customer.state = state
                customer.zipcode = zipcode
                customer.country = country
                customer.save()

            # 5) Link Customer to UserProfile
            profile, _ = UserProfile.objects.get_or_create(user=user)
            profile.customer = customer
            profile.save()

            messages.success(request, "Account created successfully. You can now log in.")
            return redirect("login")
    else:
        form = RegisterForm()

    return render(request, "accounts/register.html", {"form": form})



@login_required
def profile(request):
    user = request.user
    profile = getattr(user, "userprofile", None)
    customer = None
    if profile and profile.customer:
        # preferred: via UserProfile link
        customer = profile.customer
    else:
        # fallback: try to find by email (for older data)
        try:
            customer = Customer.objects.get(email=user.email)
        except Customer.DoesNotExist:
            customer = None
    bookings = (
        Booking.objects
        .select_related("event", "customer")
        .filter(customer__email=user.email)
        .order_by("-booked_at")
    )

    now = timezone.now()
    upcoming = [b for b in bookings if b.event.start_time >= now]
    past = [b for b in bookings if b.event.start_time < now]

    context = {
        "user": user,
        "profile": profile,
        "customer": customer,
        "upcoming_bookings": upcoming,
        "past_bookings": past,
        "now": now,
    }
    return render(request, "accounts/profile.html", context)


# ─────────────────────────────────────────────────────────────
# Become organizer flow (with admin approval)
# ─────────────────────────────────────────────────────────────

@login_required
def become_organizer(request):
    """
    Let a normal user request organizer status.

    - If they already have an APPROVED organizer linked, redirect to manage events.
    - If they have a PENDING organizer, show read-only info + message.
    - Otherwise, allow them to submit a new request, which will be PENDING
      until an admin approves it.
    """
    profile, _ = UserProfile.objects.get_or_create(user=request.user)

    existing_org = Organizer.objects.filter(user=request.user).order_by("-organizer_id").first()

    # Already approved: ensure profile link and send to dashboard
    if existing_org and existing_org.status == "APPROVED":
        if profile.organizer_id != existing_org.pk:
            profile.organizer = existing_org
            profile.save()
        messages.info(request, "You are already an approved organizer.")
        return redirect("events:manage_events")

    # Pending request: show waiting message
    if existing_org and existing_org.status == "PENDING":
        return render(
            request,
            "accounts/become_organizer.html",
            {
                "pending": True,
                "organizer": existing_org,
            },
        )

    # Rejected or no organizer: allow (re)submission
    if request.method == "POST":
        name = request.POST.get("name") or request.user.get_full_name() or request.user.username
        email = request.POST.get("email") or request.user.email
        phone = request.POST.get("phone")

        if not name or not email:
            messages.error(request, "Name and email are required.")
            return render(request, "accounts/become_organizer.html")

        # Do not allow another organizer with same email for a DIFFERENT user
        if Organizer.objects.exclude(user=request.user).filter(email=email).exists():
            messages.error(
                request,
                "An organizer with this email already exists. "
                "Please use a different email or contact the admin."
            )
            return render(
                request,
                "accounts/become_organizer.html",
                {"prefill_name": name, "prefill_email": email, "prefill_phone": phone},
            )

        organizer = Organizer.objects.create(
            user=request.user,
            name=name,
            email=email,
            phone=phone,
            status="PENDING",
        )

        messages.success(
            request,
            "Your request to become an organizer has been submitted. "
            "An admin must approve it before you can manage events."
        )
        return redirect("accounts:profile")

    # GET: blank form with sensible defaults
    return render(
        request,
        "accounts/become_organizer.html",
        {
            "prefill_name": request.user.get_full_name() or request.user.username,
            "prefill_email": request.user.email,
        },
    )


# ─────────────────────────────────────────────────────────────
# Custom Admin Portal (no Django admin.site)
# ─────────────────────────────────────────────────────────────

def admin_required(view_func):
    """
    Simple decorator that checks our own Admin session.
    Does NOT use django.contrib.auth permissions.
    """

    @wraps(view_func)
    def _wrapped(request, *args, **kwargs):
        if not request.session.get("admin_id"):
            messages.error(request, "Admin login required.")
            return redirect("admin_login")
        return view_func(request, *args, **kwargs)

    return _wrapped


def admin_login(request):
    """
    Custom admin login based on the ADMIN table.
    Stores admin_id and role in the session.
    """
    if request.session.get("admin_id"):
        return redirect("admin_dashboard")

    error = None
    username_prefill = ""

    if request.method == "POST":
        from django.contrib.auth.hashers import check_password  # local import is fine too

        username = request.POST.get("username", "").strip()
        password = request.POST.get("password", "")
        username_prefill = username

        try:
            admin = Admin.objects.get(username=username)
        except Admin.DoesNotExist:
            admin = None

        if admin and check_password(password, admin.password_hash):
            request.session["admin_id"] = admin.admin_id
            request.session["admin_role"] = admin.role
            messages.success(request, f"Welcome, {admin.username}.")
            return redirect("admin_dashboard")
        else:
            error = "Invalid username or password."

    context = {
        "error": error,
        "username_prefill": username_prefill,
    }
    return render(request, "accounts/admin_login.html", context)


def admin_logout(request):
    request.session.pop("admin_id", None)
    request.session.pop("admin_role", None)
    messages.info(request, "You have been logged out of the admin portal.")
    return redirect("admin_login")


@admin_required
def admin_dashboard(request):
    """
    Overview cards: events, organizers, venues, customers, bookings, pending organizers.
    """
    from events.models import Event, Organizer, Venue
    from customers.models import Customer

    admin = Admin.objects.get(pk=request.session["admin_id"])

    stats = {
        "event_count": Event.objects.count(),
        "organizer_count": Organizer.objects.count(),
        "venue_count": Venue.objects.count(),
        "customer_count": Customer.objects.count(),
        "booking_count": Booking.objects.count(),
        "pending_organizers": Organizer.objects.filter(status="PENDING").count(),
        "admin_count": Admin.objects.count(),
    }
    
    admin_obj = Admin.objects.get(pk=request.session["admin_id"])

    context = {
        "admin": admin_obj,
        "stats": stats,
    }
    return render(request, "accounts/admin_dashboard.html", context)


# ─────────────────────────────────────────────────────────────
# Admin: Organizer management (approval / rejection)
# ─────────────────────────────────────────────────────────────

@admin_required
def admin_organizer_list(request):
    """
    List all organizers with status, and show approve/reject actions for PENDING ones.
    """
    status_filter = request.GET.get("status") or ""
    organizers = Organizer.objects.select_related("user").order_by("status", "name")

    if status_filter in ["PENDING", "APPROVED", "REJECTED"]:
        organizers = organizers.filter(status=status_filter)

    stats = {
        "pending": Organizer.objects.filter(status="PENDING").count(),
        "approved": Organizer.objects.filter(status="APPROVED").count(),
        "rejected": Organizer.objects.filter(status="REJECTED").count(),
    }

    context = {
        "organizers": organizers,
        "stats": stats,
        "status_filter": status_filter,
    }
    return render(request, "accounts/admin_organizers.html", context)


@admin_required
def admin_organizer_approve(request, organizer_id):
    organizer = get_object_or_404(Organizer, pk=organizer_id)
    organizer.status = "APPROVED"
    organizer.save()

    if organizer.user:
        profile, _ = UserProfile.objects.get_or_create(user=organizer.user)
        profile.organizer = organizer
        profile.save()

    messages.success(request, f"Organizer '{organizer.name}' has been approved.")
    return redirect("admin_organizers")


@admin_required
def admin_organizer_reject(request, organizer_id):
    organizer = get_object_or_404(Organizer, pk=organizer_id)
    organizer.status = "REJECTED"
    organizer.save()

    if organizer.user:
        profile, _ = UserProfile.objects.get_or_create(user=organizer.user)
        if profile.organizer_id == organizer.pk:
            profile.organizer = None
            profile.save()

    messages.info(request, f"Organizer '{organizer.name}' has been rejected.")
    return redirect("admin_organizers")

# ─────────────────────────────────────────────────────────────
# Admin: Event management (CRUD)
# ─────────────────────────────────────────────────────────────

@admin_required
def admin_event_list(request):
    events = (
        Event.objects
        .select_related("organizer", "venue")
        .order_by("-start_time")
    )
    return render(
        request,
        "events/admin_event_list.html",
        {"events": events},
    )


@admin_required
def admin_event_create(request):
    if request.method == "POST":
        form = AdminEventForm(request.POST)
        if form.is_valid():
            form.save()
            messages.success(request, "Event created successfully.")
            return redirect("admin_events")
    else:
        form = AdminEventForm()

    return render(
        request,
        "events/admin_event_form.html",
        {"form": form, "mode": "create"},
    )


@admin_required
def admin_event_edit(request, event_id):
    event = get_object_or_404(Event, pk=event_id)

    if request.method == "POST":
        form = AdminEventForm(request.POST, instance=event)
        if form.is_valid():
            form.save()
            messages.success(request, "Event updated successfully.")
            return redirect("admin_events")
    else:
        form = AdminEventForm(instance=event)

    return render(
        request,
        "events/admin_event_form.html",
        {"form": form, "mode": "edit", "event": event},
    )


@admin_required
def admin_event_delete(request, event_id):
    event = get_object_or_404(Event, pk=event_id)

    if request.method == "POST":
        title = event.title
        try:
            # this may raise ProtectedError if there are related bookings
            event.delete()
            messages.success(request, f"Event '{title}' has been deleted.")
        except ProtectedError:
            messages.error(
                request,
                (
                    f"Cannot delete event '{title}' because there are bookings "
                    "linked to it. Cancel or delete those bookings first."
                ),
            )
        # always go back to the Events list
        return redirect("admin_events")

    # GET: show confirmation page
    return render(
        request,
        "events/admin_event_confirm_delete.html",
        {"event": event},
    )



# ─────────────────────────────────────────────────────────────
# Admin: Venue management (CRUD)
# ─────────────────────────────────────────────────────────────

@admin_required
def admin_venue_list(request):
    venues = Venue.objects.order_by("name")
    return render(
        request,
        "events/admin_venue_list.html",   # ← LIST template
        {"venues": venues},
    )


@admin_required
def admin_venue_create(request):
    if request.method == "POST":
        form = AdminVenueForm(request.POST)
        if form.is_valid():
            form.save()
            messages.success(request, "Venue created successfully.")
            return redirect("admin_venues")
    else:
        form = AdminVenueForm()

    return render(
        request,
        "events/admin_venue_form.html",
        {"form": form, "mode": "create"},
    )


@admin_required
def admin_venue_edit(request, venue_id):
    venue = get_object_or_404(Venue, pk=venue_id)

    if request.method == "POST":
        form = AdminVenueForm(request.POST, instance=venue)
        if form.is_valid():
            form.save()
            messages.success(request, "Venue updated successfully.")
            return redirect("admin_venues")
    else:
        form = AdminVenueForm(instance=venue)

    return render(
        request,
        "events/admin_venue_form.html",
        {"form": form, "mode": "edit", "venue": venue},
    )


@admin_required
def admin_venue_delete(request, venue_id):
    venue = get_object_or_404(Venue, pk=venue_id)

    if request.method == "POST":
        name = venue.name
        try:
            venue.delete()
            messages.success(request, f"Venue '{name}' has been deleted.")
        except ProtectedError:
            messages.error(
                request,
                (
                    f"Cannot delete venue '{name}' because there are events "
                    "assigned to it. Reassign or delete those events first."
                ),
            )
        return redirect("admin_venues")

    return render(
        request,
        "events/admin_venue_confirm_delete.html",
        {"venue": venue},
    )

# ─────────────────────────────────────────────────────────────
# Admin: Customer management (CRUD)
# ─────────────────────────────────────────────────────────────

@admin_required
def admin_customer_list(request):
    customers = Customer.objects.order_by("name", "email")
    return render(
        request,
        "customers/admin_customer_list.html",
        {"customers": customers},
    )


@admin_required
def admin_customer_create(request):
    if request.method == "POST":
        form = AdminCustomerForm(request.POST)
        if form.is_valid():
            form.save()
            messages.success(request, "Customer created successfully.")
            return redirect("admin_customers")
    else:
        form = AdminCustomerForm()

    return render(
        request,
        "customers/admin_customer_form.html",
        {"form": form, "mode": "create"},
    )


@admin_required
def admin_customer_edit(request, customer_id):
    customer = get_object_or_404(Customer, pk=customer_id)

    if request.method == "POST":
        form = AdminCustomerForm(request.POST, instance=customer)
        if form.is_valid():
            form.save()
            messages.success(request, "Customer updated successfully.")
            return redirect("admin_customers")
    else:
        form = AdminCustomerForm(instance=customer)

    return render(
        request,
        "customers/admin_customer_form.html",
        {"form": form, "mode": "edit", "customer": customer},
    )


@admin_required
def admin_customer_delete(request, customer_id):
    customer = get_object_or_404(Customer, pk=customer_id)

    if request.method == "POST":
        name = customer.name
        customer.delete()
        messages.success(request, f"Customer '{name}' has been deleted.")
        return redirect("admin_customers")

    return render(
        request,
        "customers/admin_customer_confirm_delete.html",
        {"customer": customer},
    )


from bookings.forms import AdminBookingForm, AdminPaymentForm
from bookings.models import Booking, Payment

# ─────────────────────────────────────────────────────────────
# Admin: Booking management (CRUD)
# ─────────────────────────────────────────────────────────────

@admin_required
def admin_booking_list(request):
    bookings = (
        Booking.objects
        .select_related("event", "customer")
        .order_by("-booked_at")
    )
    return render(
        request,
        "bookings/admin_booking_list.html",
        {"bookings": bookings},
    )


@admin_required
def admin_booking_create(request):
    if request.method == "POST":
        form = AdminBookingForm(request.POST)
        if form.is_valid():
            form.save()
            messages.success(request, "Booking created successfully.")
            return redirect("admin_bookings")
    else:
        form = AdminBookingForm()

    return render(
        request,
        "bookings/admin_booking_form.html",
        {"form": form, "mode": "create"},
    )


@admin_required
def admin_booking_edit(request, booking_id):
    booking = get_object_or_404(Booking, pk=booking_id)

    if request.method == "POST":
        form = AdminBookingForm(request.POST, instance=booking)
        if form.is_valid():
            form.save()
            messages.success(request, "Booking updated successfully.")
            return redirect("admin_bookings")
    else:
        form = AdminBookingForm(instance=booking)

    return render(
        request,
        "bookings/admin_booking_form.html",
        {"form": form, "mode": "edit", "booking": booking},
    )


@admin_required
def admin_booking_delete(request, booking_id):
    booking = get_object_or_404(Booking, pk=booking_id)

    if request.method == "POST":
        label = f"{booking.event.title} for {booking.customer.name}"
        booking.delete()
        messages.success(request, f"Booking '{label}' has been deleted.")
        return redirect("admin_bookings")

    return render(
        request,
        "bookings/admin_booking_confirm_delete.html",
        {"booking": booking},
    )


# ─────────────────────────────────────────────────────────────
# Admin: Payment management (CRUD)
# ─────────────────────────────────────────────────────────────

@admin_required
def admin_payment_list(request):
    payments = (
        Payment.objects
        .select_related("booking", "customer")
        .order_by("-paid_at")
    )
    return render(
        request,
        "bookings/admin_payment_list.html",
        {"payments": payments},
    )


@admin_required
def admin_payment_create(request):
    if request.method == "POST":
        form = AdminPaymentForm(request.POST)
        if form.is_valid():
            form.save()
            messages.success(request, "Payment created successfully.")
            return redirect("admin_payments")
    else:
        form = AdminPaymentForm()

    return render(
        request,
        "bookings/admin_payment_form.html",
        {"form": form, "mode": "create"},
    )


@admin_required
def admin_payment_edit(request, payment_id):
    payment = get_object_or_404(Payment, pk=payment_id)

    if request.method == "POST":
        form = AdminPaymentForm(request.POST, instance=payment)
        if form.is_valid():
            form.save()
            messages.success(request, "Payment updated successfully.")
            return redirect("admin_payments")
    else:
        form = AdminPaymentForm(instance=payment)

    return render(
        request,
        "bookings/admin_payment_form.html",
        {"form": form, "mode": "edit", "payment": payment},
    )


@admin_required
def admin_payment_delete(request, payment_id):
    payment = get_object_or_404(Payment, pk=payment_id)

    if request.method == "POST":
        label = f"{payment.amount} for booking #{payment.booking_id}"
        payment.delete()
        messages.success(request, f"Payment '{label}' has been deleted.")
        return redirect("admin_payments")

    return render(
        request,
        "bookings/admin_payment_confirm_delete.html",
        {"payment": payment},
    )

def _current_admin(request):
    """
    Convenience helper to fetch the currently logged-in Admin row
    using the admin_id stored in the session.
    """
    admin_id = request.session.get("admin_id")
    if not admin_id:
        return None
    try:
        return Admin.objects.get(pk=admin_id)
    except Admin.DoesNotExist:
        return None


def _require_super_admin(request):
    """
    Optional helper: only allow ADMIN.role == 'ADMIN' to manage admin users.
    If you want STAFF to also manage admins, you can relax this check.
    """
    admin = _current_admin(request)
    if not admin or admin.role != "ADMIN":
        messages.error(request, "Only Admin users with role 'ADMIN' can manage admin accounts.")
        return False
    return True


@admin_required
def admin_admin_list(request):
    """
    List all admin users from the ADMIN table.
    """
    if not _require_super_admin(request):
        return redirect("admin_dashboard")

    admins = Admin.objects.order_by("username")

    context = {
        "admins": admins,
    }
    return render(request, "accounts/admin_admin_list.html", context)


@admin_required
def admin_admin_create(request):
    """
    Create a new admin record (username, email, role, password).
    """
    if not _require_super_admin(request):
        return redirect("admin_dashboard")

    if request.method == "POST":
        form = AdminForm(request.POST)
        if form.is_valid():
            form.save()
            messages.success(request, "Admin user created successfully.")
            return redirect("admin_admins")
    else:
        form = AdminForm()

    return render(
        request,
        "accounts/admin_admin_form.html",
        {"form": form, "mode": "create"},
    )


@admin_required
def admin_admin_edit(request, admin_id):
    """
    Edit an existing admin user. Password is optional and only updated
    if a new one is provided.
    """
    if not _require_super_admin(request):
        return redirect("admin_dashboard")

    admin_obj = get_object_or_404(Admin, pk=admin_id)

    if request.method == "POST":
        form = AdminForm(request.POST, instance=admin_obj)
        if form.is_valid():
            form.save()
            messages.success(request, "Admin user updated successfully.")
            return redirect("admin_admins")
    else:
        form = AdminForm(instance=admin_obj)

    return render(
        request,
        "accounts/admin_admin_form.html",
        {"form": form, "mode": "edit", "admin_obj": admin_obj},
    )


@admin_required
def admin_admin_delete(request, admin_id):
    """
    Delete an admin user. Do not allow an admin to delete themselves.
    """
    if not _require_super_admin(request):
        return redirect("admin_dashboard")

    admin_obj = get_object_or_404(Admin, pk=admin_id)
    current_admin = _current_admin(request)

    if current_admin and current_admin.pk == admin_obj.pk:
        messages.error(request, "You cannot delete your own admin account.")
        return redirect("admin_admins")

    if request.method == "POST":
        username = admin_obj.username
        admin_obj.delete()
        messages.success(request, f"Admin user '{username}' has been deleted.")
        return redirect("admin_admins")

    return render(
        request,
        "accounts/admin_admin_confirm_delete.html",
        {"admin_obj": admin_obj},
    )

==================================================
FILE: ./backend/ai/models.py
==================================================

# backend/ai/models.py

from datetime import timedelta

from django.conf import settings
from django.db import models
from django.utils import timezone


class PendingAIAction(models.Model):
    """
    Stores a single 'planned' action for a user that must be confirmed
    (e.g. create/update/delete event, create venue, cancel booking, etc.)
    """

    ACTION_CHOICES = [
        ("create_event", "Create event"),
        ("update_event", "Update event"),
        ("delete_event", "Delete event"),
        ("create_venue", "Create venue"),
        ("cancel_booking", "Cancel booking"),
    ]

    user = models.ForeignKey(
        settings.AUTH_USER_MODEL,
        on_delete=models.CASCADE,
        related_name="pending_ai_actions",
    )
    action_type = models.CharField(max_length=40, choices=ACTION_CHOICES)
    payload = models.JSONField()  # structured parameters for the action
    created_at = models.DateTimeField(auto_now_add=True)
    expires_at = models.DateTimeField()

    def is_expired(self) -> bool:
        return self.expires_at <= timezone.now()

    @classmethod
    def create_for(cls, user, action_type: str, payload: dict, minutes: int = 5):
        """
        Helper to create a pending action that automatically expires in N minutes.
        """
        return cls.objects.create(
            user=user,
            action_type=action_type,
            payload=payload,
            expires_at=timezone.now() + timedelta(minutes=minutes),
        )

    def __str__(self) -> str:
        return f"{self.user} · {self.action_type} · {self.created_at:%Y-%m-%d %H:%M}"


==================================================
FILE: ./backend/ai/__init__.py
==================================================



==================================================
FILE: ./backend/ai/services/__init__.py
==================================================

# backend/ai/services/__init__.py

"""
Service layer for AI helpers used by the EMS chatbot.

Exports:
- answer_question: main entry point for answering natural-language questions.
- plan_action:     classify a message into a potential write action + params.
"""

from .query_planner import answer_question
from .action_planner import plan_action

__all__ = ["answer_question", "plan_action"]


==================================================
FILE: ./backend/ai/services/action_planner.py
==================================================

# backend/ai/services/action_planner.py

import json
from typing import Any, Dict

from .ai_client import ask_llm  # use your existing client helper


SYSTEM_PROMPT = """
You are an action planner for an Event Management System (EMS).

You receive a single user message and must decide if it is asking to perform
a WRITE operation, and if so, extract the parameters.

Valid actions:
- "create_event"
- "update_event"
- "delete_event"
- "create_venue"
- "cancel_booking"
- "none"  (for purely informational / read-only questions)

You MUST respond with a single line of JSON and nothing else.

Schema:
{
  "action": "create_event" | "update_event" | "delete_event" | "create_venue" | "cancel_booking" | "none",
  "reason": "<short explanation of why you chose this action>",
  "params": {
      // key/value pairs needed to perform the action
  }
}

Guidelines:
- If you are not sure there is a write operation, use "action": "none".
- For create_event, try to extract:
  - title (string)
  - venue_name (string)
  - type (string, e.g. "Concert", "Sports", etc.)
  - capacity (integer if given)
  - ticket_price (float if given)
  - start (ISO8601 datetime string if possible)
  - end (ISO8601 datetime string if possible)
  - description (string, optional)
- For delete_event or update_event, include an "identifier" that may be an ID
  or an exact event title.
- For create_venue, include:
  - name
  - address (if provided)
  - capacity
  - type
- For cancel_booking, include:
  - booking_id (integer if the user mentions a specific booking id)
  

Additional CRITICAL rules:
- For any datetime field (like start_time, end_time), ALWAYS output values
  in the exact format: "YYYY-MM-DD HH:MM" (24-hour, no timezone).
  Example: "2025-12-05 19:00".
- NEVER use vague phrases like "next Friday" or "tomorrow 7pm" in JSON.
...
"""


def plan_action(message: str, is_organizer: bool) -> Dict[str, Any]:
    """
    Ask the LLM to classify the intent and extract structured parameters.

    If the user is NOT an organizer, you should still let the LLM suggest an
    action, but the caller will enforce permissions (i.e. disallow writes).
    """
    role_hint = (
        "The user is an organizer and can manage events and venues."
        if is_organizer
        else "The user is a participant and CANNOT create, edit, or delete events/venues."
    )

    user_prompt = f"{role_hint}\n\nUser message:\n```{message}```"

    # Use your existing ask_llm helper.
    response_text = ask_llm(
        SYSTEM_PROMPT,
        user_prompt,
        temperature=0.1,
    ).strip()

    try:
        data = json.loads(response_text)
    except json.JSONDecodeError:
        return {
            "action": "none",
            "reason": "Model did not return valid JSON.",
            "params": {},
        }

    action = data.get("action", "none")
    params = data.get("params") or {}
    reason = data.get("reason") or ""

    valid_actions = {
        "create_event",
        "update_event",
        "delete_event",
        "create_venue",
        "cancel_booking",
        "none",
    }
    if action not in valid_actions:
        action = "none"

    if not isinstance(params, dict):
        params = {}

    return {
        "action": action,
        "reason": reason,
        "params": params,
    }


==================================================
FILE: ./backend/ai/services/query_planner.py
==================================================

# backend/ai/services/query_planner.py

from typing import Any, Dict, List, Optional

from django.utils import timezone

from .ai_client import ask_llm, AIError
from events.models import Event
from bookings.models import Booking
from accounts.models import UserProfile


SYSTEM_PROMPT = """
You are an AI assistant for an Event Management System (EMS).

You are given:
- The current user (may be an organizer or a participant).
- A small snapshot of relevant data from the EMS database.
- The user's natural-language question.

Your job is to answer the question clearly and concisely, using ONLY the
information provided in the context plus general knowledge about how events
and bookings work. Do NOT invent extra events or bookings that are not in
the context.

If the user asks for something you cannot see in the context, say that you
don't see that information in the system snapshot and suggest what they
could do instead (e.g., ask the organizer, check another page, etc.).

Always speak in plain language, 1–3 short paragraphs, with bullet points
only when it truly helps readability.
"""


def _get_user_role(user) -> str:
    if not user or not user.is_authenticated:
        return "guest"

    try:
        profile: Optional[UserProfile] = user.userprofile
    except UserProfile.DoesNotExist:
        return "authenticated-participant"

    if profile.organizer:
        return "organizer"
    return "participant"


def _build_context_for_user(user) -> str:
    """
    Collect a small, human-readable snapshot of data to send to the LLM.

    This is intentionally compact to avoid blowing out the prompt.
    """
    now = timezone.now()
    role = _get_user_role(user)
    lines: List[str] = []

    lines.append(f"USER ROLE: {role}")
    if user and user.is_authenticated:
        lines.append(f"USER EMAIL: {user.email or 'unknown'}")
        lines.append(f"USERNAME: {user.get_username()}")

    # Upcoming published events (global)
    upcoming_events = (
        Event.objects.select_related("venue", "organizer")
        .filter(status="PUBLISHED", start_time__gte=now)
        .order_by("start_time")[:20]
    )

    if upcoming_events:
        lines.append("\nUPCOMING PUBLISHED EVENTS (max 20):")
        for ev in upcoming_events:
            lines.append(
                f"- Event #{ev.event_id}: '{ev.title}' "
                f"@ {ev.venue.name} ({ev.venue.type}), "
                f"starts {ev.start_time}, status={ev.status}, "
                f"capacity={ev.capacity}, price={ev.ticket_price}"
            )
    else:
        lines.append("\nUPCOMING PUBLISHED EVENTS: none found.")

    # Bookings related to this user (as participant)
    if user and user.is_authenticated and user.email:
        my_bookings = (
            Booking.objects.select_related("event", "customer")
            .filter(customer__email=user.email)
            .order_by("-booked_at")[:20]
        )
        if my_bookings:
            lines.append("\nBOOKINGS FOR THIS USER (max 20):")
            for b in my_bookings:
                lines.append(
                    f"- Booking #{b.booking_id} for event #{b.event.event_id} "
                    f"'{b.event.title}', tickets={b.ticket_qty}, "
                    f"status={b.status}, total={b.total_price}, "
                    f"booked_at={b.booked_at}"
                )
        else:
            lines.append("\nBOOKINGS FOR THIS USER: none found.")

    # If organizer, also show their events + booking counts
    if role == "organizer":
        try:
            organizer = user.userprofile.organizer
        except (UserProfile.DoesNotExist, AttributeError):
            organizer = None

        if organizer:
            org_events = (
                Event.objects.select_related("venue")
                .filter(organizer=organizer)
                .order_by("start_time")[:30]
            )
            if org_events:
                lines.append("\nEVENTS OWNED BY THIS ORGANIZER (max 30):")
                for ev in org_events:
                    booking_count = Booking.objects.filter(event=ev).count()
                    lines.append(
                        f"- Event #{ev.event_id}: '{ev.title}' "
                        f"@ {ev.venue.name} ({ev.venue.type}), "
                        f"starts {ev.start_time}, status={ev.status}, "
                        f"bookings={booking_count}, capacity={ev.capacity}, "
                        f"price={ev.ticket_price}"
                    )
            else:
                lines.append("\nEVENTS OWNED BY THIS ORGANIZER: none found.")

    return "\n".join(lines)


def answer_question(*args, **kwargs) -> str:
    """
    Main entry point used by ems_core.views.chat_api.

    It is deliberately flexible about arguments so it won't break if the view
    calls it positionally or with keywords.

    Expected usage (most likely):
        answer_question(user, message)
    or:
        answer_question(user=request.user, message=msg)
    """

    # --- Extract user & message robustly -----------------------------------
    user = None
    message = ""

    if len(args) >= 1:
        user = args[0]
    if len(args) >= 2:
        message = args[1]

    # Keyword overrides
    if "user" in kwargs:
        user = kwargs["user"]
    if "message" in kwargs:
        message = kwargs["message"]
    elif "query" in kwargs:
        message = kwargs["query"]

    message = (message or "").strip()
    if not message:
        return "I didn't receive a question. Please type what you'd like to know about your events or bookings."

    # --- Build context snapshot -------------------------------------------
    context_text = _build_context_for_user(user)

    user_prompt = (
        f"Here is a snapshot of the EMS database relevant to the current user:\n\n"
        f"---BEGIN CONTEXT---\n{context_text}\n---END CONTEXT---\n\n"
        f"User question:\n{message}\n\n"
        f"Answer using only the context above and general event-management knowledge."
    )

    try:
        reply = ask_llm(
            SYSTEM_PROMPT,
            user_prompt,
            temperature=0.2,
        )
        return reply.strip()
    except AIError:
        return (
            "I had trouble contacting the AI backend. "
            "Please try again in a moment."
        )
    except Exception:
        # Avoid leaking stack traces to the user
        return (
            "Something went wrong while answering your question. "
            "Please try again or contact the administrator if it persists."
        )


# ---------------------------------------------------------------------------
# Backwards-compatibility shim for older code that imports `plan_query`.
# This wraps the newer `answer_question` helper.
# ---------------------------------------------------------------------------

def plan_query(user, message: str) -> Dict[str, Any]:
    """
    Lightweight wrapper so existing code that calls `plan_query` keeps working.

    Returns a dict so callers can do:
        result = plan_query(user, message)
        text = result["answer"]
    """
    return {
        "answer": answer_question(user=user, message=message),
    }


==================================================
FILE: ./backend/ai/services/ai_client.py
==================================================

# backend/ai/services/ai_client.py

import json
import logging
from typing import Any

import requests

logger = logging.getLogger(__name__)

# Ollama local chat endpoint
OLLAMA_CHAT_URL = "http://localhost:11434/api/chat"
# Adjust to match your pulled model name
MODEL_NAME = "llama3.1:latest"


class AIError(Exception):
    """Custom exception for AI-related errors."""
    pass


def ask_llm(system_prompt: str, user_prompt: str, temperature: float = 0.2) -> str:
    """
    High-level wrapper around the local Llama 3.1 (Ollama) chat API.

    Parameters
    ----------
    system_prompt : str
        Instructions / role message for the model.
    user_prompt : str
        The actual question or text from the user.
    temperature : float, optional
        Sampling temperature (0.0 = very deterministic, higher = more random).

    Returns
    -------
    str
        The assistant's reply text.

    Raises
    ------
    AIError
        If there is a network issue, non-200 response, or invalid JSON.
    """
    messages = [
        {"role": "system", "content": system_prompt},
        {"role": "user", "content": user_prompt},
    ]

    payload: dict[str, Any] = {
        "model": MODEL_NAME,
        "messages": messages,
        "stream": False,  # we want a single JSON object back
        "options": {
            "temperature": temperature,
        },
    }

    try:
        response = requests.post(OLLAMA_CHAT_URL, json=payload, timeout=180)
    except requests.RequestException as exc:
        logger.exception("Error connecting to Ollama")
        raise AIError("Could not reach local AI service (Ollama).") from exc

    if response.status_code != 200:
        logger.error("Ollama returned status %s: %s", response.status_code, response.text)
        raise AIError(f"AI service error: HTTP {response.status_code}")

    # For stream=False, Ollama returns a single JSON object with a "message" field
    try:
        data = response.json()
    except json.JSONDecodeError as exc:
        logger.exception("Invalid JSON from Ollama")
        raise AIError("Invalid response from AI service.") from exc

    message = data.get("message") or {}
    content = message.get("content")
    if not content:
        logger.warning("No 'content' in Ollama response: %s", data)
        raise AIError("AI service returned an empty response.")

    return content.strip()


==================================================
FILE: ./backend/templates/home.html
==================================================

{% extends "base.html" %}

{% block title %}Home | EMS{% endblock %}

{% block extra_head %}
<style>
  /* HERO + QUICK CARD ----------------------------------------------------- */
  .hero-card {
      border-radius: 20px;
      padding: 50px 32px;
      background: linear-gradient(135deg, #6C63FF 0%, #00B4D8 100%);
      color: white;
      box-shadow: 0 12px 30px rgba(0,0,0,0.15);
  }

  .quick-card {
      background: rgba(255, 255, 255, 0.15);
      backdrop-filter: blur(12px);
      border-radius: 20px;
      padding: 20px;
      border: 1px solid rgba(255,255,255,0.3);
  }

  .quick-card p,
  .quick-card strong {
      color: #ffffff !important;
  }

  .hero-title {
      font-size: 2.6rem;
      font-weight: 700;
      letter-spacing: 0.02em;
  }

  .hero-subtitle {
      font-size: 1.1rem;
      opacity: 0.95;
  }

  .pill {
      display: inline-flex;
      align-items: center;
      padding: 4px 12px;
      border-radius: 999px;
      background: rgba(255,255,255,0.15);
      font-size: .8rem;
  }

  /* BUTTON HOVER ----------------------------------------------------------- */
  .btn-lg,
  .btn {
      transition: 0.2s ease;
  }

  .btn-lg:hover,
  .btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 18px rgba(0,0,0,0.18);
  }

  /* SECTION TITLES --------------------------------------------------------- */
  .section-title {
      font-size: 1.6rem;
      font-weight: 700;
      color: #6C63FF;
  }

  /* ROLE CARDS ------------------------------------------------------------- */
  .role-card {
      border-radius: 16px;
      border: none;
      box-shadow: 0 10px 24px rgba(0,0,0,0.06);
  }

  .role-card .card-body {
      display: flex;
      flex-direction: column;
      align-items: center;
      text-align: center;
  }

  .role-icon {
      width: 48px;
      height: 48px;
      border-radius: 50%;
      background: linear-gradient(135deg, #6C63FF, #00B4D8);
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 700;
      font-size: 1.2rem;
      color: white;
      margin-bottom: 12px;
      box-shadow: 0 6px 16px rgba(0, 0, 0, 0.15);
  }

  /* “WHAT IS EMS” + EVENT TYPES ROW --------------------------------------- */
  .event-types-row {
      display: flex;
      align-items: stretch;
      gap: 1.5rem;
  }

  .event-types-text {
      display: flex;
      flex-direction: column;
      justify-content: center;
  }

  .event-types-card {
      border-radius: 18px;
      border: none;
      box-shadow: 0 10px 24px rgba(0,0,0,0.06);
      background: #ffffff;
  }

  .event-types-card .card-body {
      padding: 18px 20px;
  }

  @media (max-width: 991.98px) {
      .event-types-row {
          display: block;
      }
      .event-types-card {
          margin-top: 16px;
      }
  }

  /* EVENT TYPE BADGES ------------------------------------------------------ */
  .event-type-badge {
      padding: 4px 10px;
      font-size: .75rem;
      border-radius: 999px;
      font-weight: 600;
  }
  .badge-exhibition { background:#FFD166; color:#6A5300; }
  .badge-conference { background:#06D6A0; color:#004D3A; }
  .badge-concert    { background:#FF6B6B; color:#680000; }
  .badge-sports     { background:#4DABF7; color:#003E73; }

  /* EVENT CARDS ------------------------------------------------------------ */
  .event-card {
      border-radius: 16px;
      border: none;
      box-shadow: 0 10px 24px rgba(0,0,0,0.05);
      transition: .2s ease;
  }

  .event-card:hover {
      transform: translateY(-4px);
      box-shadow: 0 14px 30px rgba(0,0,0,0.12);
  }
</style>
{% endblock %}

{% block content %}

<!-- HERO ------------------------------------------------------------------->
<div class="hero-card mb-5">
  <div class="row align-items-center">
    <div class="col-lg-7">
      <span class="pill mb-2">All your events in one place</span>
      <h1 class="hero-title mb-3">Discover. Book. Experience.</h1>
      <p class="hero-subtitle mb-4">
        Explore exhibitions, conferences, concerts and sports — all through a single event
        management system. Browse upcoming events, reserve your seat, or manage your own events.
      </p>
      <a href="{% url 'events:event_list' %}" class="btn btn-light btn-lg text-dark me-2">
        Browse Events
      </a>
      {% if user.is_authenticated %}
        <a href="{% url 'chat_page' %}" class="btn btn-outline-light btn-lg">
          Ask the AI Assistant
        </a>
      {% else %}
        <a href="{% url 'register' %}" class="btn btn-outline-light btn-lg">
          Get Started
        </a>
      {% endif %}
    </div>
    <div class="col-lg-5 mt-4 mt-lg-0">
      <div class="quick-card">
        <p class="mb-1"><strong>Quick glance</strong></p>
        <p class="mb-0">
          • Manage different event types<br>
          • Capacity-aware bookings<br>
          • Optional payments for paid events
        </p>
      </div>
    </div>
  </div>
</div>

<!-- ROLES SECTION ---------------------------------------------------------->
<div class="row mb-5 g-4">
  <div class="col-md-6">
    <div class="card role-card h-100">
      <div class="card-body">
        <div class="role-icon">O</div>
        <h5 class="card-title">For organizers</h5>
        <p class="card-text">
          Publish events, define capacity and pricing, and track bookings in one place.
          Perfect for concerts, conferences, sports games, and more.
        </p>
        <ul class="mb-0">
          <li>Create and manage events</li>
          <li>Limit bookings based on capacity</li>
          <li>Track payments for paid events</li>
        </ul>
      </div>
    </div>
  </div>
  <div class="col-md-6">
    <div class="card role-card h-100">
      <div class="card-body">
        <div class="role-icon">P</div>
        <h5 class="card-title">For participants</h5>
        <p class="card-text">
          Discover upcoming events, reserve your seat for free events, or book and pay
          for tickets securely.
        </p>
        <ul class="mb-0">
          <li>Browse all published events</li>
          <li>Book free or paid tickets</li>
          <li>Receive clear event details</li>
        </ul>
      </div>
    </div>
  </div>
</div>

<!-- WHAT IS EMS + EVENT TYPES --------------------------------------------->
<div class="row mb-4 event-types-row">
  <div class="col-lg-8 event-types-text">
    <h2 class="section-title mb-3">What is EMS?</h2>
    <p>
      EMS (Event Management System) is a centralized platform for creating, publishing and
      attending events of different types. It supports exhibitions, academic or industry
      conferences, concerts, and sports games with built-in booking and payment logic.
    </p>
  </div>
  <div class="col-lg-4">
    <div class="card event-types-card">
      <div class="card-body">
        <h6 class="mb-3 text-center">Event Types</h6>
        <p class="mb-2 d-flex align-items-center">
          <span class="event-type-badge badge-exhibition me-2">Exhibition</span>
          <span class="small text-muted mb-0">announcement only</span>
        </p>
        <p class="mb-2 d-flex align-items-center">
          <span class="event-type-badge badge-conference me-2">Conference</span>
          <span class="small text-muted mb-0">free booking</span>
        </p>
        <p class="mb-2 d-flex align-items-center">
          <span class="event-type-badge badge-concert me-2">Concert</span>
          <span class="small text-muted mb-0">paid tickets</span>
        </p>
        <p class="mb-0 d-flex align-items-center">
          <span class="event-type-badge badge-sports me-2">Sports game</span>
          <span class="small text-muted mb-0">paid tickets</span>
        </p>
      </div>
    </div>
  </div>
</div>

<!-- UPCOMING EVENTS -------------------------------------------------------->
<div class="d-flex justify-content-between align-items-center mb-3">
  <h2 class="section-title mb-0">Upcoming Events</h2>
  <a href="{% url 'events:event_list' %}" class="btn btn-outline-primary btn-sm">
    View all events
  </a>
</div>

{% if events %}
  <div class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-4">
    {% for event in events %}
      <div class="col">
        <div class="card event-card h-100">
          <div class="card-body">
            {% if event.venue.type == "Exhibition" %}
              <span class="event-type-badge badge-exhibition">Exhibition</span>
            {% elif event.venue.type == "Conference" %}
              <span class="event-type-badge badge-conference">Conference</span>
            {% elif event.venue.type == "Concert" %}
              <span class="event-type-badge badge-concert">Concert</span>
            {% elif event.venue.type == "Sports" %}
              <span class="event-type-badge badge-sports">Sports</span>
            {% endif %}

            <h5 class="mt-3 mb-1" style="color:#6C63FF;">{{ event.title }}</h5>

            <p class="mb-1 text-muted">
              {{ event.venue.name }} · {{ event.organizer.name }}
            </p>

            {% if event.description %}
              <p class="mb-1">
                {{ event.description|truncatechars:80 }}
              </p>
            {% endif %}

            <p class="mb-1">
              <strong>Starts:</strong> {{ event.start_time|date:"M d, Y H:i" }}
            </p>

            {% if event.ticket_price %}
              <p class="mb-1">
                <strong>Price:</strong> ${{ event.ticket_price }}
              </p>
            {% endif %}

            <a href="{% url 'events:event_detail' event.event_id %}"
               class="btn btn-primary btn-sm mt-2">
              View details
            </a>
          </div>
        </div>
      </div>
    {% endfor %}
  </div>
{% else %}
  <div class="alert alert-info">
    There are no upcoming published events yet. Check back soon or create a new event from the admin panel.
  </div>
{% endif %}

{% endblock %}


==================================================
FILE: ./backend/templates/base.html
==================================================

{% load static %}

<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>{% block title %}Event Management System{% endblock %}</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- Bootstrap -->
  <link
    href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
    rel="stylesheet"
  >

  <style>
    :root {
      --nav-height: 70px;
    }

    /* ---------- THEME TOKENS ---------- */

    body.dark-mode {
      --bg-body: #020617;
      --bg-body-soft: #020617;
      --bg-nav: rgba(15, 23, 42, 0.96);
      --nav-border: rgba(148, 163, 184, 0.28);
      --text-main: #e5e7eb;
      --text-muted: #9ca3af;
      --card-bg: rgba(15, 23, 42, 0.96);
      --card-bg-soft: rgba(15, 23, 42, 0.9);
      --card-border: rgba(148, 163, 184, 0.38);
      --pill-bg: rgba(15, 23, 42, 0.95);
      --pill-active: rgba(59, 130, 246, 0.35);
      --shadow-strong: 0 28px 80px rgba(0, 0, 0, 0.75);
      --shadow-soft: 0 14px 38px rgba(15, 23, 42, 0.85);
    }

    body.light-mode {
      --bg-body: #f3f4f6;
      --bg-body-soft: #f9fafb;
      --bg-nav: rgba(255, 255, 255, 0.92);
      --nav-border: rgba(148, 163, 184, 0.32);
      --text-main: #0f172a;
      --text-muted: #6b7280;
      --card-bg: #ffffff;
      --card-bg-soft: #f9fafb;
      --card-border: rgba(148, 163, 184, 0.35);
      --pill-bg: rgba(255, 255, 255, 0.8);
      --pill-active: rgba(37, 99, 235, 0.12);
      --shadow-strong: 0 24px 70px rgba(15, 23, 42, 0.18);
      --shadow-soft: 0 14px 40px rgba(15, 23, 42, 0.08);
    }

    body {
      min-height: 100vh;
      margin: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background-color: var(--bg-body);
      color: var(--text-main);
      transition: background 0.25s ease, color 0.25s ease;
    }

    body.dark-mode {
      background: radial-gradient(circle at top, #111827, #020617 60%);
    }

    body.light-mode {
      background: radial-gradient(circle at top, #ffffff, #e5e7eb 65%);
    }

    a {
      text-decoration: none;
    }

    a:hover {
      text-decoration: underline;
    }

    /* ---------- NAVBAR ---------- */

    .ems-nav-wrapper {
      position: sticky;
      top: 0;
      z-index: 1100;
      backdrop-filter: blur(18px);
    }

    .ems-nav-shell {
      max-width: 1180px;
      margin: 12px auto 0;
      padding: 8px 14px;
      border-radius: 999px;
      background: var(--bg-nav);
      border: 1px solid var(--nav-border);
      box-shadow: var(--shadow-soft);
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 8px;
      position: relative;
      z-index: 1101;
    }

    .ems-brand {
      display: flex;
      align-items: center;
      gap: 8px;
      flex-shrink: 0;
    }

    .ems-brand-logo {
      width: 34px;
      height: 34px;
      border-radius: 999px;
      background: radial-gradient(circle at 30% 20%, #38bdf8, #4f46e5);
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 700;
      color: #f9fafb;
      font-size: 0.9rem;
      box-shadow: 0 10px 30px rgba(37, 99, 235, 0.4);
    }

    .ems-brand-text {
      font-weight: 600;
      font-size: 0.98rem;
      color: var(--text-main);
      white-space: nowrap;
    }

    .ems-nav-links {
      display: flex;
      align-items: center;
      gap: 4px;
      flex: 1;
      justify-content: center;
    }

    .ems-nav-link {
      position: relative;
      padding: 6px 16px;
      border-radius: 999px;
      font-size: 0.88rem;
      font-weight: 500;
      color: var(--text-muted);
      border: 1px solid transparent;
      white-space: nowrap;
    }

    .ems-nav-link:hover {
      text-decoration: none;
      background: var(--pill-bg);
      border-color: rgba(148, 163, 184, 0.35);
      color: var(--text-main);
    }

    .ems-nav-link.active {
      background: var(--pill-active);
      border-color: rgba(129, 140, 248, 0.7);
      color: #f9fafb;
      box-shadow: 0 10px 30px rgba(37, 99, 235, 0.35);
    }

    body.light-mode .ems-nav-link.active {
      color: #0f172a;
    }

    .ems-right {
      display: flex;
      align-items: center;
      gap: 10px;
      flex-shrink: 0;
      position: relative;
      z-index: 1102;
    }

    /* Theme toggle */
    .theme-toggle {
      width: 34px;
      height: 34px;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.5);
      display: flex;
      align-items: center;
      justify-content: center;
      background: radial-gradient(circle at 30% 20%, #f97316, #eab308);
      color: #020617;
      cursor: pointer;
      box-shadow: 0 10px 30px rgba(250, 204, 21, 0.45);
      font-size: 1rem;
    }

    body.dark-mode .theme-toggle {
      background: radial-gradient(circle at 30% 20%, #0f172a, #020617);
      color: #e5e7eb;
      box-shadow: 0 10px 30px rgba(15, 23, 42, 0.8);
    }

    /* User menu */

    .user-pill {
      display: flex;
      align-items: center;
      gap: 6px;
      padding: 4px 10px 4px 4px;
      border-radius: 999px;
      background: var(--pill-bg);
      border: 1px solid rgba(148, 163, 184, 0.45);
      cursor: pointer;
    }

    .user-avatar {
      width: 28px;
      height: 28px;
      border-radius: 999px;
      background: radial-gradient(circle at 30% 20%, #38bdf8, #4f46e5);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.8rem;
      color: #f9fafb;
      font-weight: 600;
      text-transform: uppercase;
    }

    .user-name {
      font-size: 0.85rem;
      color: var(--text-main);
      max-width: 120px;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }

    .user-caret {
      font-size: 0.7rem;
      color: var(--text-muted);
    }

    .user-menu {
      position: absolute;
      right: 0;
      top: calc(100% + 10px);
      background: var(--card-bg);
      border-radius: 16px;
      border: 1px solid var(--card-border);
      box-shadow: var(--shadow-strong);
      padding: 8px 0;
      min-width: 180px;
      display: none;
      z-index: 2000;  /* ensure above cards on profile page */
    }

    .user-menu.show {
      display: block;
    }

    .user-menu a {
      display: block;
      padding: 8px 14px;
      font-size: 0.88rem;
      color: var(--text-main);
    }

    .user-menu a:hover {
      background: rgba(37, 99, 235, 0.16);
      text-decoration: none;
    }

    /* Login btn when not authenticated */
    .login-btn {
      padding: 6px 16px;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.6);
      background: var(--pill-bg);
      color: var(--text-main);
      font-size: 0.9rem;
    }

    .login-btn:hover {
      background: rgba(37, 99, 235, 0.15);
      text-decoration: none;
    }

    /* ---------- PAGE LAYOUT ---------- */

    main.ems-main {
      max-width: 1180px;
      margin: 16px auto 32px;
      padding-inline: 16px;
      min-height: calc(100vh - var(--nav-height) - 80px);
    }

    .ems-footer {
      text-align: center;
      padding: 16px 0 24px;
      font-size: 0.8rem;
      color: var(--text-muted);
      opacity: 0.9;
    }

    /* ---------- GENERIC CARDS / HERO ---------- */

    .hero-banner {
      border-radius: 30px;
      padding: 24px 28px;
      background: linear-gradient(135deg, #4f46e5, #06b6d4);
      color: #f9fafb;
      box-shadow: var(--shadow-strong);
    }

    .hero-kicker {
      font-size: 0.75rem;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      opacity: 0.9;
    }

    .hero-title {
      font-size: 1.9rem;
      font-weight: 700;
      margin-bottom: 4px;
    }

    .hero-subtitle {
      font-size: 0.95rem;
      opacity: 0.95;
    }

    .section-card,
    .glass-card {
      border-radius: 22px;
      padding: 18px 20px;
      background: var(--card-bg);
      border: 1px solid var(--card-border);
      box-shadow: var(--shadow-soft);
      color: var(--text-main);
    }

    .section-title {
      font-size: 1.1rem;
      font-weight: 600;
      margin-bottom: 4px;
    }

    .section-subtitle {
      font-size: 0.88rem;
      color: var(--text-muted);
    }

    .kpi-card {
      border-radius: 18px;
      padding: 16px 18px;
      background: var(--card-bg-soft);
      border: 1px solid rgba(148, 163, 184, 0.5);
      box-shadow: 0 18px 40px rgba(15, 23, 42, 0.75);
    }

    .kpi-label {
      font-size: 0.8rem;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      color: var(--text-muted);
    }

    .kpi-value {
      font-size: 1.3rem;
      font-weight: 600;
    }

    .kpi-note {
      font-size: 0.78rem;
      color: var(--text-muted);
    }

    /* ---------- BUTTON TWEAKS ---------- */

    .btn-primary {
      border-radius: 999px;
      padding-inline: 18px;
    }

    .btn-outline-light {
      border-radius: 999px;
      padding-inline: 18px;
    }

    /* Ensure outline-light is visible in light mode */
    body.light-mode .btn-outline-light {
      border-color: rgba(15, 23, 42, 0.4);
      color: #0f172a;
      background-color: rgba(255, 255, 255, 0.95);
    }

    body.light-mode .btn-outline-light:hover {
      background-color: #0f172a;
      color: #f9fafb;
      border-color: #0f172a;
    }

    /* ---------- TEXT VISIBILITY HELPERS ---------- */

    .text-muted-soft {
      color: var(--text-muted) !important;
    }

    /* For sections that were too faint in light mode (e.g. analytics "Last 6 months") */
    body.light-mode .analytics-muted {
      color: #374151 !important;
      opacity: 0.9;
    }

    body.dark-mode .analytics-muted {
      color: #9ca3af !important;
    }

    /* ---------- RESPONSIVE ---------- */

    @media (max-width: 768px) {
      .ems-nav-shell {
        border-radius: 20px;
        padding-inline: 10px;
      }

      .ems-nav-links {
        display: none;  /* keep simple for now on mobile */
      }

      .ems-brand-text {
        display: none;
      }

      main.ems-main {
        padding-inline: 12px;
      }
    }
  </style>

  {% block extra_head %}{% endblock %}
</head>
<body>
<script>
(function() {
    const cookies = Object.fromEntries(document.cookie.split("; ").map(v => v.split("=")));
    const theme = cookies.theme || "dark-mode";
    document.body.classList.add(theme);
})();
</script>
  <!-- NAVBAR -->
  <header class="ems-nav-wrapper">
    <div class="ems-nav-shell">
      <div class="ems-brand">
        <div class="ems-brand-logo">EMS</div>
        <div class="ems-brand-text">Event Management System</div>
      </div>

      <nav class="ems-nav-links">
        <a href="{% url 'home' %}"
           class="ems-nav-link {% if request.resolver_match.url_name == 'home' %}active{% endif %}">
          Home
        </a>

        <a href="{% url 'events:event_list' %}"
           class="ems-nav-link {% if request.resolver_match.namespace == 'events' and request.resolver_match.url_name == 'event_list' %}active{% endif %}">
          Events
        </a>

        {# Manage / Become organizer in main nav #}
        {% if user.is_authenticated %}
          {% if user.userprofile.organizer %}
            <a href="{% url 'events:manage_events' %}"
               class="ems-nav-link {% if request.resolver_match.namespace == 'events' and request.resolver_match.url_name|slice:':6' == 'manage' %}active{% endif %}">
              Manage
            </a>
          {% else %}
            <a href="{% url 'accounts:become_organizer' %}"
               class="ems-nav-link {% if request.resolver_match.namespace == 'accounts' and request.resolver_match.url_name == 'become_organizer' %}active{% endif %}">
              Become organizer
            </a>
          {% endif %}
        {% endif %}

        <a href="{% url 'chat_page' %}"
           class="ems-nav-link {% if request.resolver_match.url_name == 'chat_page' %}active{% endif %}">
          AI Assistant
        </a>

        {% if user.is_authenticated %}
          <a href="{% url 'bookings:my_bookings' %}"
             class="ems-nav-link {% if request.resolver_match.namespace == 'bookings' and request.resolver_match.url_name == 'my_bookings' %}active{% endif %}">
            My Bookings
          </a>
        {% endif %}
      </nav>

      <div class="ems-right">
        <!-- Theme toggle -->
        <button id="themeToggle" class="theme-toggle" type="button" aria-label="Toggle theme">
          🌙
        </button>

        {% if user.is_authenticated %}
          <!-- User dropdown -->
          <div class="position-relative">
            <div class="user-pill" id="userMenuToggle">
              <div class="user-avatar">
                {{ user.username|first|upper }}
              </div>
              <div class="user-name">Hi, {{ user.username }}</div>
              <div class="user-caret">▾</div>
            </div>
            <div class="user-menu" id="userMenu">
              <a href="{% url 'accounts:profile' %}">Profile</a>

              {% if user.userprofile.organizer %}
                <a href="{% url 'events:manage_events' %}">Organizer dashboard</a>
              {% else %}
                <a href="{% url 'accounts:become_organizer' %}">Become organizer</a>
              {% endif %}

              <a href="{% url 'logout' %}">Logout</a>
            </div>
          </div>
        {% else %}
          <a href="{% url 'login' %}" class="login-btn">Login</a>
        {% endif %}
      </div>
    </div>
  </header>

  <!-- MAIN CONTENT -->
  <main class="ems-main">
    {% block content %}{% endblock %}
  </main>

  <footer class="ems-footer">
    © Event Management System
  </footer>

  <!-- Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

  <script>
    // ---------- THEME TOGGLE ----------
    (function () {
      const body = document.body;
      const toggle = document.getElementById("themeToggle");

      function setTheme(mode) {
        body.classList.remove("light-mode", "dark-mode");
        body.classList.add(mode);
        document.cookie = "theme=" + mode + ";path=/;max-age=31536000";
        if (mode === "dark-mode") {
          toggle.textContent = "🌙";
        } else {
          toggle.textContent = "☀️";
        }
      }

      // initial from body class
      toggle.addEventListener("click", function () {
        if (body.classList.contains("dark-mode")) {
          setTheme("light-mode");
        } else {
          setTheme("dark-mode");
        }
      });
    })();

    // ---------- USER MENU ----------
    (function () {
      const toggle = document.getElementById("userMenuToggle");
      const menu = document.getElementById("userMenu");
      if (!toggle || !menu) return;

      toggle.addEventListener("click", function (e) {
        e.stopPropagation();
        menu.classList.toggle("show");
      });

      document.addEventListener("click", function () {
        menu.classList.remove("show");
      });
    })();
  </script>

  {% block extra_js %}{% endblock %}
</body>
</html>


==================================================
FILE: ./backend/templates/admin_base.html
==================================================

{% load static %}

<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <title>{% block title %}Admin | EMS{% endblock %}</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" 
          rel="stylesheet">

    <style>
        .admin-navbar {
            background: #0f172a;
            border-bottom: 1px solid rgba(255,255,255,0.08);
            padding: 12px 0;
        }
        .admin-navbar a {
            color: #e2e8f0 !important;
            font-weight: 500;
            margin-right: 18px;
        }
        .admin-navbar a:hover {
            color: white !important;
        }
    </style>

    {% block extra_head %}{% endblock %}
</head>

<body style="background:#0b1120; color:white;">

    <!-- ADMIN NAVBAR -->
    <nav class="admin-navbar">
        <div class="container d-flex justify-content-between align-items-center">

            <div>
                <a href="{% url 'admin_dashboard' %}" class="navbar-brand fw-semibold">
                    EMS Admin Panel
                </a>

                <a href="{% url 'admin_dashboard' %}">Dashboard</a>
                <a href="{% url 'admin_organizers' %}">Organizers</a>
                <a href="{% url 'admin_events' %}">Events</a>
                <a href="{% url 'admin_venues' %}">Venues</a>
                <a href="{% url 'admin_customers' %}">Customers</a>
                <a href="{% url 'admin_bookings' %}">Bookings</a>
                <a href="{% url 'admin_payments' %}">Payments</a>
            </div>

            <div>
                <span class="me-3 text-muted">
                    Logged in as <strong>{{ admin.username }}</strong>
                </span>
                <!--<a href="{% url 'admin_logout' %}" class="btn btn-danger btn-sm">
                    Logout
                </a>-->
            </div>
        </div>
    </nav>

    <main>
        {% block content %}{% endblock %}
    </main>

</body>
</html>


==================================================
FILE: ./backend/templates/customers/admin_customer_list.html
==================================================

{% extends "admin_base.html" %}

{% block title %}Customers (Admin) | EMS{% endblock %}

{% block extra_head %}
<style>
  .admin-hero {
      border-radius: 18px;
      padding: 22px 24px;
      background: linear-gradient(135deg, #6C63FF 0%, #00B4D8 100%);
      color: white;
      box-shadow: 0 10px 26px rgba(0,0,0,0.16);
      margin-bottom: 24px;
  }
  .admin-hero-title {
      font-size: 1.6rem;
      font-weight: 600;
  }
  .admin-hero-subtitle {
      font-size: 0.95rem;
      opacity: 0.95;
  }
</style>
{% endblock %}

{% block content %}

<div class="admin-hero">
  <div class="d-flex flex-column flex-md-row justify-content-between align-items-md-center">
    <div class="mb-3 mb-md-0">
      <div class="admin-hero-title mb-1">
        Customers
      </div>
      <div class="admin-hero-subtitle">
        Manage all participants registered in the system, including profile and full
        contact information.
      </div>
    </div>
    <div class="text-md-end">
      <a href="{% url 'admin_dashboard' %}" class="btn btn-light btn-sm text-dark me-2">
        Back to admin dashboard
      </a>
      <a href="{% url 'admin_customer_create' %}" class="btn btn-outline-light btn-sm">
        + New customer
      </a>
    </div>
  </div>
</div>

<div class="card shadow-sm">
  <div class="card-body">
    {% if customers %}
      <div class="table-responsive">
        <table class="table table-hover table-sm align-middle">
          <thead class="table-light">
            <tr>
              <th>Name</th>
              <th>Email</th>
              <th>Address</th>
              <th>City</th>
              <th>State</th>
              <th>Zip</th>
              <th>Country</th>
              <th>Phone</th>
              <th>DOB</th>
              <th class="text-end">Actions</th>
            </tr>
          </thead>
          <tbody>
            {% for customer in customers %}
              <tr>
                <td>{{ customer.name }}</td>
                <td>{{ customer.email }}</td>
                <td>
                  {% if customer.address %}
                    {{ customer.address }}
                  {% else %}
                    <span class="text-muted small">—</span>
                  {% endif %}
                </td>
                <td>{{ customer.city|default_if_none:"—" }}</td>
                <td>{{ customer.state|default_if_none:"—" }}</td>
                <td>{{ customer.zipcode|default_if_none:"—" }}</td>
                <td>{{ customer.country|default_if_none:"—" }}</td>
                <td>{{ customer.phone|default_if_none:"—" }}</td>
                <td>
                  {% if customer.dob %}
                    {{ customer.dob|date:"M d, Y" }}
                  {% else %}
                    <span class="text-muted small">—</span>
                  {% endif %}
                </td>
                <td class="text-end">
                  <a href="{% url 'admin_customer_edit' customer.customer_id %}"
                     class="btn btn-sm btn-outline-secondary me-1">
                    Edit
                  </a>
                  <a href="{% url 'admin_customer_delete' customer.customer_id %}"
                     class="btn btn-sm btn-outline-danger">
                    Delete
                  </a>
                </td>
              </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    {% else %}
      <p class="text-muted mb-0">
        No customers found yet.
      </p>
    {% endif %}
  </div>
</div>

{% endblock %}


==================================================
FILE: ./backend/templates/customers/admin_customer_form.html
==================================================

{% extends "admin_base.html" %}

{% block title %}
  {% if mode == "edit" %}Edit Customer | EMS{% else %}New Customer | EMS{% endif %}
{% endblock %}

{% block extra_head %}
<style>
  .customer-form-shell {
      max-width: 800px;
      margin: 0 auto;
  }
  .customer-form-card {
      border-radius: 26px;
      border: 1px solid rgba(148, 163, 184, 0.45);
      padding: 0;
      overflow: hidden;
      box-shadow: 0 26px 60px rgba(15, 23, 42, 0.8);
      background: radial-gradient(circle at top left, rgba(30, 64, 175, 0.55), #020617);
      color: #e5e7eb;
  }
  .customer-form-header {
      padding: 18px 24px;
      background: linear-gradient(135deg, #0ea5e9, #22c55e);
      color: #f9fafb;
  }
  .customer-form-body {
      padding: 22px 24px 22px;
  }
  .customer-form-body input {
      background-color: rgba(15, 23, 42, 0.9) !important;
      border: 1px solid rgba(148, 163, 184, 0.6) !important;
      color: #f9fafb !important;
      border-radius: 12px;
  }
  .customer-form-body input:focus {
      outline: none;
      box-shadow: 0 0 0 1px #0ea5e9;
      border-color: #0ea5e9 !important;
  }
  .customer-form-footer {
      padding: 16px 24px 22px;
      border-top: 1px solid rgba(31, 41, 55, 0.9);
      display: flex;
      justify-content: space-between;
      align-items: center;
  }
</style>
{% endblock %}

{% block content %}
<div class="container py-4">
  <div class="customer-form-shell">
    <div class="customer-form-card">
      <div class="customer-form-header d-flex justify-content-between align-items-center">
        <div>
          <h2 class="h5 mb-1">
            {% if mode == "edit" %}Edit customer{% else %}Create customer{% endif %}
          </h2>
          <p class="mb-0" style="font-size:0.9rem;">
            Manage participant identity and contact details stored in the CUSTOMER table.
          </p>
        </div>
        <div>
          <a href="{% url 'admin_customers' %}" class="btn btn-outline-light btn-sm">
            Back to customers
          </a>
        </div>
      </div>

      <form method="post" novalidate>
        {% csrf_token %}
        <div class="customer-form-body">
          {% for field in form %}
            <div class="mb-3">
              <label class="form-label" for="{{ field.id_for_label }}">
                {{ field.label }}{% if field.field.required %}<span class="text-danger">*</span>{% endif %}
              </label>
              {{ field }}
              {% if field.help_text %}
                <div class="form-text text-muted">{{ field.help_text }}</div>
              {% endif %}
              {% for error in field.errors %}
                <div class="text-danger small mt-1">{{ error }}</div>
              {% endfor %}
            </div>
          {% endfor %}

          {% if form.non_field_errors %}
            <div class="alert alert-danger">
              {{ form.non_field_errors }}
            </div>
          {% endif %}
        </div>

        <div class="customer-form-footer">
          <small class="text-muted">
            Changes apply only to this customer record in the database.
          </small>
          <div>
            <a href="{% url 'admin_customers' %}" class="btn btn-outline-light me-2">
              Cancel
            </a>
            <button type="submit" class="btn btn-primary">
              {% if mode == "edit" %}Save changes{% else %}Create customer{% endif %}
            </button>
          </div>
        </div>
      </form>
    </div>
  </div>
</div>
{% endblock %}


==================================================
FILE: ./backend/templates/customers/admin_customer_confirm_delete.html
==================================================

{% extends "admin_base.html" %}

{% block title %}Delete Customer | EMS{% endblock %}

{% block content %}
<div class="container py-4">
  <div class="card shadow-sm" style="max-width: 720px; margin: 0 auto;">
    <div class="card-body">
      <h3 class="h5 mb-3">Delete customer</h3>
      <p>
        Are you sure you want to permanently delete the customer
        <strong>{{ customer.name }}</strong> ({{ customer.email }})?
      </p>
      <p class="text-muted small">
        This will not automatically remove existing bookings or payments linked
        to this customer record; it will simply delete the CUSTOMER row.
      </p>

      <form method="post" class="mt-3">
        {% csrf_token %}
        <a href="{% url 'admin_customers' %}" class="btn btn-secondary">
          Cancel
        </a>
        <button type="submit" class="btn btn-danger ms-2">
          Yes, delete customer
        </button>
      </form>
    </div>
  </div>
</div>
{% endblock %}


==================================================
FILE: ./backend/templates/chat/chat_page.html
==================================================

{% extends "base.html" %}

{% block title %}AI Assistant | EMS{% endblock %}

{% block extra_head %}
<style>
  .chat-hero {
      border-radius: 18px;
      padding: 22px 24px;
      background: linear-gradient(135deg, #6C63FF 0%, #00B4D8 100%);
      color: white;
      box-shadow: 0 10px 26px rgba(0,0,0,0.16);
      margin-bottom: 16px;
  }

  .chat-hero-title {
      font-size: 1.6rem;
      font-weight: 600;
  }

  .chat-hero-subtitle {
      font-size: 0.95rem;
      opacity: 0.95;
  }

  .chat-layout {
      display: grid;
      grid-template-rows: 1fr auto;
      height: calc(100vh - 230px); /* tweak if needed */
      max-height: 700px;
      border-radius: 18px;
      background: #ffffff;
      box-shadow: 0 10px 24px rgba(0,0,0,0.06);
      overflow: hidden;
  }

  .chat-messages {
      padding: 16px 18px;
      overflow-y: auto;
      background: #f8f9fa;
  }

  .chat-input-area {
      border-top: 1px solid #dee2e6;
      padding: 12px 14px;
      background: #ffffff;
  }

  .bubble-row {
      display: flex;
      margin-bottom: 10px;
  }

  .bubble-user {
      margin-left: auto;
      max-width: 70%;
      background: #6C63FF;
      color: #ffffff;
      border-radius: 16px 16px 4px 16px;
      padding: 8px 12px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.12);
      font-size: 0.9rem;
  }

  .bubble-assistant {
      margin-right: auto;
      max-width: 70%;
      background: #ffffff;
      color: #212529;
      border-radius: 16px 16px 16px 4px;
      padding: 8px 12px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.08);
      font-size: 0.9rem;
  }

  .bubble-meta {
      font-size: 0.75rem;
      color: #6c757d;
      margin-bottom: 2px;
  }

  .chat-input {
      resize: none;
      width: 100%;
      font-size: 0.95rem;
  }

  .chat-helper {
      font-size: 0.8rem;
      color: #6c757d;
  }

  .btn-send {
      white-space: nowrap;
  }

  .chat-placeholder {
      color: #6c757d;
      font-size: 0.9rem;
  }
</style>
{% endblock %}

{% block content %}

<!-- HERO --------------------------------------------------------------- -->
<div class="chat-hero">
  <div class="d-flex flex-column flex-md-row justify-content-between align-items-md-center">
    <div class="mb-3 mb-md-0">
      <div class="chat-hero-title mb-1">
        AI Assistant
      </div>
      <div class="chat-hero-subtitle">
        Ask questions about events, bookings and the EMS features in natural language.
        The assistant can combine your questions with data from the system.
      </div>
    </div>
    <div class="text-md-end small">
      <div>Examples you can try:</div>
      <ul class="mb-0">
        <li>“What concerts are available this month?”</li>
        <li>“Which events are free to attend?”</li>
        <li>“How many bookings do my events have?” (organizer)</li>
      </ul>
    </div>
  </div>
</div>

<!-- CHAT LAYOUT -------------------------------------------------------- -->
<div class="chat-layout">
  <!-- Messages -->
  <div class="chat-messages" id="chat-messages">
    <p class="chat-placeholder" id="chat-placeholder">
      Start the conversation by asking a question about events, bookings or how the system works.
    </p>
  </div>

  <!-- Input form -->
  <div class="chat-input-area">
    <form id="chat-form" class="d-flex align-items-end gap-2">
      <div class="flex-grow-1">
        <textarea id="chat-input"
                  class="form-control chat-input"
                  rows="2"
                  placeholder="Ask me anything about your events, bookings or EMS features..."></textarea>
        <div class="chat-helper mt-1">
          The assistant can combine your question with data from the EMS database
          (events, bookings, venues, organizers) when appropriate.
        </div>
      </div>
      <div>
        <button type="submit" class="btn btn-primary btn-send" id="chat-send-btn">
          Send
        </button>
      </div>
    </form>
  </div>
</div>

<script>
  document.addEventListener("DOMContentLoaded", function () {
      const form = document.getElementById("chat-form");
      const input = document.getElementById("chat-input");
      const messagesContainer = document.getElementById("chat-messages");
      const sendBtn = document.getElementById("chat-send-btn");
      const placeholder = document.getElementById("chat-placeholder");

      function scrollToBottom() {
          messagesContainer.scrollTop = messagesContainer.scrollHeight;
      }

      function addBubble(role, text) {
          if (placeholder) {
              placeholder.remove();
          }

          const row = document.createElement("div");
          row.classList.add("bubble-row");

          const bubble = document.createElement("div");
          const meta = document.createElement("div");
          meta.classList.add("bubble-meta");

          if (role === "user") {
              bubble.classList.add("bubble-user");
              meta.classList.add("text-end");
              meta.textContent = "You";
          } else {
              bubble.classList.add("bubble-assistant");
              meta.textContent = "Assistant";
          }

          bubble.appendChild(meta);

          const body = document.createElement("div");
          body.innerText = text;
          bubble.appendChild(body);

          row.appendChild(bubble);
          messagesContainer.appendChild(row);
          scrollToBottom();
      }

      form.addEventListener("submit", function (e) {
          e.preventDefault();

          const message = input.value.trim();
          if (!message) {
              return;
          }

          // Show user message immediately
          addBubble("user", message);

          // Clear input & disable while waiting
          input.value = "";
          input.disabled = true;
          sendBtn.disabled = true;

          fetch("{% url 'chat_api' %}", {
              method: "POST",
              headers: {
                  "Content-Type": "application/json"
              },
              body: JSON.stringify({ message: message })
          })
          .then(response => response.json())
          .then(data => {
              if (data.reply) {
                  addBubble("assistant", data.reply);
              } else if (data.error) {
                  addBubble("assistant", "Error: " + data.error);
              } else {
                  addBubble("assistant", "Sorry, I didn't receive a valid reply from the server.");
              }
          })
          .catch(err => {
              addBubble("assistant", "An error occurred while contacting the AI backend.");
          })
          .finally(() => {
              input.disabled = false;
              sendBtn.disabled = false;
              input.focus();
          });
      });

      // Optional: submit on Ctrl+Enter
      input.addEventListener("keydown", function (e) {
          if (e.key === "Enter" && !e.shiftKey) {
              e.preventDefault();
              form.dispatchEvent(new Event("submit"));
          }
      });
  });
</script>

{% endblock %}


==================================================
FILE: ./backend/templates/bookings/booking_receipt.html
==================================================

{% extends "base.html" %}

{% block title %}Booking Receipt | EMS{% endblock %}

{% block extra_head %}
<style>
  .hero-card {
    border-radius: 20px;
    padding: 22px 26px;
    background: linear-gradient(135deg, #6C63FF 0%, #00B4D8 100%);
    color: #fff;
    box-shadow: 0 10px 24px rgba(0,0,0,0.15);
  }

  .hero-title {
    font-size: 1.8rem;
    font-weight: 700;
  }

  .receipt-card {
    max-width: 720px;
    margin: 0 auto;
    border-radius: 16px;
    border: none;
    box-shadow: 0 10px 28px rgba(0,0,0,0.08);
  }

  .receipt-label {
    font-size: 0.8rem;
    text-transform: uppercase;
    letter-spacing: 0.08em;
    color: #6c757d;
  }

  .receipt-value {
    font-weight: 500;
  }

  @media print {
    nav, footer, .btn-print, .navbar, .alert {
      display: none !important;
    }
    body {
      background: #ffffff !important;
    }
    .receipt-card {
      box-shadow: none !important;
      border: 1px solid #dee2e6;
    }
  }
</style>
{% endblock %}

{% block content %}

<div class="hero-card mb-4">
  <div class="d-flex justify-content-between align-items-center">
    <div>
      <h1 class="hero-title mb-1">Booking Receipt</h1>
      <p class="mb-0">
        Confirmation for your reservation in
        <strong>{{ booking.event.title }}</strong>.
      </p>
    </div>
    <div class="text-end">
      <span class="badge bg-light text-dark">
        #{{ booking.booking_id }}
      </span>
      <div class="small mt-1">
        Booked on {{ booking.booked_at|date:"M d, Y · H:i" }}
      </div>
    </div>
  </div>
</div>

<div class="card receipt-card mb-4">
  <div class="card-body">
    {# Event info #}
    <div class="mb-3">
      <div class="receipt-label">Event</div>
      <div class="receipt-value">
        {{ booking.event.title }}
      </div>
      <div class="text-muted small">
        {{ booking.event.venue.name }}
        · {{ booking.event.get_event_type_display }}<br>
        {% if booking.event.venue.address %}
          {{ booking.event.venue.address }}<br>
        {% endif %}
        {% if booking.event.venue.city or booking.event.venue.state or booking.event.venue.zipcode %}
          {% if booking.event.venue.city %}{{ booking.event.venue.city }}{% endif %}
          {% if booking.event.venue.city and booking.event.venue.state %}, {% endif %}
          {% if booking.event.venue.state %}{{ booking.event.venue.state }}{% endif %}
          {% if booking.event.venue.zipcode %} {{ booking.event.venue.zipcode }}{% endif %}<br>
        {% endif %}
        {% if booking.event.venue.country %}{{ booking.event.venue.country }}<br>{% endif %}
        {{ booking.event.start_time|date:"M d, Y · H:i" }}
      </div>
    </div>

    <hr>

    {# Participant info #}
    <div class="row mb-3">
      <div class="col-md-6">
        <div class="receipt-label">Participant</div>
        <div class="receipt-value">
          {{ booking.customer.name }}
        </div>
        <div class="text-muted small">
          {{ booking.customer.email }}<br>
          {% if booking.customer.phone %}
            {{ booking.customer.phone }}<br>
          {% endif %}
          {% if booking.customer.dob %}
            DOB: {{ booking.customer.dob|date:"M d, Y" }}<br>
          {% endif %}
          {% if booking.customer.address or booking.customer.city or booking.customer.state
                or booking.customer.zipcode or booking.customer.country %}
            {% if booking.customer.address %}{{ booking.customer.address }}<br>{% endif %}
            {% if booking.customer.city or booking.customer.state or booking.customer.zipcode %}
              {% if booking.customer.city %}{{ booking.customer.city }}{% endif %}
              {% if booking.customer.city and booking.customer.state %}, {% endif %}
              {% if booking.customer.state %}{{ booking.customer.state }}{% endif %}
              {% if booking.customer.zipcode %} {{ booking.customer.zipcode }}{% endif %}<br>
            {% endif %}
            {% if booking.customer.country %}{{ booking.customer.country }}{% endif %}
          {% endif %}
        </div>
      </div>
      <div class="col-md-6 mt-3 mt-md-0">
        <div class="receipt-label">Booking status</div>
        <div class="receipt-value">
          {{ booking.status }}
        </div>
        <div class="text-muted small">
          Tickets: {{ booking.ticket_qty }}
        </div>
      </div>
    </div>

    <hr>

    {# Payment info #}
    <div class="row mb-3">
      <div class="col-md-6">
        <div class="receipt-label">Ticket price</div>
        <div class="receipt-value">
          {% if booking.unit_price and booking.unit_price > 0 %}
            ${{ booking.unit_price }}
          {% else %}
            Free
          {% endif %}
        </div>
      </div>
      <div class="col-md-6 mt-3 mt-md-0">
        <div class="receipt-label">Total amount</div>
        <div class="receipt-value">
          {% if booking.total_price and booking.total_price > 0 %}
            ${{ booking.total_price }}
          {% else %}
            Free
          {% endif %}
        </div>
      </div>
    </div>

    {% if payment %}
      <div class="row mb-3">
        <div class="col-md-6">
          <div class="receipt-label">Payment method</div>
          <div class="receipt-value">
            {{ payment.get_method_display }}
          </div>
          {% if payment.card_details %}
            <div class="text-muted small">
              {{ payment.card_details }}
            </div>
          {% endif %}
        </div>
        <div class="col-md-6 mt-3 mt-md-0">
          <div class="receipt-label">Paid at</div>
          <div class="receipt-value">
            {{ payment.paid_at|date:"M d, Y · H:i" }}
          </div>
        </div>
      </div>
    {% endif %}

    <hr>

    <div class="small text-muted">
      This receipt confirms your booking in the Event Management System.
      Please keep it for your records or bring a printed copy when attending
      the event.
    </div>
  </div>

  <div class="card-footer d-flex justify-content-between">
    <a href="{% url 'bookings:my_bookings' %}" class="btn btn-outline-secondary btn-sm">
      Back to my bookings
    </a>
    <button type="button" class="btn btn-primary btn-sm btn-print"
            onclick="window.print()">
      Print receipt
    </button>
  </div>
</div>

{% endblock %}


==================================================
FILE: ./backend/templates/bookings/booking_cancel_confirm.html
==================================================

{% extends "base.html" %}

{% block title %}Cancel Booking | EMS{% endblock %}

{% block content %}
<div class="card-surface">
  <h3 class="mb-3">Cancel booking</h3>

  <p>Are you sure you want to cancel your booking for:</p>

  <h4>{{ booking.event.title }}</h4>
  <p><strong>Date:</strong> {{ booking.event.start_time|date:"M d, Y g:i A" }}</p>
  <p><strong>Venue:</strong> {{ booking.event.venue.name }}</p>
  <p><strong>Tickets:</strong> {{ booking.ticket_qty }}</p>
  <p><strong>Total paid:</strong> ${{ booking.total_price }}</p>

  <form method="post" class="mt-3">
    {% csrf_token %}
    <button type="submit" class="btn btn-danger">Yes, cancel this booking</button>
    <a href="{% url 'bookings:my_bookings' %}" class="btn btn-secondary ms-2">
      No, go back
    </a>
  </form>
</div>
{% endblock %}


==================================================
FILE: ./backend/templates/bookings/book_event.html
==================================================

{% extends "base.html" %}

{% block title %}Book: {{ event.title }} | EMS{% endblock %}

{% block extra_head %}
<style>
    .booking-layout {
        gap: 1.5rem;
    }
    .booking-summary-card,
    .booking-form-card {
        border-radius: 16px;
        border: none;
        box-shadow: 0 10px 20px rgba(0,0,0,0.06);
    }
    .booking-summary-card {
        background: linear-gradient(135deg, #6C63FF 0%, #00B4D8 100%);
        color: #fff;
    }
    .badge-event {
        padding: 6px 10px;
        border-radius: 8px;
        font-size: 0.75rem;
        font-weight: 600;
    }
    .badge-exhibition { background: #FFD166; color: #6A5300; }
    .badge-conference { background: #06D6A0; color: #004D3A; }
    .badge-concert    { background: #FF6B6B; color: #680000; }
    .badge-sports     { background: #4DABF7; color: #003E73; }
</style>
{% endblock %}

{% block content %}
<h1 class="mb-4" style="color:#6C63FF;">Book: {{ event.title }}</h1>

<div class="row booking-layout">
    <!-- Summary -->
    <div class="col-lg-4 mb-4">
        <div class="card booking-summary-card h-100">
            <div class="card-body">
                {% if event_type == "Exhibition" %}
                    <span class="badge-event badge-exhibition">Exhibition</span>
                {% elif event_type == "Conference" %}
                    <span class="badge-event badge-conference">Conference</span>
                {% elif event_type == "Concert" %}
                    <span class="badge-event badge-concert">Concert</span>
                {% elif event_type == "Sports Game" %}
                    <span class="badge-event badge-sports">Sports Game</span>
                {% endif %}

                <h5 class="mt-3 mb-2">{{ event.title }}</h5>
                <p class="mb-1"><strong>Venue:</strong> {{ event.venue.name }}</p>
                <p class="mb-1">
                    <strong>Starts:</strong>
                    {{ event.start_time|date:"M d, Y g:i A" }}
                </p>

                {% if remaining_capacity is not None %}
                    <p class="mb-1">
                        <strong>Remaining capacity:</strong> {{ remaining_capacity }}
                    </p>
                {% else %}
                    <p class="mb-1">
                        <strong>Capacity:</strong> Unlimited / not specified
                    </p>
                {% endif %}

                {% if is_paid_event %}
                    <p class="mb-0">
                        <strong>Price per ticket:</strong> ${{ event.ticket_price }}
                    </p>
                {% else %}
                    <p class="mb-0">
                        <strong>Ticket price:</strong> Free
                    </p>
                {% endif %}
            </div>
        </div>
    </div>

    <!-- Form -->
    <div class="col-lg-8 mb-4">
        <div class="card booking-form-card">
            <div class="card-body">
                <h5 class="card-title mb-3">
                    {% if is_paid_event %}Booking & Payment{% else %}Booking Details{% endif %}
                </h5>

                <form method="post">
                    {% csrf_token %}
                    {{ form.as_p }}
                    <button type="submit" class="btn btn-primary">
                        Confirm booking
                    </button>
                    <a href="{% url 'events:event_detail' event.event_id %}"
                       class="btn btn-outline-secondary ms-2">
                        Cancel
                    </a>
                </form>
            </div>
        </div>
    </div>
</div>
{% endblock %}


==================================================
FILE: ./backend/templates/bookings/organizer_bookings.html
==================================================

{% extends "base.html" %}

{% block title %}Event bookings | EMS{% endblock %}

{% block extra_head %}
<style>
  .bookings-hero {
      border-radius: 18px;
      padding: 22px 24px;
      background: linear-gradient(135deg, #6C63FF 0%, #00B4D8 100%);
      color: white;
      box-shadow: 0 10px 26px rgba(0,0,0,0.16);
      margin-bottom: 24px;
  }

  .bookings-hero-title {
      font-size: 1.6rem;
      font-weight: 600;
  }

  .bookings-hero-subtitle {
      font-size: 0.95rem;
      opacity: 0.95;
  }

  .status-pill {
      display: inline-flex;
      padding: 4px 10px;
      border-radius: 999px;
      font-size: 0.75rem;
      font-weight: 500;
  }

  .status-confirmed {
      background: rgba(25, 135, 84, 0.08);
      color: #198754;
  }

  .status-pending {
      background: rgba(255, 193, 7, 0.12);
      color: #856404;
  }

  .status-cancelled {
      background: rgba(220, 53, 69, 0.08);
      color: #dc3545;
  }
</style>
{% endblock %}

{% block content %}

<!-- HERO ------------------------------------------------------------------->
<div class="bookings-hero">
  <div class="d-flex flex-column flex-md-row justify-content-between align-items-md-center">
    <div class="mb-3 mb-md-0">
      <div class="bookings-hero-title mb-1">
        Bookings overview
      </div>
      <div class="bookings-hero-subtitle">
        {% if selected_event %}
          Showing bookings for <strong>{{ selected_event.title }}</strong>.
        {% else %}
          Showing bookings for all of your events.
        {% endif %}
      </div>
    </div>
    <div class="text-md-end">
      <a href="{% url 'events:manage_events' %}" class="btn btn-light btn-sm text-dark">
        Back to organizer dashboard
      </a>
    </div>
  </div>
</div>

<!-- TABLE ------------------------------------------------------------------>
{% if bookings %}
  <div class="card shadow-sm">
    <div class="card-body">
      <div class="d-flex justify-content-between align-items-center mb-3">
        <h5 class="card-title mb-0">Bookings</h5>
        {% if selected_event %}
          <a href="{% url 'bookings:organizer_bookings' %}" class="btn btn-sm btn-outline-secondary">
            View all bookings
          </a>
        {% endif %}
      </div>

      <div class="table-responsive">
        <table class="table table-hover table-sm align-middle">
          <thead class="table-light">
            <tr>
              <th>Event</th>
              <th>Customer</th>
              <th>Tickets</th>
              <th>Total price</th>
              <th>Status</th>
              <th>Booked at</th>
            </tr>
          </thead>
          <tbody>
            {% for booking in bookings %}
              <tr>
                <td>
                  <strong>{{ booking.event.title }}</strong><br>
                  <small class="text-muted">
                    {{ booking.event.venue.name }}
                  </small>
                </td>
                <td>
                  {{ booking.customer.name }}<br>
                  <small class="text-muted">{{ booking.customer.email }}</small>
                </td>
                <td>{{ booking.ticket_qty }}</td>
                <td>${{ booking.total_price }}</td>
                <td>
                  {% if booking.status == "APPROVED" %}
                    <span class="status-pill status-confirmed">
                      {{ booking.get_status_display }}
                    </span>
                  {% elif booking.status == "PENDING" %}
                    <span class="status-pill status-pending">
                      {{ booking.get_status_display }}
                    </span>
                  {% else %}
                    <span class="status-pill status-cancelled">
                      {{ booking.get_status_display }}
                    </span>
                  {% endif %}
                </td>
                <td>{{ booking.booked_at|date:"M d, Y g:i A" }}</td>
              </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
  </div>
{% else %}
  <div class="alert alert-info">
    There are no bookings yet{% if selected_event %} for this event{% endif %}.
  </div>
{% endif %}

{% endblock %}


==================================================
FILE: ./backend/templates/bookings/admin_payment_form.html
==================================================

{% extends "admin_base.html" %}

{% block title %}
  {% if mode == "edit" %}Edit Payment | EMS{% else %}New Payment | EMS{% endif %}
{% endblock %}

{% block content %}
<div class="container py-4">
  <div class="card shadow-sm" style="max-width: 800px; margin: 0 auto;">
    <div class="card-header d-flex justify-content-between align-items-center">
      <h5 class="mb-0">
        {% if mode == "edit" %}Edit payment{% else %}Create payment{% endif %}
      </h5>
      <a href="{% url 'admin_payments' %}" class="btn btn-sm btn-outline-secondary">
        Back to payments
      </a>
    </div>
    <form method="post">
      {% csrf_token %}
      <div class="card-body">
        {% for field in form %}
          <div class="mb-3">
            <label class="form-label" for="{{ field.id_for_label }}">
              {{ field.label }}{% if field.field.required %}<span class="text-danger">*</span>{% endif %}
            </label>
            {{ field }}
            {% for error in field.errors %}
              <div class="text-danger small mt-1">{{ error }}</div>
            {% endfor %}
          </div>
        {% endfor %}
      </div>
      <div class="card-footer d-flex justify-content-end">
        <a href="{% url 'admin_payments' %}" class="btn btn-outline-secondary me-2">
          Cancel
        </a>
        <button type="submit" class="btn btn-primary">
          {% if mode == "edit" %}Save changes{% else %}Create payment{% endif %}
        </button>
      </div>
    </form>
  </div>
</div>
{% endblock %}


==================================================
FILE: ./backend/templates/bookings/admin_booking_form.html
==================================================

{% extends "admin_base.html" %}

{% block title %}
  {% if mode == "edit" %}Edit Booking | EMS{% else %}New Booking | EMS{% endif %}
{% endblock %}

{% block content %}
<div class="container py-4">
  <div class="card shadow-sm" style="max-width: 800px; margin: 0 auto;">
    <div class="card-header d-flex justify-content-between align-items-center">
      <h5 class="mb-0">
        {% if mode == "edit" %}Edit booking{% else %}Create booking{% endif %}
      </h5>
      <a href="{% url 'admin_bookings' %}" class="btn btn-sm btn-outline-secondary">
        Back to bookings
      </a>
    </div>
    <form method="post">
      {% csrf_token %}
      <div class="card-body">
        {% for field in form %}
          <div class="mb-3">
            <label class="form-label" for="{{ field.id_for_label }}">
              {{ field.label }}{% if field.field.required %}<span class="text-danger">*</span>{% endif %}
            </label>
            {{ field }}
            {% for error in field.errors %}
              <div class="text-danger small mt-1">{{ error }}</div>
            {% endfor %}
          </div>
        {% endfor %}
        {% if form.non_field_errors %}
          <div class="alert alert-danger">
            {{ form.non_field_errors }}
          </div>
        {% endif %}
      </div>
      <div class="card-footer d-flex justify-content-end">
        <a href="{% url 'admin_bookings' %}" class="btn btn-outline-secondary me-2">
          Cancel
        </a>
        <button type="submit" class="btn btn-primary">
          {% if mode == "edit" %}Save changes{% else %}Create booking{% endif %}
        </button>
      </div>
    </form>
  </div>
</div>
{% endblock %}


==================================================
FILE: ./backend/templates/bookings/admin_booking_confirm_delete.html
==================================================

{% extends "admin_base.html" %}

{% block title %}Delete Booking | EMS{% endblock %}

{% block content %}
<div class="container py-4">
  <div class="card shadow-sm" style="max-width: 720px; margin: 0 auto;">
    <div class="card-body">
      <h3 class="h5 mb-3">Delete booking</h3>
      <p>
        Are you sure you want to permanently delete the booking
        for <strong>{{ booking.event.title }}</strong>
        by <strong>{{ booking.customer.name }}</strong>?
      </p>
      <form method="post">
        {% csrf_token %}
        <a href="{% url 'admin_bookings' %}" class="btn btn-secondary">
          Cancel
        </a>
        <button type="submit" class="btn btn-danger ms-2">
          Yes, delete
        </button>
      </form>
    </div>
  </div>
</div>
{% endblock %}


==================================================
FILE: ./backend/templates/bookings/admin_booking_list.html
==================================================

{% extends "admin_base.html" %}

{% block title %}Bookings (Admin) | EMS{% endblock %}

{% block extra_head %}
<style>
  .admin-hero {
      border-radius: 18px;
      padding: 22px 24px;
      background: linear-gradient(135deg, #6C63FF 0%, #00B4D8 100%);
      color: white;
      box-shadow: 0 10px 26px rgba(0,0,0,0.16);
      margin-bottom: 24px;
  }
  .admin-hero-title { font-size: 1.6rem; font-weight: 600; }
</style>
{% endblock %}

{% block content %}

<div class="admin-hero">
  <div class="d-flex flex-column flex-md-row justify-content-between align-items-md-center">
    <div class="mb-3 mb-md-0">
      <div class="admin-hero-title mb-1">Bookings</div>
      <div class="small">
        Manage all bookings stored in the BOOKING table.
      </div>
    </div>
    <div class="text-md-end">
      <a href="{% url 'admin_dashboard' %}" class="btn btn-light btn-sm text-dark me-2">
        Back to admin dashboard
      </a>
      <a href="{% url 'admin_booking_create' %}" class="btn btn-outline-light btn-sm">
        + New booking
      </a>
    </div>
  </div>
</div>

<div class="card shadow-sm">
  <div class="card-body">
    {% if bookings %}
      <div class="table-responsive">
        <table class="table table-hover table-sm align-middle">
          <thead class="table-light">
            <tr>
              <th>ID</th>
              <th>Event</th>
              <th>Customer</th>
              <th>Tickets</th>
              <th>Total</th>
              <th>Status</th>
              <th>Booked at</th>
              <th class="text-end">Actions</th>
            </tr>
          </thead>
          <tbody>
            {% for booking in bookings %}
              <tr>
                <td>#{{ booking.booking_id }}</td>
                <td>{{ booking.event.title }}</td>
                <td>{{ booking.customer.name }}<br><small class="text-muted">{{ booking.customer.email }}</small></td>
                <td>{{ booking.ticket_qty }}</td>
                <td>${{ booking.total_price }}</td>
                <td>{{ booking.status }}</td>
                <td>{{ booking.booked_at|date:"M d, Y h:i A" }}</td>
                <td class="text-end">
                  <a href="{% url 'admin_booking_edit' booking.booking_id %}"
                     class="btn btn-sm btn-outline-secondary me-1">Edit</a>
                  <a href="{% url 'admin_booking_delete' booking.booking_id %}"
                     class="btn btn-sm btn-outline-danger">Delete</a>
                </td>
              </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    {% else %}
      <p class="text-muted mb-0">No bookings found.</p>
    {% endif %}
  </div>
</div>

{% endblock %}


==================================================
FILE: ./backend/templates/bookings/my_bookings.html
==================================================

{% extends "base.html" %}

{% block title %}My Bookings | EMS{% endblock %}

{% block content %}
<div class="page-section">
  <div class="page-section__inner">

    <!-- HERO -->
    <div class="hero-card hero-card--slim mb-4">
      <div class="flex-grow-1">
        <div class="hero-pill mb-2">
          <span style="font-size:0.9rem;">🎫</span>
          <span>All your tickets in one place</span>
        </div>
        <h1 class="hero-title mb-2">My Bookings</h1>
        <p class="hero-subtitle mb-0">
          View all the events you’ve reserved or purchased tickets for. Download receipts
          or jump back to event details anytime.
        </p>
      </div>
      <div class="text-end d-none d-md-flex flex-column justify-content-between">
        <div class="hero-quick-card">
          <div class="small fw-semibold mb-1">Summary</div>
          <div class="small text-white-50">
            {% if total_bookings %}
              {{ total_bookings }} booking{{ total_bookings|pluralize }}<br />
              Total spent: ${{ total_spent }}
            {% else %}
              No bookings yet. Start by exploring events.
            {% endif %}
          </div>
        </div>
        <div class="mt-2">
          <a href="{% url 'events:event_list' %}" class="btn btn-light btn-sm text-dark">
            Browse more events
          </a>
        </div>
      </div>
    </div>

    <!-- CONTENT -->
    <div class="row g-4">
      <div class="col-12">
        <h2 class="section-heading">Your recent bookings</h2>
        <p class="text-muted-soft mb-3">
          These are bookings tied to your logged-in account (email / user profile).
        </p>
      </div>

      {% if bookings %}
        {% for booking in bookings %}
          <div class="col-md-6 col-lg-4">
            <div class="card-glass card-glass--soft h-100">
              <div class="card-body">
                <div class="d-flex justify-content-between align-items-start mb-1">
                  <div>
                    <div class="fw-semibold">{{ booking.event.title }}</div>
                    <div class="small text-muted-soft">
                      {{ booking.event.venue.name }}<br>
                      {% if booking.event.venue.address %}
                        {{ booking.event.venue.address }}<br>
                      {% endif %}
                      {% if booking.event.venue.city or booking.event.venue.state or booking.event.venue.zipcode %}
                        {% if booking.event.venue.city %}{{ booking.event.venue.city }}{% endif %}
                        {% if booking.event.venue.city and booking.event.venue.state %}, {% endif %}
                        {% if booking.event.venue.state %}{{ booking.event.venue.state }}{% endif %}
                        {% if booking.event.venue.zipcode %} {{ booking.event.venue.zipcode }}{% endif %}<br>
                      {% endif %}
                      {% if booking.event.venue.country %}
                        {{ booking.event.venue.country }}
                      {% endif %}
                      · {{ booking.event.start_time|date:"M d, Y · H:i" }}
                    </div>
                  </div>
                  <div class="text-end">
                    <span
                      class="badge rounded-pill
                        {% if booking.status == 'APPROVED' %}bg-success-subtle text-success
                        {% elif booking.status == 'PENDING' %}bg-warning-subtle text-warning
                        {% else %}bg-secondary-subtle text-secondary{% endif %}">
                      {{ booking.get_status_display }}
                    </span>
                    {% if booking.event.ticket_price %}
                      <div class="small mt-1">
                        <span class="badge rounded-pill bg-primary-subtle text-primary">Paid event</span>
                      </div>
                    {% else %}
                      <div class="small mt-1">
                        <span class="badge rounded-pill bg-info-subtle text-info">Free event</span>
                      </div>
                    {% endif %}
                  </div>
                </div>

                <hr class="my-2" />

                <div class="small mb-2">
                  <div><strong>Tickets:</strong> {{ booking.ticket_qty }}</div>
                  <div>
                    <strong>Booked on:</strong>
                    {{ booking.booked_at|date:"M d, Y H:i" }}
                  </div>
                  <div><strong>Total:</strong> ${{ booking.total_price }}</div>
                </div>

                <div class="d-flex flex-wrap gap-2 mt-2">
                  <a
                    href="{% url 'events:event_detail' booking.event.event_id %}"
                    class="btn btn-outline-light btn-sm"
                  >
                    View event
                  </a>
                  <a
                    href="{% url 'bookings:booking_receipt' booking.booking_id %}"
                    class="btn btn-primary btn-sm"
                  >
                    View receipt
                  </a>
                  {% if booking.status != "CANCELLED" and booking.event.start_time > now %}
                    <a href="{% url 'bookings:cancel_booking' booking.booking_id %}"
                       class="btn btn-outline-danger btn-sm">
                      Cancel booking
                    </a>
                  {% endif %}
                </div>
              </div>
            </div>
          </div>
        {% endfor %}
      {% else %}
        <div class="col-12">
          <div class="card-glass card-glass--soft">
            <div class="card-body text-center py-5">
              <p class="mb-2 fw-semibold">You don’t have any bookings yet.</p>
              <p class="text-muted-soft mb-3">
                Browse upcoming events and reserve your spot for free or paid events.
              </p>
              <a href="{% url 'events:event_list' %}" class="btn btn-primary">
                Browse events
              </a>
            </div>
          </div>
        </div>
      {% endif %}
    </div>

  </div>
</div>
{% endblock %}


==================================================
FILE: ./backend/templates/bookings/admin_payment_list.html
==================================================

{% extends "admin_base.html" %}

{% block title %}Payments (Admin) | EMS{% endblock %}

{% block content %}
<div class="container py-4">
  <div class="d-flex justify-content-between align-items-center mb-3">
    <h2 class="h5 mb-0">Payments</h2>
    <div>
      <a href="{% url 'admin_dashboard' %}" class="btn btn-sm btn-outline-secondary me-2">
        Back to admin dashboard
      </a>
      <a href="{% url 'admin_payment_create' %}" class="btn btn-sm btn-primary">
        + New payment
      </a>
    </div>
  </div>

  <div class="card shadow-sm">
    <div class="card-body">
      {% if payments %}
        <div class="table-responsive">
          <table class="table table-hover table-sm align-middle">
            <thead class="table-light">
              <tr>
                <th>ID</th>
                <th>Booking</th>
                <th>Customer</th>
                <th>Amount</th>
                <th>Method</th>
                <th>Paid at</th>
                <th class="text-end">Actions</th>
              </tr>
            </thead>
            <tbody>
              {% for payment in payments %}
                <tr>
                  <td>#{{ payment.payment_id }}</td>
                  <td>#{{ payment.booking_id }}</td>
                  <td>{{ payment.customer.name }}<br>
                      <small class="text-muted">{{ payment.customer.email }}</small></td>
                  <td>${{ payment.amount }}</td>
                  <td>{{ payment.method }}</td>
                  <td>{{ payment.paid_at|date:"M d, Y h:i A" }}</td>
                  <td class="text-end">
                    <a href="{% url 'admin_payment_edit' payment.payment_id %}"
                       class="btn btn-sm btn-outline-secondary me-1">Edit</a>
                    <a href="{% url 'admin_payment_delete' payment.payment_id %}"
                       class="btn btn-sm btn-outline-danger">Delete</a>
                  </td>
                </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      {% else %}
        <p class="text-muted mb-0">No payments recorded.</p>
      {% endif %}
    </div>
  </div>
</div>
{% endblock %}


==================================================
FILE: ./backend/templates/bookings/admin_payment_confirm_delete.html
==================================================

{% extends "admin_base.html" %}

{% block title %}Delete Payment | EMS{% endblock %}

{% block content %}
<div class="container py-4">
  <div class="card shadow-sm" style="max-width: 720px; margin: 0 auto;">
    <div class="card-body">
      <h3 class="h5 mb-3">Delete payment</h3>
      <p>
        Are you sure you want to delete the payment of
        <strong>${{ payment.amount }}</strong> for booking
        <strong>#{{ payment.booking_id }}</strong>?
      </p>

      <form method="post">
        {% csrf_token %}
        <a href="{% url 'admin_payments' %}" class="btn btn-secondary">
          Cancel
        </a>
        <button type="submit" class="btn btn-danger ms-2">
          Yes, delete
        </button>
      </form>
    </div>
  </div>
</div>
{% endblock %}


==================================================
FILE: ./backend/templates/accounts/profile.html
==================================================

{% extends "base.html" %}

{% block title %}My Profile | EMS{% endblock %}

{% block extra_head %}
<style>
  .profile-header {
    background: linear-gradient(135deg, #5b6bff, #2dc9ff);
    border-radius: 18px;
    padding: 28px 24px;
    color: white;
    margin-bottom: 24px;
    box-shadow: 0 15px 35px rgba(0,0,0,0.15);
  }

  .profile-card {
    background: rgba(255,255,255,0.12);
    backdrop-filter: blur(18px);
    border-radius: 18px;
    padding: 24px;
    margin-bottom: 28px;
    border: 1px solid rgba(255,255,255,0.08);
  }

  .booking-card {
    background: #ffffff;
    color: #222;
    border-radius: 16px;
    padding: 18px;
    box-shadow: 0 8px 20px rgba(0,0,0,0.1);
  }

  .section-title {
    font-size: 1.3rem;
    font-weight: 600;
    margin-bottom: 12px;
    color: #0f172a;
  }

  /* Fix dropdown overlap */
  #userMenu {
    z-index: 99999 !important;
    position: absolute !important;
  }

  .navbar {
    z-index: 10000 !important;
    position: relative;
  }
</style>
{% endblock %}

{% block content %}
<div class="container py-4">

  <!-- HEADER -->
  <div class="profile-header">
    <h2 class="mb-1">{{ user.get_full_name|default:user.username }}</h2>
    <p class="mb-2">{{ user.email }}</p>

    {% if profile and profile.organizer %}
      <span class="badge bg-dark">Organizer</span>
      <a href="{% url 'events:manage_events' %}" class="btn btn-light btn-sm ms-2">
        Organizer dashboard
      </a>
    {% else %}
      <span class="badge bg-secondary">Participant</span>
    {% endif %}
  </div>

  <!-- PERSONAL DETAILS (from CUSTOMER table) -->
  {% if customer %}
    <div class="card mb-4">
      <div class="card-body">
        <h5 class="card-title mb-3">Personal details</h5>

        <div class="row">
          <div class="col-md-6 mb-2">
            <div class="text-muted small">Full name</div>
            <div>{{ customer.name }}</div>
          </div>
          <div class="col-md-6 mb-2">
            <div class="text-muted small">Email</div>
            <div>{{ customer.email }}</div>
          </div>

          {% if customer.phone %}
          <div class="col-md-6 mb-2">
            <div class="text-muted small">Phone</div>
            <div>{{ customer.phone }}</div>
          </div>
          {% endif %}

          {% if customer.dob %}
          <div class="col-md-6 mb-2">
            <div class="text-muted small">Date of birth</div>
            <div>{{ customer.dob|date:"M d, Y" }}</div>
          </div>
          {% endif %}

          {% if customer.address or customer.city or customer.state or customer.zipcode or customer.country %}
          <div class="col-md-12 mt-2">
            <div class="text-muted small">Address</div>
            <div>
              {% if customer.address %}
                {{ customer.address }}<br>
              {% endif %}

              {% if customer.city or customer.state or customer.zipcode %}
                {% if customer.city %}{{ customer.city }}{% endif %}
                {% if customer.city and customer.state %}, {% endif %}
                {% if customer.state %}{{ customer.state }}{% endif %}
                {% if customer.zipcode %} {{ customer.zipcode }}{% endif %}<br>
              {% endif %}

              {% if customer.country %}
                {{ customer.country }}
              {% endif %}
            </div>
          </div>
          {% endif %}
        </div>
      </div>
    </div>
  {% else %}
    <div class="alert alert-info">
      Your profile is linked to a login account, but no detailed customer record was found.
      New bookings and registrations will automatically create one.
    </div>
  {% endif %}

  <!-- UPCOMING BOOKINGS -->
  <h4 class="section-title">Upcoming bookings</h4>
  {% if upcoming_bookings %}
    {% for booking in upcoming_bookings %}
      <div class="booking-card mb-3">
        <h5>{{ booking.event.title }}</h5>
        <p class="text-muted">
          {{ booking.event.venue.name }}
          {% if booking.event.venue.city or booking.event.venue.country %}
            ·
            {% if booking.event.venue.city %}{{ booking.event.venue.city }}{% endif %}
            {% if booking.event.venue.city and booking.event.venue.country %}, {% endif %}
            {% if booking.event.venue.country %}{{ booking.event.venue.country }}{% endif %}
          {% endif %}
          – {{ booking.event.start_time|date:"M d, Y H:i" }}
        </p>

        <p><strong>Tickets:</strong> {{ booking.ticket_qty }}</p>
        <p><strong>Total paid:</strong> ${{ booking.total_price }}</p>

        <a href="{% url 'events:event_detail' booking.event.event_id %}"
           class="btn btn-outline-dark btn-sm">View event</a>

        <a href="{% url 'bookings:booking_receipt' booking.booking_id %}"
           class="btn btn-primary btn-sm ms-2">View receipt</a>

        {% if booking.status != "CANCELLED" and booking.event.start_time > now %}
          <a href="{% url 'bookings:cancel_booking' booking.booking_id %}"
             class="btn btn-danger btn-sm ms-2">Cancel</a>
        {% endif %}
      </div>
    {% endfor %}
  {% else %}
    <p class="text-muted">No upcoming bookings.</p>
  {% endif %}

  <!-- PAST BOOKINGS -->
  <h4 class="section-title mt-4">Past bookings</h4>
  {% if past_bookings %}
    {% for booking in past_bookings %}
      <div class="booking-card mb-3">
        <h5>{{ booking.event.title }}</h5>
        <p class="text-muted">
          {{ booking.event.venue.name }}
          {% if booking.event.venue.city or booking.event.venue.country %}
            ·
            {% if booking.event.venue.city %}{{ booking.event.venue.city }}{% endif %}
            {% if booking.event.venue.city and booking.event.venue.country %}, {% endif %}
            {% if booking.event.venue.country %}{{ booking.event.venue.country }}{% endif %}
          {% endif %}
          – {{ booking.event.start_time|date:"M d, Y H:i" }}
        </p>

        <p><strong>Tickets:</strong> {{ booking.ticket_qty }}</p>
        <p><strong>Total paid:</strong> ${{ booking.total_price }}</p>

        <a href="{% url 'events:event_detail' booking.event.event_id %}"
           class="btn btn-outline-dark btn-sm">View event</a>

        <a href="{% url 'bookings:booking_receipt' booking.booking_id %}"
           class="btn btn-primary btn-sm ms-2">View receipt</a>
      </div>
    {% endfor %}
  {% else %}
    <p class="text-muted">No past bookings.</p>
  {% endif %}

</div>
{% endblock %}


==================================================
FILE: ./backend/templates/accounts/password_reset_done.html
==================================================

{% extends "base.html" %}

{% block title %}Reset Email Sent | EMS{% endblock %}

{% block content %}
<div class="container py-4">
  <div class="row justify-content-center">
    <div class="col-md-6">
      <div class="card shadow-sm rounded-4">
        <div class="card-body">
          <h3 class="mb-3">Check your email</h3>
          <p class="text-muted">
            If an account exists with the email you entered, you’ll receive a message
            with a link to reset your password.
          </p>
          <p class="text-muted mb-0">
            The link is also printed in the Django server console (development mode).
          </p>
        </div>
      </div>
      <p class="mt-3 text-center">
        <a href="{% url 'login' %}">&larr; Back to login</a>
      </p>
    </div>
  </div>
</div>
{% endblock %}


==================================================
FILE: ./backend/templates/accounts/register.html
==================================================

{% extends "base.html" %}

{% block title %}Register | EMS{% endblock %}

{% block extra_head %}
<style>
  .auth-wrapper {
      min-height: calc(100vh - 140px);
      display: flex;
      align-items: center;
      justify-content: center;
  }

  .auth-card {
      width: 100%;
      max-width: 640px;
      border-radius: 24px;
      padding: 28px 26px 22px;
      background: radial-gradient(circle at top left, rgba(108,99,255,0.18), transparent 55%),
                  radial-gradient(circle at bottom right, rgba(0,180,216,0.18), transparent 55%),
                  rgba(7, 10, 30, 0.96);
      border: 1px solid rgba(255,255,255,0.08);
      box-shadow: 0 18px 40px rgba(0,0,0,0.45);
      backdrop-filter: blur(20px);
      color: #f8f9ff;
  }

  body.theme-light .auth-card {
      background: #ffffff;
      color: #111827;
      border-color: rgba(15,23,42,0.06);
      box-shadow: 0 16px 40px rgba(15,23,42,0.14);
  }

  .auth-title {
      font-size: 1.7rem;
      font-weight: 600;
      margin-bottom: 0.25rem;
  }

  .auth-subtitle {
      font-size: 0.9rem;
      opacity: 0.9;
      margin-bottom: 1.2rem;
  }

  .auth-section-title {
      font-size: 0.85rem;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      opacity: 0.8;
      margin-bottom: 0.35rem;
  }

  .auth-card form .form-group {
      margin-bottom: 0.85rem;
  }

  .auth-card form label {
      display: block;
      font-size: 0.85rem;
      font-weight: 500;
      margin-bottom: 0.25rem;
  }

  .auth-card form input {
      width: 100%;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.7);
      padding: 0.55rem 0.85rem;
      font-size: 0.92rem;
      background: rgba(15,23,42,0.85);
      color: #f9fafb;
  }

  body.theme-light .auth-card form input {
      background: #f9fafb;
      color: #111827;
  }

  .auth-card .helptext,
  .auth-card ul {
      font-size: 0.8rem;
      opacity: 0.9;
  }

  .btn-auth-primary {
      border-radius: 999px;
      padding-inline: 1.9rem;
      font-weight: 600;
      font-size: 0.96rem;
      background: linear-gradient(135deg, #10b981, #22c55e);
      border: none;
  }

  .btn-auth-primary:hover {
      filter: brightness(1.07);
  }

  .auth-footer-text {
      font-size: 0.85rem;
      margin-top: 0.9rem;
  }

  .auth-footer-text a {
      font-weight: 500;
      text-decoration: none;
  }
</style>
{% endblock %}

{% block content %}
<div class="auth-wrapper container">
  <div class="auth-card">
    <div class="mb-3">
      <div class="auth-title">Create an Account</div>
      <div class="auth-subtitle">
        Sign up to book events, manage your tickets, or become an organizer later.
      </div>
    </div>

    {% if form.errors %}
      <div class="alert alert-danger py-2 px-3 mb-3">
        Please fix the errors below and try again.
      </div>
    {% endif %}

    <form method="post" novalidate>
      {% csrf_token %}

      <!-- Account details -->
      <div class="mb-2">
        <div class="auth-section-title">Account details</div>
      </div>
      <div class="row">
        <div class="col-md-6 form-group">
          <label for="{{ form.username.id_for_label }}">Username</label>
          {{ form.username }}
          {% for error in form.username.errors %}
            <div class="text-danger small">{{ error }}</div>
          {% endfor %}
        </div>
        <div class="col-md-6 form-group">
          <label for="{{ form.email.id_for_label }}">Email</label>
          {{ form.email }}
          {% for error in form.email.errors %}
            <div class="text-danger small">{{ error }}</div>
          {% endfor %}
        </div>
      </div>

      <!-- Personal details -->
      <div class="mb-2 mt-2">
        <div class="auth-section-title">Personal details</div>
      </div>
      <div class="row">
        <div class="col-md-6 form-group">
          <label for="{{ form.first_name.id_for_label }}">First name</label>
          {{ form.first_name }}
          {% for error in form.first_name.errors %}
            <div class="text-danger small">{{ error }}</div>
          {% endfor %}
        </div>
        <div class="col-md-6 form-group">
          <label for="{{ form.last_name.id_for_label }}">Last name</label>
          {{ form.last_name }}
          {% for error in form.last_name.errors %}
            <div class="text-danger small">{{ error }}</div>
          {% endfor %}
        </div>
      </div>
      <div class="form-group">
        <label for="{{ form.dob.id_for_label }}">Date of birth</label>
        {{ form.dob }}
        {% for error in form.dob.errors %}
          <div class="text-danger small">{{ error }}</div>
        {% endfor %}
      </div>

      <!-- Address -->
      <div class="mb-2 mt-2">
        <div class="auth-section-title">Address</div>
      </div>
      <div class="form-group">
        <label for="{{ form.address.id_for_label }}">Street address</label>
        {{ form.address }}
        {% for error in form.address.errors %}
          <div class="text-danger small">{{ error }}</div>
        {% endfor %}
      </div>
      <div class="row">
        <div class="col-md-4 form-group">
          <label for="{{ form.city.id_for_label }}">City</label>
          {{ form.city }}
          {% for error in form.city.errors %}
            <div class="text-danger small">{{ error }}</div>
          {% endfor %}
        </div>
        <div class="col-md-4 form-group">
          <label for="{{ form.state.id_for_label }}">State</label>
          {{ form.state }}
          {% for error in form.state.errors %}
            <div class="text-danger small">{{ error }}</div>
          {% endfor %}
        </div>
        <div class="col-md-4 form-group">
          <label for="{{ form.zipcode.id_for_label }}">ZIP / Postal code</label>
          {{ form.zipcode }}
          {% for error in form.zipcode.errors %}
            <div class="text-danger small">{{ error }}</div>
          {% endfor %}
        </div>
      </div>
      <div class="form-group">
        <label for="{{ form.country.id_for_label }}">Country</label>
        {{ form.country }}
        {% for error in form.country.errors %}
          <div class="text-danger small">{{ error }}</div>
        {% endfor %}
      </div>

      <!-- Phone + passwords -->
      <div class="mb-2 mt-2">
        <div class="auth-section-title">Security</div>
      </div>
      <div class="form-group">
        <label for="{{ form.phone.id_for_label }}">Phone (optional)</label>
        {{ form.phone }}
        {% for error in form.phone.errors %}
          <div class="text-danger small">{{ error }}</div>
        {% endfor %}
      </div>
      <div class="form-group">
        <label for="{{ form.password1.id_for_label }}">Password</label>
        {{ form.password1 }}
        {% for error in form.password1.errors %}
          <div class="text-danger small">{{ error }}</div>
        {% endfor %}
      </div>
      <div class="form-group">
        <label for="{{ form.password2.id_for_label }}">Confirm password</label>
        {{ form.password2 }}
        {% for error in form.password2.errors %}
          <div class="text-danger small">{{ error }}</div>
        {% endfor %}
      </div>

      <div class="d-flex justify-content-between align-items-center mt-3">
        <p class="auth-footer-text mb-0">
          Already have an account?
          <a href="{% url 'login' %}">Login here</a>.
        </p>
        <button type="submit" class="btn btn-success btn-auth-primary">
          Create account
        </button>
      </div>
    </form>
  </div>
</div>
{% endblock %}


==================================================
FILE: ./backend/templates/accounts/login.html
==================================================

{% extends "base.html" %}

{% block title %}Login | EMS{% endblock %}

{% block extra_head %}
<style>
  .auth-wrapper {
      min-height: calc(100vh - 140px);
      display: flex;
      align-items: center;
      justify-content: center;
  }

  .auth-card {
      width: 100%;
      max-width: 480px;
      border-radius: 24px;
      padding: 28px 26px 22px;
      background: radial-gradient(circle at top left, rgba(108,99,255,0.18), transparent 55%),
                  radial-gradient(circle at bottom right, rgba(0,180,216,0.18), transparent 55%),
                  rgba(7, 10, 30, 0.96);
      border: 1px solid rgba(255,255,255,0.08);
      box-shadow: 0 18px 40px rgba(0,0,0,0.45);
      backdrop-filter: blur(20px);
      color: #f8f9ff;
  }

  body.theme-light .auth-card {
      background: #ffffff;
      color: #111827;
      border-color: rgba(15,23,42,0.06);
      box-shadow: 0 16px 40px rgba(15,23,42,0.14);
  }

  .auth-title {
      font-size: 1.6rem;
      font-weight: 600;
      margin-bottom: 0.25rem;
  }

  .auth-subtitle {
      font-size: 0.9rem;
      opacity: 0.85;
      margin-bottom: 1.2rem;
  }

  .auth-card form p {
      margin-bottom: 0.9rem;
  }

  .auth-card form p label {
      display: block;
      font-size: 0.85rem;
      font-weight: 500;
      margin-bottom: 0.25rem;
  }

  .auth-card form p input {
      width: 100%;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.7);
      padding: 0.55rem 0.85rem;
      font-size: 0.92rem;
      background: rgba(15,23,42,0.85);
      color: #f9fafb;
  }

  body.theme-light .auth-card form p input {
      background: #f9fafb;
      color: #111827;
  }

  .auth-card .helptext,
  .auth-card ul {
      font-size: 0.8rem;
      opacity: 0.9;
  }

  .auth-card .btn-auth-primary {
      border-radius: 999px;
      padding-inline: 1.8rem;
      font-weight: 600;
      font-size: 0.96rem;
      background: linear-gradient(135deg, #4f46e5, #2563eb);
      border: none;
  }

  .auth-card .btn-auth-primary:hover {
      filter: brightness(1.07);
  }

  .auth-footer-text {
      font-size: 0.85rem;
      margin-top: 0.9rem;
  }

  .auth-footer-text a {
      font-weight: 500;
      text-decoration: none;
  }
</style>
{% endblock %}

{% block content %}
<div class="auth-wrapper container">
  <div class="auth-card">
    <div class="mb-3">
      <div class="auth-title">Welcome back</div>
      <div class="auth-subtitle">
        Log in to manage your bookings, events and organizer dashboard.
      </div>
    </div>

    {% if form.errors %}
      <div class="alert alert-danger py-2 px-3 mb-3">
        Please correct the highlighted errors and try again.
      </div>
    {% endif %}

    <form method="post" novalidate>
      {% csrf_token %}
      {{ form.as_p }}

      <div class="d-flex justify-content-between align-items-center mt-3">
        <a href="{% url 'password_reset' %}" class="auth-footer-text mb-0">
          Forgot your password?
        </a>
        <button type="submit" class="btn btn-primary btn-auth-primary">
          Login
        </button>
      </div>
    </form>

    <p class="auth-footer-text text-center mt-3 mb-0">
      Don't have an account?
      <a href="{% url 'register' %}">Create one now</a>.
    </p>
  </div>
</div>
{% endblock %}


==================================================
FILE: ./backend/templates/accounts/become_organizer.html
==================================================

{% extends "base.html" %}

{% block title %}Become an organizer | EMS{% endblock %}

{% block content %}
<h1 class="h4 mb-3">Become an organizer</h1>

{% if pending %}
  <div class="alert alert-info">
    Your organizer request is <strong>pending admin approval</strong>.<br>
    Organizer name: <strong>{{ organizer.name }}</strong><br>
    Email: {{ organizer.email }}
  </div>
  <p class="text-muted">
    Once an administrator approves your request, you will be able to access the
    <strong>Organizer dashboard</strong> and create/manage events.
  </p>
{% else %}
  <p class="text-muted">
    Upgrade your account to publish and manage events. Your contact details will be
    shown on event pages so participants can reach you. An administrator must approve
    your request before you become an organizer.
  </p>

  <div class="card shadow-sm">
    <div class="card-body">
      <form method="post">
        {% csrf_token %}

        <div class="mb-3">
          <label class="form-label" for="org-name">Organizer name</label>
          <input
            type="text"
            name="name"
            id="org-name"
            class="form-control"
            value="{{ prefill_name|default:request.user.get_full_name|default:request.user.username }}"
          >
        </div>

        <div class="mb-3">
          <label class="form-label" for="org-email">Contact email</label>
          <input
            type="email"
            name="email"
            id="org-email"
            class="form-control"
            value="{{ prefill_email|default:request.user.email }}"
          >
          <div class="form-text">
            This email may be visible to participants on event detail pages.
          </div>
        </div>

        <div class="mb-3">
          <label class="form-label" for="org-phone">Contact phone</label>
          <input
            type="text"
            name="phone"
            id="org-phone"
            class="form-control"
            value="{{ prefill_phone }}"
          >
        </div>

        <button type="submit" class="btn btn-primary">
          Submit organizer request
        </button>
        <a href="{% url 'home' %}" class="btn btn-link">Cancel</a>
      </form>
    </div>
  </div>
{% endif %}
{% endblock %}


==================================================
FILE: ./backend/templates/accounts/admin_admin_list.html
==================================================

{% extends "admin_base.html" %}

{% block title %}Manage Admins | EMS{% endblock %}

{% block content %}
<div class="container py-4">

  <div class="d-flex justify-content-between align-items-center mb-3">
    <div>
      <h1 class="h4 mb-1">Admin users</h1>
      <p class="text-muted mb-0">
        Manage accounts stored in the <code>ADMIN</code> table. Only admins with
        role <strong>ADMIN</strong> can access this page.
      </p>
    </div>
    <div>
      <a href="{% url 'admin_dashboard' %}" class="btn btn-outline-secondary btn-sm me-2">
        Back to dashboard
      </a>
      <a href="{% url 'admin_admin_create' %}" class="btn btn-primary btn-sm">
        + Add admin
      </a>
    </div>
  </div>

  {% if admins %}
    <div class="card shadow-sm">
      <div class="card-body">
        <div class="table-responsive">
          <table class="table table-hover table-sm align-middle">
            <thead class="table-light">
              <tr>
                <th>Username</th>
                <th>Email</th>
                <th>Role</th>
                <th class="text-end">Actions</th>
              </tr>
            </thead>
            <tbody>
              {% for a in admins %}
                <tr>
                  <td>{{ a.username }}</td>
                  <td>{{ a.email }}</td>
                  <td>{{ a.role }}</td>
                  <td class="text-end">
                    <a href="{% url 'admin_admin_edit' a.admin_id %}"
                       class="btn btn-sm btn-outline-secondary me-1">
                      Edit
                    </a>
                    <a href="{% url 'admin_admin_delete' a.admin_id %}"
                       class="btn btn-sm btn-outline-danger">
                      Delete
                    </a>
                  </td>
                </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </div>
    </div>
  {% else %}
    <div class="alert alert-info">
      There are no admin users yet.
    </div>
  {% endif %}
</div>
{% endblock %}


==================================================
FILE: ./backend/templates/accounts/password_reset_confirm.html
==================================================

{% extends "base.html" %}

{% block title %}Choose New Password | EMS{% endblock %}

{% block content %}
<div class="container py-4">
  <div class="row justify-content-center">
    <div class="col-md-6">
      <div class="card shadow-sm rounded-4">
        <div class="card-body">
          <h3 class="mb-3">Set a new password</h3>

          {% if validlink %}
            <form method="post">
              {% csrf_token %}
              {{ form.as_p }}
              <button type="submit" class="btn btn-primary w-100 mt-2">
                Change my password
              </button>
            </form>
          {% else %}
            <p class="text-danger">
              This password reset link is invalid, possibly because it has already been used.
              Please request a new password reset.
            </p>
            <a href="{% url 'password_reset' %}" class="btn btn-outline-primary">
              Request new reset link
            </a>
          {% endif %}
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %}


==================================================
FILE: ./backend/templates/accounts/password_reset_form.html
==================================================

{% extends "base.html" %}

{% block title %}Reset Password | EMS{% endblock %}

{% block content %}
<div class="container py-4">
  <div class="row justify-content-center">
    <div class="col-md-6">
      <div class="card shadow-sm rounded-4">
        <div class="card-body">
          <h3 class="mb-3">Forgot your password?</h3>
          <p class="text-muted">
            Enter the email address you used to register. We’ll send a link to reset your password.
          </p>
          <form method="post">
            {% csrf_token %}
            {{ form.as_p }}
            <button type="submit" class="btn btn-primary w-100 mt-2">
              Send reset link
            </button>
          </form>
        </div>
      </div>
      <p class="mt-3 text-center">
        <a href="{% url 'login' %}">&larr; Back to login</a>
      </p>
    </div>
  </div>
</div>
{% endblock %}


==================================================
FILE: ./backend/templates/accounts/admin_organizers.html
==================================================

{% extends "admin_base.html" %}

{% block title %}Organizer Management | EMS{% endblock %}

{% block content %}
<div class="container py-4">
  <div class="d-flex justify-content-between align-items-center mb-3">
    <div>
      <h1 class="h4 mb-1">Organizer Management</h1>
      <p class="text-muted mb-0">
        Review pending organizer requests and manage existing organizers.
      </p>
    </div>
    <a href="{% url 'admin_dashboard' %}" class="btn btn-outline-secondary btn-sm">
      ← Back to dashboard
    </a>
  </div>

  <div class="row g-3 mb-3">
    <div class="col-md-3">
      <div class="card shadow-sm h-100">
        <div class="card-body py-2">
          <div class="small text-muted">Pending</div>
          <div class="h4 mb-0">{{ stats.pending }}</div>
        </div>
      </div>
    </div>
    <div class="col-md-3">
      <div class="card shadow-sm h-100">
        <div class="card-body py-2">
          <div class="small text-muted">Approved</div>
          <div class="h4 mb-0">{{ stats.approved }}</div>
        </div>
      </div>
    </div>
    <div class="col-md-3">
      <div class="card shadow-sm h-100">
        <div class="card-body py-2">
          <div class="small text-muted">Rejected</div>
          <div class="h4 mb-0">{{ stats.rejected }}</div>
        </div>
      </div>
    </div>
  </div>

  <div class="card shadow-sm">
    <div class="card-body">
      <div class="d-flex justify-content-between align-items-center mb-3">
        <h5 class="card-title mb-0">Organizers</h5>
        <div>
          <a href="?status=" class="btn btn-sm btn-outline-secondary{% if not status_filter %} active{% endif %}">All</a>
          <a href="?status=PENDING" class="btn btn-sm btn-outline-warning{% if status_filter == 'PENDING' %} active{% endif %}">Pending</a>
          <a href="?status=APPROVED" class="btn btn-sm btn-outline-success{% if status_filter == 'APPROVED' %} active{% endif %}">Approved</a>
          <a href="?status=REJECTED" class="btn btn-sm btn-outline-danger{% if status_filter == 'REJECTED' %} active{% endif %}">Rejected</a>
        </div>
      </div>

      {% if organizers %}
        <div class="table-responsive">
          <table class="table table-hover align-middle">
            <thead class="table-light">
              <tr>
                <th>Name</th>
                <th>Email</th>
                <th>User account</th>
                <th>Status</th>
                <th class="text-end">Actions</th>
              </tr>
            </thead>
            <tbody>
              {% for org in organizers %}
                <tr>
                  <td>{{ org.name }}</td>
                  <td>{{ org.email }}</td>
                  <td>
                    {% if org.user %}
                      {{ org.user.username }}
                    {% else %}
                      <span class="text-muted">—</span>
                    {% endif %}
                  </td>
                  <td>
                    {% if org.status == "PENDING" %}
                      <span class="badge bg-warning text-dark">Pending</span>
                    {% elif org.status == "APPROVED" %}
                      <span class="badge bg-success">Approved</span>
                    {% else %}
                      <span class="badge bg-danger">Rejected</span>
                    {% endif %}
                  </td>
                  <td class="text-end">
                    {% if org.status == "PENDING" %}
                      <form method="post" action="{% url 'admin_organizer_approve' org.organizer_id %}" class="d-inline">
                        {% csrf_token %}
                        <button type="submit" class="btn btn-sm btn-success">Approve</button>
                      </form>
                      <form method="post" action="{% url 'admin_organizer_reject' org.organizer_id %}" class="d-inline ms-1">
                        {% csrf_token %}
                        <button type="submit" class="btn btn-sm btn-outline-danger">Reject</button>
                      </form>
                    {% elif org.status == "APPROVED" %}
                      <form method="post" action="{% url 'admin_organizer_reject' org.organizer_id %}" class="d-inline">
                        {% csrf_token %}
                        <button type="submit" class="btn btn-sm btn-outline-danger">Set rejected</button>
                      </form>
                    {% elif org.status == "REJECTED" %}
                      <form method="post" action="{% url 'admin_organizer_approve' org.organizer_id %}" class="d-inline">
                        {% csrf_token %}
                        <button type="submit" class="btn btn-sm btn-outline-success">Re-approve</button>
                      </form>
                    {% endif %}
                  </td>
                </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      {% else %}
        <p class="text-muted mb-0">
          No organizers found.
        </p>
      {% endif %}
    </div>
  </div>
</div>
{% endblock %}


==================================================
FILE: ./backend/templates/accounts/admin_admin_confirm_delete.html
==================================================

{% extends "admin_base.html" %}

{% block title %}Delete Admin | EMS{% endblock %}

{% block content %}
<div class="container py-4" style="max-width: 720px;">
  <div class="card shadow-sm">
    <div class="card-body">
      <h1 class="h5 mb-3">Delete admin user</h1>

      <p>
        Are you sure you want to delete admin user
        <strong>{{ admin_obj.username }}</strong> ({{ admin_obj.email }})?
      </p>

      <div class="alert alert-warning">
        This action cannot be undone. The admin will no longer be able to log into
        the admin portal.
      </div>

      <form method="post">
        {% csrf_token %}
        <a href="{% url 'admin_admins' %}" class="btn btn-secondary">
          Cancel
        </a>
        <button type="submit" class="btn btn-danger ms-2">
          Yes, delete admin
        </button>
      </form>
    </div>
  </div>
</div>
{% endblock %}


==================================================
FILE: ./backend/templates/accounts/admin_admin_form.html
==================================================

{% extends "admin_base.html" %}

{% block title %}
  {% if mode == "edit" %}Edit Admin | EMS{% else %}New Admin | EMS{% endif %}
{% endblock %}

{% block content %}
<div class="container py-4" style="max-width: 720px;">

  <div class="card shadow-sm">
    <div class="card-body">
      <h1 class="h5 mb-3">
        {% if mode == "edit" %}
          Edit admin user{% if admin_obj %}: {{ admin_obj.username }}{% endif %}
        {% else %}
          Create new admin user
        {% endif %}
      </h1>

      <form method="post" novalidate>
        {% csrf_token %}

        {% if form.non_field_errors %}
          <div class="alert alert-danger">
            {{ form.non_field_errors }}
          </div>
        {% endif %}

        {% for field in form %}
          <div class="mb-3">
            <label class="form-label" for="{{ field.id_for_label }}">
              {{ field.label }}
              {% if field.field.required %}<span class="text-danger">*</span>{% endif %}
            </label>
            {{ field }}
            {% if field.help_text %}
              <div class="form-text">{{ field.help_text }}</div>
            {% endif %}
            {% for error in field.errors %}
              <div class="text-danger small">{{ error }}</div>
            {% endfor %}
          </div>
        {% endfor %}

        <div class="d-flex justify-content-between">
          <a href="{% url 'admin_admins' %}" class="btn btn-outline-secondary">
            Cancel
          </a>
          <button type="submit" class="btn btn-primary">
            {% if mode == "edit" %}Save changes{% else %}Create admin{% endif %}
          </button>
        </div>
      </form>
    </div>
  </div>

</div>
{% endblock %}


==================================================
FILE: ./backend/templates/accounts/password_reset_complete.html
==================================================

{% extends "base.html" %}

{% block title %}Password Reset Complete | EMS{% endblock %}

{% block content %}
<div class="container py-4">
  <div class="row justify-content-center">
    <div class="col-md-6">
      <div class="card shadow-sm rounded-4">
        <div class="card-body text-center">
          <h3 class="mb-3">Password changed</h3>
          <p class="text-muted">
            Your password has been set. You may now log in using your new password.
          </p>
          <a href="{% url 'login' %}" class="btn btn-primary">
            Go to login
          </a>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %}



==================================================
FILE: ./backend/templates/accounts/admin_login.html
==================================================

{% extends "admin_base.html" %}

{% block title %}Admin Login | EMS{% endblock %}

{% block extra_head %}
<style>
  .auth-wrapper {
      min-height: calc(100vh - 140px);
      display: flex;
      align-items: center;
      justify-content: center;
  }

  .auth-card {
      width: 100%;
      max-width: 480px;
      border-radius: 24px;
      padding: 28px 26px 22px;
      background: radial-gradient(circle at top left, rgba(239,68,68,0.18), transparent 55%),
                  radial-gradient(circle at bottom right, rgba(37,99,235,0.18), transparent 55%),
                  rgba(7, 10, 30, 0.96);
      border: 1px solid rgba(255,255,255,0.08);
      box-shadow: 0 18px 40px rgba(0,0,0,0.45);
      backdrop-filter: blur(20px);
      color: #f8f9ff;
  }

  body.theme-light .auth-card {
      background: #ffffff;
      color: #111827;
      border-color: rgba(15,23,42,0.06);
      box-shadow: 0 16px 40px rgba(15,23,42,0.14);
  }

  .auth-title {
      font-size: 1.6rem;
      font-weight: 600;
      margin-bottom: 0.25rem;
  }

  .auth-subtitle {
      font-size: 0.9rem;
      opacity: 0.85;
      margin-bottom: 1.2rem;
  }

  .auth-card form .form-label {
      font-size: 0.85rem;
      font-weight: 500;
      margin-bottom: 0.25rem;
  }

  .auth-card form .form-control {
      border-radius: 999px;
      padding: 0.55rem 0.85rem;
      font-size: 0.92rem;
  }

  .btn-auth-primary {
      border-radius: 999px;
      padding-inline: 1.8rem;
      font-weight: 600;
      font-size: 0.96rem;
  }
</style>
{% endblock %}

{% block content %}
<div class="auth-wrapper container">
  <div class="auth-card">
    <div class="mb-3">
      <div class="auth-title">Administrator Login</div>
      <div class="auth-subtitle">
        Sign in to manage events, venues, organizers, bookings and payments.
      </div>
    </div>

    {% if messages %}
      {% for message in messages %}
        <div class="alert alert-{{ message.tags }} py-2 px-3 mb-2">
          {{ message }}
        </div>
      {% endfor %}
    {% endif %}

    {% if error %}
      <div class="alert alert-danger py-2 px-3 mb-2">
        {{ error }}
      </div>
    {% endif %}

    <form method="post" novalidate>
      {% csrf_token %}
      <div class="mb-3">
        <label class="form-label" for="id_username">Username</label>
        <input
          type="text"
          name="username"
          id="id_username"
          class="form-control"
          required
          value="{{ username_prefill }}"
        >
      </div>
      <div class="mb-3">
        <label class="form-label" for="id_password">Password</label>
        <input
          type="password"
          name="password"
          id="id_password"
          class="form-control"
          required
        >
      </div>
      <div class="d-flex justify-content-end">
        <button type="submit" class="btn btn-primary btn-auth-primary">
          Admin Login
        </button>
      </div>
    </form>
  </div>
</div>
{% endblock %}


==================================================
FILE: ./backend/templates/accounts/admin_dashboard.html
==================================================

{% extends "admin_base.html" %}

{% block title %}Admin Dashboard | EMS{% endblock %}

{% block content %}
<div class="container py-4">

  <!-- HEADER -------------------------------------------------------------->
  <div class="d-flex justify-content-between align-items-center mb-4">
    <div>
      <h1 class="h4 mb-1">Admin Dashboard</h1>
      <p class="text-muted mb-0">
        Logged in as <strong>{{ admin.username }}</strong> ({{ admin.role }}).
        Use this panel to manage organizers, events, venues, customers, bookings and payments.
      </p>
    </div>
    <div>
      <a href="{% url 'admin_logout' %}" class="btn btn-outline-danger btn-sm">
        Log out
      </a>
    </div>
  </div>

  <!-- STATS CARDS --------------------------------------------------------->
  <div class="row g-3 mb-3">
    <div class="col-md-3">
      <div class="card shadow-sm h-100">
        <div class="card-body">
          <div class="small text-muted mb-1">Events</div>
          <div class="h3 mb-0">{{ stats.event_count }}</div>
        </div>
      </div>
    </div>
    <div class="col-md-3">
      <div class="card shadow-sm h-100">
        <div class="card-body">
          <div class="small text-muted mb-1">Organizers</div>
          <div class="h3 mb-0">{{ stats.organizer_count }}</div>
        </div>
      </div>
    </div>
    <div class="col-md-3">
      <div class="card shadow-sm h-100">
        <div class="card-body">
          <div class="small text-muted mb-1">Venues</div>
          <div class="h3 mb-0">{{ stats.venue_count }}</div>
        </div>
      </div>
    </div>
    <div class="col-md-3">
      <div class="card shadow-sm h-100">
        <div class="card-body">
          <div class="small text-muted mb-1">Customers</div>
          <div class="h3 mb-0">{{ stats.customer_count }}</div>
        </div>
      </div>
    </div>
  </div>

  <div class="row g-3 mb-4">
    <div class="col-md-3">
      <div class="card shadow-sm h-100">
        <div class="card-body">
          <div class="small text-muted mb-1">Bookings</div>
          <div class="h3 mb-0">{{ stats.booking_count }}</div>
        </div>
      </div>
    </div>
    <div class="col-md-3">
      <div class="card shadow-sm h-100 border-warning">
        <div class="card-body">
          <div class="small text-muted mb-1">Pending organizer requests</div>
          <div class="h3 mb-0 text-warning">{{ stats.pending_organizers }}</div>
        </div>
      </div>
    </div>
     <div class="col-md-3">
      <div class="card shadow-sm h-100">
        <div class="card-body">
          <div class="small text-muted mb-1">Admins</div>
          <div class="h3 mb-0">{{ stats.admin_count }}</div>
        </div>
      </div>
    </div>
  </div>

  <!-- QUICK ACTIONS ------------------------------------------------------->
  <!-- QUICK ACTIONS ------------------------------------------------------->
  <div class="card shadow-sm">
    <div class="card-body">
      <h5 class="card-title mb-3">Quick actions</h5>
      <div class="row g-2">

        <!-- Organizers -->
        <div class="col-md-4 col-lg-2">
          <a href="{% url 'admin_organizers' %}" class="btn btn-outline-primary w-100">
            Review organizers
            {% if stats.pending_organizers %}
              <span class="badge bg-warning text-dark ms-1">
                {{ stats.pending_organizers }} pending
              </span>
            {% endif %}
          </a>
        </div>

        <!-- Events -->
        <div class="col-md-4 col-lg-2">
          <a href="{% url 'admin_events' %}" class="btn btn-outline-secondary w-100">
            Manage events
          </a>
        </div>

        <!-- Venues -->
        <div class="col-md-4 col-lg-2">
          <a href="{% url 'admin_venues' %}" class="btn btn-outline-secondary w-100">
            Manage venues
          </a>
        </div>

        <!-- Customers -->
        <div class="col-md-4 col-lg-2">
          <a href="{% url 'admin_customers' %}" class="btn btn-outline-secondary w-100">
            Manage customers
          </a>
        </div>

        <!-- Bookings -->
        <div class="col-md-4 col-lg-2">
          <a href="{% url 'admin_bookings' %}" class="btn btn-outline-secondary w-100">
            Manage bookings
          </a>
        </div>

        <!-- Payments -->
        <div class="col-md-4 col-lg-2">
          <a href="{% url 'admin_payments' %}" class="btn btn-outline-secondary w-100">
            Manage payments
          </a>
        </div>
                <div class="col-md-4">
          <a href="{% url 'admin_admins' %}" class="btn btn-outline-secondary w-100">
            Manage admins
          </a>
        </div>

      </div>
    </div>
  </div>

</div>
{% endblock %}


==================================================
FILE: ./backend/templates/events/admin_venue_form.html
==================================================

{% extends "admin_base.html" %}

{% block title %}
  {% if mode == "edit" %}Edit Venue (Admin) | EMS{% else %}New Venue (Admin) | EMS{% endif %}
{% endblock %}

{% block content %}
<div class="container py-4">
  <div class="venue-form-shell">
    <div class="venue-form-card card shadow-sm">
      <div class="card-header d-flex justify-content-between align-items-center">
        <div>
          <h2 class="h5 mb-1">
            {% if mode == "edit" %}Edit venue{% else %}Create new venue{% endif %}
          </h2>
        </div>
        <div>
          <a href="{% url 'admin_venues' %}" class="btn btn-outline-secondary btn-sm">
            Back to venues
          </a>
        </div>
      </div>

      <form method="post" class="card-body" novalidate>
        {% csrf_token %}
        {% for field in form %}
          <div class="mb-3">
            <label class="form-label" for="{{ field.id_for_label }}">
              {{ field.label }}
              {% if field.field.required %}<span class="text-danger">*</span>{% endif %}
            </label>
            {{ field }}
            {% if field.help_text %}
              <div class="form-text">{{ field.help_text }}</div>
            {% endif %}
            {% for error in field.errors %}
              <div class="text-danger small mt-1">{{ error }}</div>
            {% endfor %}
          </div>
        {% endfor %}

        {% if form.non_field_errors %}
          <div class="alert alert-danger">
            {{ form.non_field_errors }}
          </div>
        {% endif %}

        <div class="d-flex justify-content-end gap-2">
          <a href="{% url 'admin_venues' %}" class="btn btn-outline-secondary">
            Cancel
          </a>
          <button type="submit" class="btn btn-primary">
            {% if mode == "edit" %}Save changes{% else %}Create venue{% endif %}
          </button>
        </div>
      </form>
    </div>
  </div>
</div>
{% endblock %}


==================================================
FILE: ./backend/templates/events/venue_form.html
==================================================

{% extends "base.html" %}

{% block title %}New Venue | EMS{% endblock %}

{% block extra_head %}
<style>
  .venue-form-shell {
    max-width: 720px;
    margin: 0 auto;
  }

  .venue-form-card {
    border-radius: 26px;
    border: 1px solid rgba(148, 163, 184, 0.45);
    padding: 0;
    overflow: hidden;
    box-shadow: 0 26px 60px rgba(15, 23, 42, 0.85);
    background: radial-gradient(circle at top left, rgba(30, 64, 175, 0.55), #020617);
    color: #e5e7eb;
  }

  .venue-form-header {
    padding: 18px 24px;
    background: linear-gradient(135deg, #3b82f6, #06b6d4);
    color: #f9fafb;
  }

  .venue-form-header h2 {
    font-size: 1.4rem;
    margin-bottom: 4px;
  }

  .venue-form-header p {
    margin: 0;
    font-size: 0.9rem;
    opacity: 0.92;
  }

  .venue-form-body {
    padding: 22px 24px 22px;
  }

  .venue-form-label {
    font-weight: 500;
    font-size: 0.88rem;
    color: #e5e7eb;
  }

  .venue-form-help {
    font-size: 0.78rem;
    color: #9ca3af;
  }

  /* 🔧 Dark inputs in both themes */
  .venue-form-body input,
  .venue-form-body select,
  .venue-form-body textarea {
    background-color: rgba(15, 23, 42, 0.9) !important;
    border: 1px solid rgba(148, 163, 184, 0.6) !important;
    color: #f9fafb !important;
    border-radius: 12px;
  }

  .venue-form-body input:focus,
  .venue-form-body select:focus,
  .venue-form-body textarea:focus {
    outline: none;
    box-shadow: 0 0 0 1px #3b82f6;
    border-color: #3b82f6 !important;
  }

  .venue-form-footer {
    padding: 16px 24px 22px;
    border-top: 1px solid rgba(31, 41, 55, 0.9);
    display: flex;
    justify-content: flex-end;
    gap: 12px;
  }

  .venue-form-footer .btn {
    border-radius: 999px;
    padding-inline: 22px;
  }

  body.light-mode .venue-form-card {
    background: radial-gradient(circle at top left, rgba(30, 64, 175, 0.55), #020617);
    color: #e5e7eb;
  }
</style>
{% endblock %}

{% block content %}
<div class="container py-4">
  <div class="venue-form-shell">
    <div class="venue-form-card">
      <div class="venue-form-header d-flex justify-content-between align-items-center">
        <div>
          <h2>Add a new venue</h2>
          <p>Create a reusable place for your events with capacity and full address.</p>
        </div>
        <div>
          <a href="{% url 'events:manage_events' %}" class="btn btn-outline-light btn-sm">
            Back to Manage
          </a>
        </div>
      </div>

      <form method="post" novalidate>
        {% csrf_token %}
        <div class="venue-form-body">
          {% for field in form %}
            <div class="mb-3">
              <label class="venue-form-label" for="{{ field.id_for_label }}">
                {{ field.label }}
                {% if field.field.required %}<span class="text-danger">*</span>{% endif %}
              </label>
              {{ field }}
              {% if field.help_text %}
                <div class="venue-form-help">{{ field.help_text }}</div>
              {% endif %}
              {% for error in field.errors %}
                <div class="text-danger small mt-1">{{ error }}</div>
              {% endfor %}
            </div>
          {% endfor %}

          {% if form.non_field_errors %}
            <div class="alert alert-danger">
              {{ form.non_field_errors }}
            </div>
          {% endif %}
        </div>

        <div class="venue-form-footer">
          <a href="{% url 'events:manage_events' %}" class="btn btn-outline-light">
            Cancel
          </a>
          <button type="submit" class="btn btn-primary">
            Save venue
          </button>
        </div>
      </form>
    </div>
  </div>
</div>
{% endblock %}


==================================================
FILE: ./backend/templates/events/admin_venue_confirm_delete.html
==================================================

{% extends "admin_base.html" %}

{% block title %}Delete Venue | EMS{% endblock %}

{% block content %}
<div class="container py-4">
  <div class="card shadow-sm">
    <div class="card-body">
      <h1 class="h5">Delete venue</h1>
      <p>
        Are you sure you want to permanently delete the venue
        <strong>{{ venue.name }}</strong>?
      </p>
      <form method="post">
        {% csrf_token %}
        <a href="{% url 'admin_venues' %}" class="btn btn-outline-secondary">
          Cancel
        </a>
        <button type="submit" class="btn btn-danger">
          Yes, delete
        </button>
      </form>
    </div>
  </div>
</div>
{% endblock %}


==================================================
FILE: ./backend/templates/events/admin_venue_list.html
==================================================

{% extends "admin_base.html" %}

{% block title %}Manage Venues (Admin) | EMS{% endblock %}

{% block content %}
<div class="container py-4">
  <div class="d-flex justify-content-between align-items-center mb-3">
    <div>
      <h1 class="h4 mb-1">Venues</h1>
      <p class="text-muted mb-0">
        Manage all venues available for events.
      </p>
    </div>
    <div>
      <a href="{% url 'admin_dashboard' %}" class="btn btn-outline-secondary btn-sm me-2">
        ← Back to dashboard
      </a>
      <a href="{% url 'admin_venue_create' %}" class="btn btn-primary btn-sm">
        + New venue
      </a>
    </div>
  </div>

  {# NEW: flash messages #}
  {% if messages %}
    <div class="mb-3">
      {% for message in messages %}
        <div class="alert alert-{{ message.tags|default:'info' }} mb-0">
          {{ message }}
        </div>
      {% endfor %}
    </div>
  {% endif %}

  {% if venues %}
    <div class="card shadow-sm">
      <div class="card-body">
        <div class="table-responsive">
          <table class="table table-hover align-middle">
            <thead class="table-light">
              <tr>
                <th>Name</th>
                <th>Location</th>
                <th>Capacity</th>
                <th class="text-end">Actions</th>
              </tr>
            </thead>
            <tbody>
              {% for venue in venues %}
                <tr>
                  <td>{{ venue.name }}</td>
                  <td>
                    {% if venue.address %}{{ venue.address }}<br>{% endif %}
                    {% if venue.city or venue.state or venue.zipcode %}
                      {{ venue.city }}{% if venue.city and venue.state %}, {% endif %}
                      {{ venue.state }} {% if venue.zipcode %}{{ venue.zipcode }}{% endif %}<br>
                    {% endif %}
                    {% if venue.country %}{{ venue.country }}{% endif %}
                  </td>
                  <td>{{ venue.capacity }}</td>
                  <td class="text-end">
                    <a href="{% url 'admin_venue_edit' venue.venue_id %}" class="btn btn-sm btn-outline-secondary">
                      Edit
                    </a>
                    <a href="{% url 'admin_venue_delete' venue.venue_id %}" class="btn btn-sm btn-outline-danger ms-1">
                      Delete
                    </a>
                  </td>
                </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </div>
    </div>
  {% else %}
    <p class="text-muted">No venues found.</p>
  {% endif %}
</div>
{% endblock %}


==================================================
FILE: ./backend/templates/events/organizer_event_list.html
==================================================

{% extends "base.html" %}

{% block title %}Manage Events | EMS{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
  <div>
    <h1 class="h3 mb-1">Manage your events</h1>
    <p class="text-muted mb-0">
      Organizer: {{ organizer.name }}
    </p>
  </div>
  <div>
    <a href="{% url 'events:organizer_venue_create' %}" class="btn btn-outline-secondary me-2">
      Add Venue
    </a>
    <a href="{% url 'events:organizer_event_create' %}" class="btn btn-primary">
      Create Event
    </a>
  </div>
</div>

{% if events %}
  <div class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-4">
    {% for event in events %}
      <div class="col">
        <div class="card h-100 shadow-sm">
          <div class="card-body">
            <div class="d-flex justify-content-between align-items-start">
              <div>
                <h5 class="card-title mb-1">{{ event.title }}</h5>
                <p class="mb-1 text-muted">
                  {{ event.venue.name }} · {{ event.start_time|date:"M d, Y H:i" }}
                </p>
                <p class="mb-1">
                  <strong>Status:</strong> {{ event.get_status_display }}
                </p>
                {% if event.ticket_price %}
                  <p class="mb-0">
                    <strong>Ticket price:</strong> ${{ event.ticket_price }}
                  </p>
                {% else %}
                  <p class="mb-0 text-muted small">
                    Free or price not set
                  </p>
                {% endif %}
              </div>
              <span class="badge bg-light text-dark">
                {{ event.venue.type }}
              </span>
            </div>
          </div>
          <div class="card-footer bg-white border-0 d-flex justify-content-between">
            <a href="{% url 'events:event_detail' event.event_id %}"
               class="btn btn-sm btn-outline-secondary">
              View public page
            </a>
            <a href="{% url 'events:organizer_event_edit' event.event_id %}"
               class="btn btn-sm btn-primary">
              Edit
            </a>
          </div>
        </div>
      </div>
    {% endfor %}
  </div>
{% else %}
  <div class="alert alert-info">
    You don't have any events yet.
    Use the <strong>Create Event</strong> button to add your first event.
  </div>
{% endif %}
{% endblock %}


==================================================
FILE: ./backend/templates/events/event_detail.html
==================================================

{% extends "base.html" %}

{% block title %}{{ event.title }} | EMS{% endblock %}

{% block extra_head %}
<style>
  .event-hero {
      border-radius: 18px;
      padding: 24px 24px 20px 24px;
      background: linear-gradient(135deg, #6C63FF 0%, #00B4D8 100%);
      color: white;
      box-shadow: 0 10px 26px rgba(0,0,0,0.16);
      margin-bottom: 24px;
  }

  .event-hero-title {
      font-size: 1.8rem;
      font-weight: 600;
  }

  .event-type-badge {
      padding: 4px 10px;
      font-size: .75rem;
      border-radius: 999px;
      font-weight: 600;
  }
  .badge-exhibition { background:#FFD166; color:#6A5300; }
  .badge-conference { background:#06D6A0; color:#004D3A; }
  .badge-concert    { background:#FF6B6B; color:#680000; }
  .badge-sports     { background:#4DABF7; color:#003E73; }

  .status-pill {
      display: inline-flex;
      padding: 4px 10px;
      border-radius: 999px;
      font-size: 0.75rem;
      font-weight: 500;
      background: rgba(255,255,255,0.18);
      color: #ffffff;
  }

  .event-meta-line {
      font-size: 0.9rem;
      opacity: 0.95;
  }

  .info-card {
      border-radius: 16px;
      border: none;
      box-shadow: 0 10px 24px rgba(0,0,0,0.06);
  }

  .event-section-title {
      font-size: 1.05rem;
      font-weight: 600;
      margin-bottom: .5rem;
  }

  .event-label {
      font-weight: 600;
  }
</style>
{% endblock %}

{% block content %}

{# ───────────────────────────── HERO ───────────────────────────── #}
<div class="event-hero">
  <div class="d-flex flex-column flex-md-row justify-content-between">
    <div class="mb-3 mb-md-0">
      <div class="mb-2">
        {% if event.event_type == "EXHIBITION" %}
          <span class="event-type-badge badge-exhibition">Exhibition</span>
        {% elif event.event_type == "CONFERENCE" %}
          <span class="event-type-badge badge-conference">Conference</span>
        {% elif event.event_type == "CONCERT" %}
          <span class="event-type-badge badge-concert">Concert</span>
        {% elif event.event_type == "SPORTS" %}
          <span class="event-type-badge badge-sports">Sports Game</span>
        {% endif %}
        <span class="status-pill ms-2">
          {{ event.get_status_display|default:event.status }}
        </span>
      </div>
      <h1 class="event-hero-title mb-2">{{ event.title }}</h1>
      <p class="event-meta-line mb-0">
        {{ event.venue.name }} &middot;
        {{ event.venue.address }}
        {% if event.venue.city %}, {{ event.venue.city }}{% endif %}
        {% if event.venue.state %}, {{ event.venue.state }}{% endif %}
        {% if event.venue.zipcode %}, {{ event.venue.zipcode }}{% endif %}
        {% if event.venue.country %}, {{ event.venue.country }}{% endif %}
      </p>
    </div>
    <div class="text-md-end">
      <p class="mb-1 event-meta-line">
        <strong>Starts:</strong> {{ event.start_time|date:"M d, Y h:i A" }}
      </p>
      <p class="mb-1 event-meta-line">
        <strong>Ends:</strong> {{ event.end_time|date:"M d, Y h:i A" }}
      </p>

      {# PRICE DISPLAY – based on event_type #}
      {% if event.event_type == "CONCERT" or event.event_type == "SPORTS" %}
        {% if event.ticket_price and event.ticket_price > 0 %}
          <p class="mb-0 event-meta-line">
            <strong>Ticket price:</strong> ${{ event.ticket_price }}
          </p>
        {% else %}
          <p class="mb-0 event-meta-line">
            <strong>Ticket price:</strong> Not set
          </p>
        {% endif %}
      {% elif event.event_type == "EXHIBITION" %}
        <p class="mb-0 event-meta-line">
          <strong>Ticket price:</strong> No ticket required
        </p>
      {% else %}
        {# CONFERENCE: explicit requirement – do NOT show price anywhere #}
      {% endif %}
    </div>
  </div>
</div>

<div class="row g-4">
  {# ───────────────── LEFT: DETAILS ───────────────── #}
  <div class="col-lg-8">
    <div class="card info-card mb-3">
      <div class="card-body">
        <div class="event-section-title">About this event</div>
        {% if event.description %}
          <p>{{ event.description }}</p>
        {% else %}
          <p class="text-muted">
            No description has been provided for this event yet.
          </p>
        {% endif %}
      </div>
    </div>

    <div class="card info-card mb-3">
      <div class="card-body">
        <div class="event-section-title">Schedule & details</div>

        <p class="mb-2">
          <span class="event-label">Starts:</span>
          {{ event.start_time|date:"l, M d, Y h:i A" }}
        </p>
        <p class="mb-2">
          <span class="event-label">Ends:</span>
          {{ event.end_time|date:"l, M d, Y h:i A" }}
        </p>

        <p class="mb-2">
          <span class="event-label">Venue:</span>
            {{ event.venue.name }}{% if event.venue.type %} ({{ event.venue.type }}){% endif %}<br>
            {% if event.venue.address %}
              {{ event.venue.address }}<br>
            {% endif %}
            {% if event.venue.city or event.venue.state or event.venue.zipcode %}
              {{ event.venue.city }}{% if event.venue.city and event.venue.state %}, {% endif %}
              {{ event.venue.state }} {% if event.venue.zipcode %}{{ event.venue.zipcode }}{% endif %}<br>
            {% endif %}
            {% if event.venue.country %}{{ event.venue.country }}{% endif %}
        </p>

        {% if event.event_type != "EXHIBITION" and event.capacity %}
          <p class="mb-2">
            <span class="event-label">Capacity:</span>
            {{ event.capacity }}
          </p>
        {% endif %}

        <p class="mb-0">
          <span class="event-label">Event type:</span>
          {% if event.event_type == "EXHIBITION" %}
            Exhibition – announcement only, no booking required.
          {% elif event.event_type == "CONFERENCE" %}
            Conference – free entry, reservation rules apply. (No ticket price shown.)
          {% elif event.event_type == "CONCERT" %}
            Concert – paid ticket event (per participant, can be multi-day).
          {% elif event.event_type == "SPORTS" %}
            Sports Game – paid ticket event.
          {% endif %}
        </p>
      </div>
    </div>

    <div class="card info-card mb-3">
      <div class="card-body">
        <div class="event-section-title">Organizer</div>
        <p class="mb-1">
          <span class="event-label">Name:</span>
          {{ event.organizer.name }}
        </p>
        <p class="mb-1">
          <span class="event-label">Email:</span>
          <a href="mailto:{{ event.organizer.email }}">{{ event.organizer.email }}</a>
        </p>
        {% if event.organizer.phone %}
          <p class="mb-0">
            <span class="event-label">Phone:</span>
            {{ event.organizer.phone }}
          </p>
        {% endif %}
      </div>
    </div>
  </div>

  {# ───────────────── RIGHT: NEXT STEPS ───────────────── #}
  <div class="col-lg-4">
    <div class="card info-card mb-3">
      <div class="card-body">
        <div class="event-section-title">Next steps</div>

        {% if event.event_type == "EXHIBITION" %}
          <p class="text-muted mb-3">
            This exhibition is for announcement and information only.
            No booking or ticket is required.
          </p>

        {% elif event.event_type == "CONFERENCE" %}
          <p class="text-muted mb-3">
            This is a free conference. Reservations may be managed directly by
            the organizer or the platform administrator.
          </p>
          {# Requirement: no booking button and no price for conferences #}

        {% else %}
          {# CONCERT / SPORTS #}
          <p class="text-muted mb-3">
            This is a paid event. You can book tickets using the button below,
            subject to available capacity.
          </p>

          {% if event.status == "PUBLISHED" or event.status == "published" %}
            <a href="{% url 'bookings:book_event' event.event_id %}"
               class="btn btn-primary w-100 mb-2">
              Book this event
            </a>
          {% else %}
            <p class="text-danger mb-2">
              This event is not currently open for booking.
            </p>
          {% endif %}
        {% endif %}
      </div>
    </div>

    <div class="card info-card">
      <div class="card-body">
        <div class="event-section-title">Need help?</div>
        <p class="mb-2">
          If you have questions about the event, contact the organizer
          using the details above or reach out to the platform administrator.
        </p>
        {% if user.is_authenticated %}
          <p class="mb-0 text-muted">
            You can also ask the <a href="{% url 'chat_page' %}">AI Assistant</a>
            for a quick summary of this event.
          </p>
        {% else %}
          <p class="mb-0 text-muted">
            Log in to use the AI Assistant for summaries and questions.
          </p>
        {% endif %}
      </div>
    </div>
  </div>
</div>

{% endblock %}


==================================================
FILE: ./backend/templates/events/event_list.html
==================================================

{% extends "base.html" %}

{% block title %}Events | EMS{% endblock %}

{% block extra_head %}
<style>
  .events-hero {
    border-radius: 20px;
    padding: 28px 32px;
    background: linear-gradient(135deg, #6C63FF 0%, #00B4D8 100%);
    color: #fff;
    box-shadow: 0 12px 30px rgba(0,0,0,0.15);
  }
  .events-hero-title {
    font-size: 1.9rem;
    font-weight: 700;
    letter-spacing: 0.02em;
  }
  .events-hero-subtitle {
    font-size: 0.98rem;
    opacity: 0.95;
  }
  .event-pill {
    display: inline-flex;
    align-items: center;
    padding: 4px 12px;
    border-radius: 999px;
    background: rgba(255,255,255,0.15);
    font-size: 0.8rem;
  }
  .event-card {
    border-radius: 16px;
    border: none;
    box-shadow: 0 10px 24px rgba(0,0,0,0.06);
    transition: 0.2s ease;
  }
  .event-card:hover {
    transform: translateY(-4px);
    box-shadow: 0 14px 30px rgba(0,0,0,0.12);
  }
  .badge-type {
    padding: 4px 10px;
    border-radius: 999px;
    font-size: 0.7rem;
    font-weight: 600;
  }
  .badge-exhibition { background:#FFD166; color:#6A5300; }
  .badge-conference { background:#06D6A0; color:#004D3A; }
  .badge-concert    { background:#FF6B6B; color:#680000; }
  .badge-sports     { background:#4DABF7; color:#003E73; }
</style>
{% endblock %}

{% block content %}
<div class="container py-4">

  <!-- HERO -->
  <div class="events-hero mb-4">
    <div class="d-flex justify-content-between align-items-start flex-wrap gap-3">
      <div>
        <span class="event-pill mb-2">All published events</span>
        <h1 class="events-hero-title mb-2">Browse all events</h1>
        <p class="events-hero-subtitle mb-0">
          Explore exhibitions, conferences, concerts and sports. Click into any event
          to see full details and booking options.
        </p>
      </div>

      {% if user.is_authenticated and user.userprofile.organizer %}
        <div class="text-md-end">
          <a href="{% url 'events:manage_events' %}"
            class="btn btn-light btn-sm text-dark">
            Go to organizer dashboard
          </a>
        </div>
      {% endif %}

    </div>
  </div>

  {% if events %}
    <div class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-4">
      {% for event in events %}
        <div class="col">
          <div class="card event-card h-100">
            <div class="card-body">
              {% if event.venue.type == "Exhibition" %}
                <span class="badge-type badge-exhibition">Exhibition</span>
              {% elif event.venue.type == "Conference" %}
                <span class="badge-type badge-conference">Conference</span>
              {% elif event.venue.type == "Concert" %}
                <span class="badge-type badge-concert">Concert</span>
              {% elif event.venue.type == "Sports" %}
                <span class="badge-type badge-sports">Sports</span>
              {% endif %}

              <h5 class="mt-3 mb-1" style="color:#6C63FF;">{{ event.title }}</h5>

              <p class="mb-1 text-muted">
                {{ event.venue.name }} · {{ event.organizer.name }}
              </p>

              {% if event.description %}
                <p class="mb-1">
                  {{ event.description|truncatechars:90 }}
                </p>
              {% endif %}

              <p class="mb-1">
                <strong>Starts:</strong> {{ event.start_time|date:"M d, Y H:i" }}
              </p>

              {% if event.ticket_price %}
                <p class="mb-1">
                  <strong>Price:</strong> ${{ event.ticket_price }}
                </p>
              {% else %}
                <p class="mb-1 text-success">
                  <strong>Free event</strong>
                </p>
              {% endif %}

              <a href="{% url 'events:event_detail' event.event_id %}"
                 class="btn btn-primary btn-sm mt-2">
                View details
              </a>
            </div>
          </div>
        </div>
      {% endfor %}
    </div>
  {% else %}
    <div class="alert alert-info mt-3">
      There are no upcoming published events at the moment. Please check back soon.
    </div>
  {% endif %}
</div>
{% endblock %}


==================================================
FILE: ./backend/templates/events/manage_events.html
==================================================

{% extends "base.html" %}

{% block title %}Manage Events | EMS{% endblock %}

{% block extra_head %}
<style>
  .dashboard-hero {
      border-radius: 18px;
      padding: 22px 24px;
      background: linear-gradient(135deg, #6C63FF 0%, #00B4D8 100%);
      color: white;
      box-shadow: 0 10px 26px rgba(0,0,0,0.16);
      margin-bottom: 24px;
  }

  .dashboard-hero-title {
      font-size: 1.6rem;
      font-weight: 600;
  }

  .dashboard-hero-subtitle {
      font-size: 0.95rem;
      opacity: 0.95;
  }

  .stat-card {
      border-radius: 14px;
      border: none;
      box-shadow: 0 8px 20px rgba(0,0,0,0.05);
  }

  .stat-value {
      font-size: 1.4rem;
      font-weight: 600;
      color: #6C63FF;
  }

  .stat-label {
      font-size: 0.85rem;
      color: #6c757d;
  }

  .table > :not(caption) > * > * {
      vertical-align: middle;
  }

  .status-pill {
      display: inline-flex;
      padding: 4px 10px;
      border-radius: 999px;
      font-size: 0.75rem;
      font-weight: 500;
  }

  .status-published {
      background: rgba(25, 135, 84, 0.08);
      color: #198754;
  }

  .status-draft {
      background: rgba(108, 117, 125, 0.08);
      color: #6c757d;
  }

  .status-archived {
      background: rgba(220, 53, 69, 0.08);
      color: #dc3545;
  }
</style>
{% endblock %}

{% block content %}

<!-- DASHBOARD HERO --------------------------------------------------------->
<div class="dashboard-hero">
  <div class="d-flex flex-column flex-md-row justify-content-between align-items-md-center">
    <div class="mb-3 mb-md-0">
      <div class="dashboard-hero-title mb-1">
        Organizer dashboard
      </div>
      <div class="dashboard-hero-subtitle">
        Create events, manage venues, and keep track of your upcoming schedule.
      </div>
    </div>
    <div class="text-md-end">
      <a href="{% url 'events:event_create' %}" class="btn btn-light btn-sm text-dark me-2">
        + New event
      </a>
      <a href="{% url 'events:venue_create' %}" class="btn btn-outline-light btn-sm">
        + New venue
      </a>
    </div>
    <div class="text-end mt-2">
      <a href="{% url 'events:analytics_dashboard' %}" class="btn btn-outline-light btn-sm">
          View analytics
      </a>
    </div>
  </div>
</div>

<!-- STATS ROW -------------------------------------------------------------->
<div class="row g-3 mb-4">
  <div class="col-md-4">
    <div class="card stat-card">
      <div class="card-body">
        <div class="stat-value">
          {{ total_events|default:events|length }}
        </div>
        <div class="stat-label">
          Total events
        </div>
      </div>
    </div>
  </div>
  <div class="col-md-4">
    <div class="card stat-card">
      <div class="card-body">
        <div class="stat-value">
          {{ upcoming_events|default:events|length }}
        </div>
        <div class="stat-label">
          Upcoming events
        </div>
      </div>
    </div>
  </div>
  <div class="col-md-4">
    <div class="card stat-card">
      <div class="card-body">
        <div class="stat-value">
          {{ venues|length }}
        </div>
        <div class="stat-label">
          Venues
        </div>
      </div>
    </div>
  </div>
</div>

<div class="row g-4">
  <!-- EVENTS TABLE --------------------------------------------------------->
  <div class="col-lg-8">
    <div class="card shadow-sm">
      <div class="card-body">
        <div class="d-flex justify-content-between align-items-center mb-3">
          <h5 class="card-title mb-0">Your events</h5>
          <a href="{% url 'events:event_create' %}" class="btn btn-sm btn-primary">
            + Add event
          </a>
        </div>

        {% if events %}
          <div class="table-responsive">
            <table class="table table-hover table-sm align-middle">
              <thead class="table-light">
                <tr>
                  <th>Title</th>
                  <th>Venue</th>
                  <th>Starts</th>
                  <th>Status</th>
                  <th class="text-end">Actions</th>
                </tr>
              </thead>
              <tbody>
                {% for event in events %}
                  <tr>
                    <td>
                      <strong>{{ event.title }}</strong><br>
                      <small class="text-muted">
                        {% if event.capacity %}
                          Capacity: {{ event.capacity }}
                        {% endif %}
                        {% if event.event_type == "CONCERT" or event.event_type == "SPORTS" %}
                          {% if event.ticket_price %}
                            · Price: ${{ event.ticket_price }}
                          {% else %}
                            · Price not set
                          {% endif %}
                        {% elif event.event_type == "CONFERENCE" %}
                          · Free (reservation required)
                        {% elif event.event_type == "EXHIBITION" %}
                          · Exhibition (no booking)
                        {% endif %}
                      </small>
                    </td>
                    <td>
                      {{ event.venue.name }}<br>
                      <small class="text-muted">
                        {{ event.venue.city|default:event.venue.address }}
                        {% if event.venue.state %}, {{ event.venue.state }}{% endif %}
                      </small>
                    </td>
                    <td>{{ event.start_time|date:"M d, Y g:i A" }}</td>
                    <td>
                      {% if event.status == "PUBLISHED" or event.status == "published" %}
                        <span class="status-pill status-published">
                          {{ event.get_status_display|default:event.status }}
                        </span>
                      {% elif event.status == "DRAFT" or event.status == "draft" %}
                        <span class="status-pill status-draft">
                          {{ event.get_status_display|default:event.status }}
                        </span>
                      {% else %}
                        <span class="status-pill status-archived">
                          {{ event.get_status_display|default:event.status }}
                        </span>
                      {% endif %}
                    </td>
                    <td class="text-end">
                      <a href="{% url 'events:event_edit' event.event_id %}"
                        class="btn btn-sm btn-outline-secondary me-1">
                        Edit
                      </a>
                      <a href="{% url 'events:event_detail' event.event_id %}"
                        class="btn btn-sm btn-link me-1">
                        View
                      </a>
                      <a href="{% url 'bookings:organizer_event_bookings' event.event_id %}"
                        class="btn btn-sm btn-outline-primary">
                        Bookings
                      </a>
                    </td>

                  </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
        {% else %}
          <p class="text-muted mb-0">
            You haven’t created any events yet. Start by clicking
            <strong>“Add event”</strong>.
          </p>
        {% endif %}
      </div>
    </div>
  </div>

  <!-- VENUES LIST ---------------------------------------------------------->
  <div class="col-lg-4">
    <div class="card shadow-sm mb-3">
      <div class="card-body">
        <div class="d-flex justify-content-between align-items-center mb-3">
          <h5 class="card-title mb-0">Venues</h5>
          <a href="{% url 'events:venue_create' %}" class="btn btn-sm btn-outline-primary">
            + Add venue
          </a>
        </div>

        {% if venues %}
          <ul class="list-group list-group-flush">
            {% for venue in venues %}
              <li class="list-group-item">
                <div class="d-flex justify-content-between">
                  <div>
                    <strong>{{ venue.name }}</strong><br>
                    <small class="text-muted">
                      Capacity: {{ venue.capacity }}
                      {% if venue.city or venue.state %}
                        · {{ venue.city }}
                        {% if venue.state %}, {{ venue.state }}{% endif %}
                      {% endif %}
                    </small><br>
                    <small class="text-muted">
                      {{ venue.address }}
                      {% if venue.zipcode %}, {{ venue.zipcode }}{% endif %}
                      {% if venue.country %} · {{ venue.country }}{% endif %}
                    </small>
                  </div>
                </div>
              </li>
            {% endfor %}
          </ul>
        {% else %}
          <p class="text-muted mb-0">
            No venues yet. Create one so you can start adding events.
          </p>
        {% endif %}
      </div>
    </div>
  </div>
</div>

{% endblock %}


==================================================
FILE: ./backend/templates/events/admin_event_confirm_delete.html
==================================================

{% extends "admin_base.html" %}

{% block title %}Delete Event | EMS{% endblock %}

{% block content %}
<div class="container py-4">
    <div class="row justify-content-center">
        <div class="col-md-6">
            <div class="card shadow border-danger">
                <div class="card-header bg-danger text-white">
                    <h5 class="mb-0">⚠ Confirm Deletion</h5>
                </div>
                <div class="card-body">
                    <p class="lead">
                        Are you sure you want to delete the event:
                        <br>
                        <strong>"{{ event.title }}"</strong>?
                    </p>
                    
                    <div class="alert alert-warning">
                        <small>This action cannot be undone.</small>
                    </div>

                    <form method="POST">
                        {% csrf_token %}
                        <div class="d-flex justify-content-between mt-4">
                            <!-- Cancel: Go back to Event List -->
                            <a href="{% url 'admin_events' %}" class="btn btn-outline-secondary">
                                Cancel
                            </a>
                            
                            <!-- Confirm: Submit POST request to delete -->
                            <button type="submit" class="btn btn-danger">
                                Yes, Delete Event
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

==================================================
FILE: ./backend/templates/events/admin_event_list.html
==================================================

{% extends "admin_base.html" %}

{% block title %}Manage Events (Admin) | EMS{% endblock %}

{% block content %}
<div class="container py-4">
  <div class="d-flex justify-content-between align-items-center mb-3">
    <div>
      <h1 class="h4 mb-1">Events</h1>
      <p class="text-muted mb-0">
        View, create, and edit all events in the system.
      </p>
    </div>
    <div>
      <a href="{% url 'admin_dashboard' %}" class="btn btn-outline-secondary btn-sm me-2">
        ← Back to dashboard
      </a>
      <a href="{% url 'admin_event_create' %}" class="btn btn-primary btn-sm">
        + New event
      </a>
    </div>
  </div>

  {% if messages %}
  <div class="mb-3">
    {% for message in messages %}
      <div class="alert alert-{{ message.tags|default:'info' }} mb-0">
        {{ message }}
      </div>
    {% endfor %}
  </div>
{% endif %}

  {% if events %}
    <div class="card shadow-sm">
      <div class="card-body">
        <div class="table-responsive">
          <table class="table table-hover align-middle">
            <thead class="table-light">
              <tr>
                <th>Title</th>
                <th>Organizer</th>
                <th>Venue</th>
                <th>Start</th>
                <th>Status</th>
                <th class="text-end">Actions</th>
              </tr>
            </thead>
            <tbody>
              {% for event in events %}
                <tr>
                  <td>{{ event.title }}</td>
                  <td>{{ event.organizer.name }}</td>
                  <td>{{ event.venue.name }}</td>
                  <td>{{ event.start_time|date:"M d, Y H:i" }}</td>
                  <td>{{ event.get_status_display }}</td>
                  <td class="text-end">
                    <a href="{% url 'admin_event_edit' event.event_id %}" class="btn btn-sm btn-outline-secondary">
                      Edit
                    </a>
                    <a href="{% url 'admin_event_delete' event.event_id %}" class="btn btn-sm btn-outline-danger ms-1">
                      Delete
                    </a>
                  </td>
                </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </div>
    </div>
  {% else %}
    <p class="text-muted">No events found.</p>
  {% endif %}
</div>
{% endblock %}


==================================================
FILE: ./backend/templates/events/organizer_analytics.html
==================================================

{% extends "base.html" %}

{% block title %}Analytics | EMS{% endblock %}

{% block extra_head %}
<style>
  .analytics-hero {
    border-radius: 24px;
    padding: 24px 32px;
    background: linear-gradient(135deg, #4f46e5, #06b6d4);
    color: #f9fafb;
    box-shadow: 0 18px 40px rgba(15, 23, 42, 0.45);
  }

  .analytics-kpi-row {
    margin-top: 24px;
    margin-bottom: 24px;
  }

  .analytics-kpi-card {
    border-radius: 18px;
    padding: 18px 20px;
    border: 1px solid rgba(148, 163, 184, 0.35);
    box-shadow: 0 14px 32px rgba(15, 23, 42, 0.6);
    background: radial-gradient(circle at top left, rgba(148, 163, 184, 0.28), rgba(15, 23, 42, 0.95));
    color: #e5e7eb;
  }

  .analytics-kpi-label {
    font-size: 0.8rem;
    letter-spacing: 0.08em;
    text-transform: uppercase;
    color: #9ca3af;
    margin-bottom: 4px;
  }

  .analytics-kpi-value {
    font-size: 1.7rem;
    font-weight: 700;
    color: #f9fafb;
  }

  .analytics-kpi-sub {
    font-size: 0.86rem;
    color: #9ca3af;
  }

  .analytics-section-card {
    border-radius: 22px;
    border: 1px solid rgba(148, 163, 184, 0.35);
    padding: 20px 22px 18px;
    box-shadow: 0 18px 40px rgba(15, 23, 42, 0.65);
    background: radial-gradient(circle at top left, rgba(55, 65, 81, 0.55), rgba(15, 23, 42, 0.98));
    color: #f9fafb;
  }

  .analytics-section-title {
    font-size: 1.1rem;
    font-weight: 600;
    margin-bottom: 14px;
  }

  .analytics-table {
    width: 100%;
    font-size: 0.9rem;
  }

  .analytics-table thead th {
    border-bottom: 1px solid rgba(148, 163, 184, 0.6);
    padding-bottom: 8px;
    font-weight: 600;
    color: #e5e7eb;
  }

  .analytics-table tbody td {
    padding-top: 9px;
    padding-bottom: 9px;
    border-bottom: 1px solid rgba(55, 65, 81, 0.8);
    color: #e5e7eb;
  }

  .analytics-table tbody tr:last-child td {
    border-bottom: none;
  }

  .analytics-month-item {
    padding: 10px 0;
    border-bottom: 1px solid rgba(55, 65, 81, 0.8);
  }

  .analytics-month-item:last-child {
    border-bottom: none;
  }

  .analytics-month-label {
    font-weight: 500;
    color: #e5e7eb;
  }

  .analytics-month-meta {
    font-size: 0.8rem;
    color: #9ca3af;
  }

  .analytics-month-bar {
    height: 6px;
    border-radius: 999px;
    background: linear-gradient(90deg, #4f46e5, #22c55e);
    margin-top: 6px;
  }

  /* Make sure text stays readable in light mode too */
  body.light-mode .analytics-kpi-card,
  body.light-mode .analytics-section-card {
    background: radial-gradient(circle at top left, rgba(148, 163, 184, 0.5), rgba(15, 23, 42, 0.98));
    color: #f9fafb;
  }

  body.light-mode .analytics-kpi-label,
  body.light-mode .analytics-kpi-sub,
  body.light-mode .analytics-month-meta {
    color: #e5e7eb;
  }
</style>
{% endblock %}

{% block content %}
<div class="container py-4">
  <!-- HERO -->
  <div class="analytics-hero mb-4 d-flex justify-content-between align-items-start">
    <div>
      <h2 class="mb-1">Analytics</h2>
      <p class="mb-0">
        See how your events are performing – bookings, tickets and revenue in one place.
      </p>
    </div>
    <div class="text-end">
      <a href="{% url 'events:manage_events' %}" class="btn btn-outline-light btn-sm">
        ← Back to dashboard
      </a>
    </div>
  </div>

  <!-- KPI ROW -->
  <div class="row analytics-kpi-row">
    <div class="col-md-3 mb-3">
      <div class="analytics-kpi-card h-100">
        <div class="analytics-kpi-label">Events</div>
        <div class="analytics-kpi-value">{{ total_events }}</div>
        <div class="analytics-kpi-sub">
          {{ upcoming_events }} upcoming
        </div>
      </div>
    </div>
    <div class="col-md-3 mb-3">
      <div class="analytics-kpi-card h-100">
        <div class="analytics-kpi-label">Bookings</div>
        <div class="analytics-kpi-value">{{ total_bookings }}</div>
        <div class="analytics-kpi-sub">
          Non-cancelled bookings
        </div>
      </div>
    </div>
    <div class="col-md-3 mb-3">
      <div class="analytics-kpi-card h-100">
        <div class="analytics-kpi-label">Tickets sold</div>
        <div class="analytics-kpi-value">{{ total_tickets }}</div>
        <div class="analytics-kpi-sub">
          Across all events
        </div>
      </div>
    </div>
    <div class="col-md-3 mb-3">
      <div class="analytics-kpi-card h-100">
        <div class="analytics-kpi-label">Revenue</div>
        <div class="analytics-kpi-value">${{ total_revenue | floatformat:2}}</div>
        <div class="analytics-kpi-sub">
          Sum of payments
        </div>
      </div>
    </div>
  </div>

  <!-- MAIN ROW -->
  <div class="row g-4">
    <!-- Per-event performance -->
    <div class="col-lg-7">
      <div class="analytics-section-card h-100">
        <div class="analytics-section-title">Performance by event</div>
        {% if per_event %}
          <div class="table-responsive">
            <table class="analytics-table">
              <thead>
                <tr>
                  <th class="text-start">Event</th>
                  <th class="text-center">Bookings</th>
                  <th class="text-center">Tickets</th>
                  <th class="text-end">Revenue</th>
                </tr>
              </thead>
              <tbody>
                {% for row in per_event %}
                  <tr>
                    <td class="text-start">{{ row.event__title }}</td>
                    <td class="text-center">{{ row.bookings }}</td>
                    <td class="text-center">{{ row.tickets|default:"0" }}</td>
                    <td class="text-end">
                      ${{ row.revenue|default:"0" | floatformat:2}}
                    </td>
                  </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
        {% else %}
          <p class="text-muted mb-0">No bookings yet for your events.</p>
        {% endif %}
      </div>
    </div>

    <!-- Last 6 months -->
    <div class="col-lg-5">
      <div class="analytics-section-card h-100">
        <div class="analytics-section-title">Last 6 months</div>
        <p class="analytics-month-meta mb-3">
          Bookings and tickets per month (non-cancelled).
        </p>

        {% if monthly %}
          {% for m in monthly %}
            <div class="analytics-month-item">
              <div class="d-flex justify-content-between">
                <span class="analytics-month-label">
                  {{ m.month|date:"M Y" }}
                </span>
                <span class="analytics-month-meta">
                  {{ m.bookings }} bookings · {{ m.tickets|default:"0" }} tickets
                </span>
              </div>
              <div class="analytics-month-bar"></div>
            </div>
          {% endfor %}
        {% else %}
          <p class="text-muted mb-0">
            Not enough data yet. Once you start receiving bookings, monthly trends will appear here.
          </p>
        {% endif %}
      </div>
    </div>
  </div>
</div>
{% endblock %}


==================================================
FILE: ./backend/templates/events/admin_event_form.html
==================================================

{% extends "admin_base.html" %}

{% block title %}
  {% if mode == "edit" %}Admin: Edit Event | EMS{% else %}Admin: New Event | EMS{% endif %}
{% endblock %}

{% block extra_head %}
<style>
  .event-form-shell {
    max-width: 1040px;
    margin: 0 auto;
  }

  .event-form-card {
    border-radius: 26px;
    border: 1px solid rgba(148, 163, 184, 0.45);
    padding: 0;
    overflow: hidden;
    box-shadow: 0 26px 60px rgba(15, 23, 42, 0.8);
    background: radial-gradient(circle at top left, rgba(30, 64, 175, 0.55), #020617);
    color: #e5e7eb;
  }

  .event-form-header {
    padding: 18px 24px;
    background: linear-gradient(135deg, #4f46e5, #06b6d4);
    color: #f9fafb;
  }

  .event-form-header h2 {
    font-size: 1.4rem;
    margin-bottom: 4px;
  }

  .event-form-header p {
    margin: 0;
    font-size: 0.9rem;
    opacity: 0.92;
  }

  .event-form-body {
    padding: 22px 24px 22px;
  }

  .event-form-label {
    font-weight: 500;
    font-size: 0.88rem;
    color: #e5e7eb;
  }

  .event-form-help {
    font-size: 0.78rem;
    color: #9ca3af;
  }

  .event-form-body input,
  .event-form-body select,
  .event-form-body textarea {
    background-color: rgba(15, 23, 42, 0.9) !important;
    border: 1px solid rgba(148, 163, 184, 0.6) !important;
    color: #f9fafb !important;
    border-radius: 12px;
  }

  .event-form-body input:focus,
  .event-form-body select:focus,
  .event-form-body textarea:focus {
    outline: none;
    box-shadow: 0 0 0 1px #4f46e5;
    border-color: #4f46e5 !important;
  }

  .event-form-footer {
    padding: 16px 24px 22px;
    border-top: 1px solid rgba(31, 41, 55, 0.9);
    display: flex;
    justify-content: space-between;
    align-items: center;
  }

  .event-form-footer .text-muted {
    color: white !important;
  }

  .event-form-actions .btn {
    border-radius: 999px;
    padding-inline: 22px;
  }

  body.light-mode .event-form-card {
    background: radial-gradient(circle at top left, rgba(30, 64, 175, 0.55), #020617);
    color: #e5e7eb;
  }
</style>
{% endblock %}

{% block content %}
<div class="container py-4">
  <div class="event-form-shell">
    <div class="event-form-card">
      <div class="event-form-header d-flex justify-content-between align-items-center">
        <div>
          <h2>
            {% if mode == "edit" %}
              Admin · Edit event: {{ event.title }}
            {% else %}
              Admin · Create a new event
            {% endif %}
          </h2>
          <p>
            Set organizer, venue, type, schedule, capacity and pricing. Past dates are not allowed.
          </p>
        </div>
        <div>
          <a href="{% url 'admin_events' %}" class="btn btn-outline-light btn-sm">
            Back to Events
          </a>
        </div>
      </div>

      <form method="post" novalidate>
        {% csrf_token %}
        <div class="event-form-body">
          {% for field in form %}
            {# capacity & ticket_price get special containers for JS #}
            {% if field.name == "capacity" %}
              <div class="mb-3 js-capacity-field">
            {% elif field.name == "ticket_price" %}
              <div class="mb-3 js-price-field">
            {% else %}
              <div class="mb-3">
            {% endif %}
                <label class="event-form-label" for="{{ field.id_for_label }}">
                  {{ field.label }}
                  {% if field.field.required %}<span class="text-danger">*</span>{% endif %}
                </label>
                {{ field }}
                {% if field.help_text %}
                  <div class="event-form-help">{{ field.help_text }}</div>
                {% endif %}
                {% for error in field.errors %}
                  <div class="text-danger small mt-1">{{ error }}</div>
                {% endfor %}
              </div>
          {% endfor %}

          {% if form.non_field_errors %}
            <div class="alert alert-danger">
              {{ form.non_field_errors }}
            </div>
          {% endif %}
        </div>

        <div class="event-form-footer">
          <small class="text-muted">
            Admin changes apply immediately. You can always return and adjust event details.
          </small>
          <div class="event-form-actions">
            <a href="{% url 'admin_events' %}" class="btn btn-outline-light me-2">
              Cancel
            </a>
            <button type="submit" class="btn btn-primary">
              {% if mode == "edit" %}Save changes{% else %}Create event{% endif %}
            </button>
          </div>
        </div>
      </form>
    </div>
  </div>
</div>

<script>
  (function () {
    const typeSelect = document.getElementById("id_event_type");
    const capacityGroup = document.querySelector(".js-capacity-field");
    const priceGroup = document.querySelector(".js-price-field");

    function updateVisibility() {
      if (!typeSelect) return;
      const value = typeSelect.value; // "EXHIBITION", "CONFERENCE", "CONCERT", "SPORTS"

      // default: show both
      if (capacityGroup) capacityGroup.style.display = "";
      if (priceGroup) priceGroup.style.display = "";

      if (value === "EXHIBITION") {
        // Exhibition: no capacity, no price
        if (capacityGroup) capacityGroup.style.display = "none";
        if (priceGroup) priceGroup.style.display = "none";
      } else if (value === "CONFERENCE") {
        // Conference: capacity yes, price no
        if (capacityGroup) capacityGroup.style.display = "";
        if (priceGroup) priceGroup.style.display = "none";
      } else {
        // CONCERT or SPORTS: both capacity and price shown
        if (capacityGroup) capacityGroup.style.display = "";
        if (priceGroup) priceGroup.style.display = "";
      }
    }

    if (typeSelect) {
      typeSelect.addEventListener("change", updateVisibility);
      updateVisibility(); // apply on initial load
    }
  })();
</script>
{% endblock %}


==================================================
FILE: ./backend/templates/events/event_form.html
==================================================

{% extends "base.html" %}

{% block title %}
  {% if mode == "edit" %}Edit Event | EMS{% else %}New Event | EMS{% endif %}
{% endblock %}

{% block extra_head %}
<style>
  .event-form-shell {
    max-width: 960px;
    margin: 0 auto;
  }

  .event-form-card {
    border-radius: 26px;
    border: 1px solid rgba(148, 163, 184, 0.45);
    padding: 0;
    overflow: hidden;
    box-shadow: 0 26px 60px rgba(15, 23, 42, 0.8);
    background: radial-gradient(circle at top left, rgba(30, 64, 175, 0.55), #020617);
    color: #e5e7eb;
  }

  .event-form-header {
    padding: 18px 24px;
    background: linear-gradient(135deg, #4f46e5, #06b6d4);
    color: #f9fafb;
  }

  .event-form-header h2 {
    font-size: 1.4rem;
    margin-bottom: 4px;
  }

  .event-form-header p {
    margin: 0;
    font-size: 0.9rem;
    opacity: 0.92;
  }

  .event-form-body {
    padding: 22px 24px 22px;
  }

  .event-form-label {
    font-weight: 500;
    font-size: 0.88rem;
    color: #e5e7eb;
  }

  .event-form-help {
    font-size: 0.78rem;
    color: #9ca3af;
  }

  /* 🔧 Style ALL inputs/selects/textareas inside the body (no as_widget hacks needed) */
  .event-form-body input,
  .event-form-body select,
  .event-form-body textarea {
    background-color: rgba(15, 23, 42, 0.9) !important;
    border: 1px solid rgba(148, 163, 184, 0.6) !important;
    color: #f9fafb !important;
    border-radius: 12px;
  }

  .event-form-body input:focus,
  .event-form-body select:focus,
  .event-form-body textarea:focus {
    outline: none;
    box-shadow: 0 0 0 1px #4f46e5;
    border-color: #4f46e5 !important;
  }

  .event-form-footer {
    padding: 16px 24px 22px;
    border-top: 1px solid rgba(31, 41, 55, 0.9);
    display: flex;
    justify-content: space-between;
    align-items: center;

  }
  .event-form-footer .text-muted {
    color: white !important;
  }

  .event-form-actions .btn {
    border-radius: 999px;
    padding-inline: 22px;
  }

  body.light-mode .event-form-card {
    /* keep card dark even in light mode for better contrast */
    background: radial-gradient(circle at top left, rgba(30, 64, 175, 0.55), #020617);
    color: #e5e7eb;
  }
</style>
{% endblock %}

{% block content %}
<div class="container py-4">
  <div class="event-form-shell">
    <div class="event-form-card">
      <div class="event-form-header d-flex justify-content-between align-items-center">
        <div>
          <h2>
            {% if mode == "edit" %}Edit event: {{ event.title }}{% else %}Create a new event{% endif %}
          </h2>
          <p>Define the venue, time, capacity and pricing. Past dates are not allowed.</p>
        </div>
        <div>
          <a href="{% url 'events:manage_events' %}" class="btn btn-outline-light btn-sm">
            Back to Manage
          </a>
        </div>
      </div>

      <form method="post" novalidate>
        {% csrf_token %}
        <div class="event-form-body">
          {% for field in form %}
            {# Give capacity and ticket_price special hooks #}
            {% if field.name == "capacity" %}
              <div class="mb-3 js-capacity-field">
            {% elif field.name == "ticket_price" %}
              <div class="mb-3 js-price-field">
            {% else %}
              <div class="mb-3">
            {% endif %}
                <label class="event-form-label" for="{{ field.id_for_label }}">
                  {{ field.label }}
                  {% if field.field.required %}<span class="text-danger">*</span>{% endif %}
                </label>
                {{ field }}
                {% if field.help_text %}
                  <div class="event-form-help">{{ field.help_text }}</div>
                {% endif %}
                {% for error in field.errors %}
                  <div class="text-danger small mt-1">{{ error }}</div>
                {% endfor %}
              </div>
          {% endfor %}

          {% if form.non_field_errors %}
            <div class="alert alert-danger">
              {{ form.non_field_errors }}
            </div>
          {% endif %}
        </div>

          {% if form.non_field_errors %}
            <div class="alert alert-danger">
              {{ form.non_field_errors }}
            </div>
          {% endif %}
        </div>

        <div class="event-form-footer">
          <small class="text-muted" style="color: white;">
            Changes are applied only to this event. You can edit details later from the dashboard.
          </small>
          <div class="event-form-actions">
            <a href="{% url 'events:manage_events' %}" class="btn btn-outline-light me-2">
              Cancel
            </a>
            <button type="submit" class="btn btn-primary">
              {% if mode == "edit" %}Save changes{% else %}Create event{% endif %}
            </button>
          </div>
        </div>
      </form>
    </div>
  </div>
</div>
<script>
  (function () {
    const typeSelect = document.getElementById("id_event_type");
    const capacityGroup = document.querySelector(".js-capacity-field");
    const priceGroup = document.querySelector(".js-price-field");

    function updateVisibility() {
      if (!typeSelect) return;
      const value = typeSelect.value;  // "EXHIBITION", "CONFERENCE", "CONCERT", "SPORTS"

      // Default: hide nothing
      if (capacityGroup) capacityGroup.style.display = "";
      if (priceGroup) capacityGroup && (priceGroup.style.display = "");

      if (value === "EXHIBITION") {
        // Exhibition: no capacity, no price
        if (capacityGroup) capacityGroup.style.display = "none";
        if (priceGroup) priceGroup.style.display = "none";
      } else if (value === "CONFERENCE") {
        // Conference: capacity yes, price NO
        if (capacityGroup) capacityGroup.style.display = "";
        if (priceGroup) priceGroup.style.display = "none";
      } else {
        // CONCERT or SPORTS: both capacity and price
        if (capacityGroup) capacityGroup.style.display = "";
        if (priceGroup) priceGroup.style.display = "";
      }
    }

    if (typeSelect) {
      typeSelect.addEventListener("change", updateVisibility);
      // Run once on page load so edit forms reflect current value
      updateVisibility();
    }
  })();
</script>
{% endblock %}




==================================================
FILE: ./backend/events/models.py
==================================================

from django.db import models
from django.core.validators import MinValueValidator, MaxValueValidator
from django.conf import settings
from django.core.exceptions import ValidationError
from django.utils import timezone


# Organizer Table (unchanged except for status/created_at we added earlier)
class Organizer(models.Model):
    STATUS_CHOICES = [
        ("PENDING", "Pending"),
        ("APPROVED", "Approved"),
        ("REJECTED", "Rejected"),
    ]

    organizer_id = models.AutoField(primary_key=True)

    user = models.OneToOneField(
        settings.AUTH_USER_MODEL,
        on_delete=models.CASCADE,
        null=True,
        blank=True,
        related_name="organizer_profile",
        help_text="Optional link to a login account for this organizer.",
    )

    name = models.CharField(max_length=120)
    email = models.EmailField(max_length=150, unique=True)
    phone = models.CharField(max_length=20, blank=True, null=True)

    status = models.CharField(
        max_length=10,
        choices=STATUS_CHOICES,
        default="PENDING",
        help_text="Organizer must be APPROVED by an admin before managing events.",
    )
    created_at = models.DateTimeField(auto_now_add=True, null=True, blank=True)

    class Meta:
        db_table = "ORGANIZER"

    def __str__(self):
        return f"{self.name} ({self.get_status_display()})"


# Venue Table
class Venue(models.Model):
    venue_id = models.AutoField(primary_key=True)
    name = models.CharField(max_length=120)

    # Address fields (venue-level, NOT event type anymore)
    address = models.CharField(max_length=255)  # street
    city = models.CharField(max_length=100, null=True, blank=True)
    state = models.CharField(max_length=100, null=True, blank=True)
    zipcode = models.CharField(max_length=20, null=True, blank=True)
    country = models.CharField(max_length=100, null=True, blank=True)

    capacity = models.IntegerField(
        validators=[MinValueValidator(1), MaxValueValidator(50000)]
    )

    class Meta:
        db_table = "VENUE"

    def __str__(self):
        return self.name


# Event Table
class Event(models.Model):
    STATUS_CHOICES = [
        ("DRAFT", "Draft"),
        ("PUBLISHED", "Published"),
        ("CANCELLED", "Cancelled"),
    ]

    EVENT_TYPE_CHOICES = [
        ("EXHIBITION", "Exhibition"),
        ("CONFERENCE", "Conference"),
        ("CONCERT", "Concert"),
        ("SPORTS", "Sports Game"),
    ]

    event_id = models.AutoField(primary_key=True)
    organizer = models.ForeignKey(
        Organizer,
        on_delete=models.PROTECT,
        related_name="events",
    )
    venue = models.ForeignKey(
        Venue,
        on_delete=models.PROTECT,
        related_name="events",
    )

    event_type = models.CharField(
        max_length=20,
        choices=EVENT_TYPE_CHOICES,
        default="EXHIBITION",
        help_text="Determines whether the event is free/paid and how bookings work.",
    )

    title = models.CharField(max_length=150)
    description = models.TextField(
        blank=True,
        null=True,
        help_text="Optional detailed description of the event.",
    )
    start_time = models.DateTimeField()
    end_time = models.DateTimeField()

    # Capacity is event-specific now (can differ from venue capacity if needed)
    capacity = models.IntegerField(
        validators=[MinValueValidator(1), MaxValueValidator(50000)],
        blank=True,
        null=True,
        help_text="Required for conferences and paid events. Ignored for exhibitions.",
    )

    status = models.CharField(max_length=20, choices=STATUS_CHOICES)

    ticket_price = models.DecimalField(
        max_digits=10,
        decimal_places=2,
        null=True,
        blank=True,
        help_text=(
            "Required for Concert and Sports events. "
            "Must be zero or blank for Conferences and Exhibitions."
        ),
    )

    def clean(self):
        """
        Enforce:
        - start_time is not in the past (using current LOCAL timezone)
        - end_time is strictly after start_time
        - type-specific rules for capacity and ticket_price
        """
        super().clean()

        errors = {}

        # Datetime checks
        if self.start_time and self.end_time:
            now_local = timezone.localtime(timezone.now())
            start_local = timezone.localtime(self.start_time)
            end_local = timezone.localtime(self.end_time)

            if start_local < now_local:
                errors["start_time"] = "Start time cannot be in the past."

            if end_local <= start_local:
                errors["end_time"] = "End time must be after the start time."

        # Type-specific rules
        if self.event_type == "EXHIBITION":
            # No capacity / no price required
            if self.ticket_price not in (None, 0):
                errors["ticket_price"] = "Exhibitions must not have a ticket price."
        elif self.event_type == "CONFERENCE":
            # Must be free, but capacity is required
            if not self.capacity:
                errors["capacity"] = "Capacity is required for conferences."
            if self.ticket_price not in (None, 0) and self.ticket_price != 0:
                errors["ticket_price"] = "Conferences must be free (ticket price 0)."
        elif self.event_type in ("CONCERT", "SPORTS"):
            # Paid events: capacity + positive ticket price are required
            if not self.capacity:
                errors["capacity"] = "Capacity is required for paid events."
            if self.ticket_price is None or self.ticket_price <= 0:
                errors["ticket_price"] = "Ticket price must be greater than 0 for paid events."

        if errors:
            raise ValidationError(errors)

    class Meta:
        db_table = "EVENT"

    def __str__(self):
        return f"{self.title} @ {self.venue.name}"


==================================================
FILE: ./backend/events/__init__.py
==================================================



==================================================
FILE: ./backend/events/apps.py
==================================================

from django.apps import AppConfig


class EventsConfig(AppConfig):
    default_auto_field = 'django.db.models.BigAutoField'
    name = 'events'


==================================================
FILE: ./backend/events/forms.py
==================================================

# backend/events/forms.py

from django import forms
from django.utils import timezone

from .models import Event, Venue


class EventForm(forms.ModelForm):
    """
    Generic event form used on the organizer dashboard (create/edit).
    Now includes event_type so organizers choose what kind of event this is.
    """

    class Meta:
        model = Event
        fields = [
            "event_type",   # <- NEW: event type belongs to Event, not Venue
            "venue",
            "title",
            "description",
            "start_time",
            "end_time",
            "capacity",
            "status",
            "ticket_price",
        ]
        widgets = {
            "event_type": forms.Select(attrs={"class": "form-select"}),
            "venue": forms.Select(attrs={"class": "form-select"}),
            "title": forms.TextInput(
                attrs={"class": "form-control", "placeholder": "Event title"}
            ),
            "description": forms.Textarea(
                attrs={
                    "class": "form-control",
                    "rows": 4,
                    "placeholder": "Describe your event (optional)…",
                }
            ),
            "start_time": forms.DateTimeInput(
                attrs={
                    "class": "form-control",
                    "type": "datetime-local",
                }
            ),
            "end_time": forms.DateTimeInput(
                attrs={
                    "class": "form-control",
                    "type": "datetime-local",
                }
            ),
            "capacity": forms.NumberInput(
                attrs={"class": "form-control", "min": 1}
            ),
            "status": forms.Select(attrs={"class": "form-select"}),
            "ticket_price": forms.NumberInput(
                attrs={"class": "form-control", "step": "0.01", "min": 0}
            ),
        }

    def clean(self):
        """
        Extra safety on top of the model.clean():
        - ensure start_time is not in the past (server time)
        - ensure end_time is after start_time
        """
        cleaned_data = super().clean()
        start_time = cleaned_data.get("start_time")
        end_time = cleaned_data.get("end_time")

        now = timezone.now()

        if start_time and start_time < now:
            self.add_error("start_time", "Start time cannot be in the past.")

        if start_time and end_time and end_time <= start_time:
            self.add_error("end_time", "End time must be after the start time.")

        return cleaned_data


class OrganizerEventForm(EventForm):
    """
    Alias/thin subclass of EventForm, kept for backward compatibility.
    """
    class Meta(EventForm.Meta):
        pass


class OrganizerVenueForm(forms.ModelForm):
    """
    Venue form for organizers to create/edit venues from the UI.
    Venue no longer stores event type; only address and capacity.
    """

    class Meta:
        model = Venue
        fields = [
            "name",
            "address",
            "city",
            "state",
            "zipcode",
            "country",
            "capacity",
        ]
        widgets = {
            "name": forms.TextInput(
                attrs={"class": "form-control", "placeholder": "Venue name"}
            ),
            "address": forms.TextInput(
                attrs={"class": "form-control", "placeholder": "Street address"}
            ),
            "city": forms.TextInput(
                attrs={"class": "form-control", "placeholder": "City"}
            ),
            "state": forms.TextInput(
                attrs={"class": "form-control", "placeholder": "State"}
            ),
            "zipcode": forms.TextInput(
                attrs={"class": "form-control", "placeholder": "Zip code"}
            ),
            "country": forms.TextInput(
                attrs={"class": "form-control", "placeholder": "Country"}
            ),
            "capacity": forms.NumberInput(
                attrs={"class": "form-control", "min": 1}
            ),
        }


# ─────────────────────────────────────────────────────────────
# Admin forms (used only in the custom admin portal)
# ─────────────────────────────────────────────────────────────

class AdminEventForm(forms.ModelForm):
    """
    Admin-facing event form.

    Admin can choose organizer as well as venue and event_type.
    """

    class Meta:
        model = Event
        fields = [
            "organizer",
            "event_type",
            "venue",
            "title",
            "description",
            "start_time",
            "end_time",
            "capacity",
            "status",
            "ticket_price",
        ]
        widgets = {
            "organizer": forms.Select(attrs={"class": "form-select"}),
            "event_type": forms.Select(attrs={"class": "form-select"}),
            "venue": forms.Select(attrs={"class": "form-select"}),
            "title": forms.TextInput(
                attrs={"class": "form-control", "placeholder": "Event title"}
            ),
            "description": forms.Textarea(
                attrs={
                    "class": "form-control",
                    "rows": 4,
                    "placeholder": "Describe the event (optional)…",
                }
            ),
            "start_time": forms.DateTimeInput(
                attrs={"class": "form-control", "type": "datetime-local"}
            ),
            "end_time": forms.DateTimeInput(
                attrs={"class": "form-control", "type": "datetime-local"}
            ),
            "capacity": forms.NumberInput(
                attrs={"class": "form-control", "min": 1}
            ),
            "status": forms.Select(attrs={"class": "form-select"}),
            "ticket_price": forms.NumberInput(
                attrs={"class": "form-control", "step": "0.01", "min": 0}
            ),
        }

    def clean(self):
        """
        Reuse the same validation rules as EventForm.
        """
        cleaned_data = super().clean()
        start_time = cleaned_data.get("start_time")
        end_time = cleaned_data.get("end_time")
        now = timezone.now()

        if start_time and start_time < now:
            self.add_error("start_time", "Start time cannot be in the past.")

        if start_time and end_time and end_time <= start_time:
            self.add_error("end_time", "End time must be after the start time.")

        return cleaned_data


class AdminVenueForm(forms.ModelForm):
    """
    Admin-facing venue form. Fields match the new Venue schema.
    """

    class Meta:
        model = Venue
        fields = [
            "name",
            "address",
            "city",
            "state",
            "zipcode",
            "country",
            "capacity",
        ]
        widgets = {
            "name": forms.TextInput(
                attrs={"class": "form-control", "placeholder": "Venue name"}
            ),
            "address": forms.TextInput(
                attrs={"class": "form-control", "placeholder": "Street address"}
            ),
            "city": forms.TextInput(
                attrs={"class": "form-control", "placeholder": "City"}
            ),
            "state": forms.TextInput(
                attrs={"class": "form-control", "placeholder": "State"}
            ),
            "zipcode": forms.TextInput(
                attrs={"class": "form-control", "placeholder": "Zip code"}
            ),
            "country": forms.TextInput(
                attrs={"class": "form-control", "placeholder": "Country"}
            ),
            "capacity": forms.NumberInput(
                attrs={"class": "form-control", "min": 1}
            ),
        }


==================================================
FILE: ./backend/events/admin.py
==================================================

from django.contrib import admin
from .models import Organizer, Venue, Event


@admin.register(Organizer)
class OrganizerAdmin(admin.ModelAdmin):
    list_display = ("organizer_id", "name", "email", "phone", "status")
    list_filter = ("status",)
    search_fields = ("name", "email")


@admin.register(Venue)
class VenueAdmin(admin.ModelAdmin):
    list_display = (
        "venue_id",
        "name",
        "address",
        "city",
        "state",
        "capacity",
    )
    # No more "type" field – filter by city/state instead
    list_filter = ("city", "state")
    search_fields = ("name", "address", "city", "state", "country")


@admin.register(Event)
class EventAdmin(admin.ModelAdmin):
    list_display = (
        "title",
        "event_type",     # ← new: event type on Event
        "venue",
        "organizer",
        "start_time",
        "status",
        "ticket_price",
    )
    # No more "venue__type" – filter by event_type instead
    list_filter = ("status", "event_type")
    search_fields = ("title", "venue__name", "organizer__name")

    fieldsets = (
        ("Basic info", {
            "fields": ("title", "description", "organizer", "venue", "event_type")
        }),
        ("Schedule & Capacity", {
            "fields": ("start_time", "end_time", "capacity", "status")
        }),
        ("Pricing", {
            "fields": ("ticket_price",),
        }),
    )


==================================================
FILE: ./backend/events/tests.py
==================================================

from django.test import TestCase

# Create your tests here.


==================================================
FILE: ./backend/events/urls.py
==================================================

from django.urls import path
from . import views

urlpatterns = [
    # Public event pages
    path("", views.event_list, name="event_list"),
    path("<int:event_id>/", views.event_detail, name="event_detail"),

    # Organizer dashboard
    path("manage/", views.manage_events, name="manage_events"),
    path("manage/events/new/", views.event_create, name="event_create"),
    path("manage/events/<int:event_id>/edit/", views.event_edit, name="event_edit"),
    path("manage/venues/new/", views.venue_create, name="venue_create"),

    # Organizer analytics
    path("manage/analytics/", views.organizer_analytics, name="organizer_analytics"),
    
    path("analytics/", views.organizer_analytics, name="analytics_dashboard"),

]


==================================================
FILE: ./backend/events/views.py
==================================================

from datetime import timedelta
from django.contrib import messages
from django.contrib.auth.decorators import login_required
from django.shortcuts import get_object_or_404, redirect, render
from django.utils import timezone
from django.db.models import Count, Sum
from django.db.models.functions import TruncMonth

from .models import Event, Venue, Organizer
from .forms import EventForm, OrganizerEventForm, OrganizerVenueForm
from accounts.models import UserProfile
from bookings.models import Booking, Payment


# ---------- Public event views ----------

def event_list(request):
    """
    Public page: list all published upcoming events.

    Only show events whose organizer is APPROVED.
    """
    now = timezone.now()
    events = (
        Event.objects
        .select_related("venue", "organizer")
        .filter(
            status="PUBLISHED",
            start_time__gte=now,
            organizer__status="APPROVED",   # 👈 only approved organizers
        )
        .order_by("start_time")
    )

    return render(
        request,
        "events/event_list.html",
        {"events": events},
    )


def event_detail(request, event_id):
    """
    Public page: detail view for a single event.
    """
    event = get_object_or_404(
        Event.objects.select_related("venue", "organizer"),
        pk=event_id,
    )

    return render(
        request,
        "events/event_detail.html",
        {"event": event},
    )


# ---------- Helpers to get organizer for current user ----------

def _get_profile_and_organizer(request):
    """
    Return (UserProfile or None, Organizer or None) for the logged-in user.
    Does NOT enforce any status; views can check organizer.status.
    """
    try:
        profile = request.user.userprofile
    except UserProfile.DoesNotExist:
        return None, None

    return profile, profile.organizer


def _get_user_organizer(request):
    """
    Backwards-compatible helper:
    returns the Organizer ONLY if it exists AND is APPROVED,
    otherwise returns None.
    """
    profile, organizer = _get_profile_and_organizer(request)
    if organizer and getattr(organizer, "status", None) == "APPROVED":
        return organizer
    return None


def _ensure_approved_organizer(request, context_redirect_name="accounts:profile"):
    """
    Shared check used by organizer-only views.

    Returns:
        (organizer or None, redirect_response or None)

    - If user has NO organizer -> redirect to become_organizer.
    - If organizer exists but status != APPROVED -> redirect to profile (or given view)
      with a clear message.
    - If organizer is APPROVED -> (organizer, None)
    """
    profile, organizer = _get_profile_and_organizer(request)

    # Not an organizer at all: send to become_organizer flow
    if not organizer:
        messages.error(
            request,
            "Only organizers can access this section. "
            "Please submit the 'Become an organizer' form first."
        )
        return None, redirect("accounts:become_organizer")

    # Organizer exists but not approved
    status = getattr(organizer, "status", None)
    if status != "APPROVED":
        if status == "PENDING":
            messages.warning(
                request,
                "Your organizer account is pending admin approval. "
                "You will be able to manage events once it is approved."
            )
        elif status == "REJECTED":
            messages.error(
                request,
                "Your organizer request has been rejected. "
                "Please contact the administrator for more information."
            )
        else:
            messages.error(
                request,
                "Your organizer account is not approved. "
                "Please contact the administrator."
            )
        return None, redirect(context_redirect_name)

    # Approved organizer
    return organizer, None


# ---------- Organizer dashboard views ----------

@login_required
def manage_events(request):
    """
    Organizer dashboard home:
    - list events belonging to this organizer
    - small stats section in the template (count, upcoming, etc.)
    """
    organizer, redirect_response = _ensure_approved_organizer(request)
    if redirect_response:
        return redirect_response

    events = (
        Event.objects
        .filter(organizer=organizer)
        .select_related("venue")
        .order_by("start_time")
    )

    venues = (
        Venue.objects.filter(events__organizer=organizer)
        .distinct()
        .order_by("name")
    )

    now = timezone.now()
    total_events = events.count()
    upcoming_events = events.filter(start_time__gte=now, status="PUBLISHED").count()
    draft_events = events.filter(status="DRAFT").count()

    context = {
        "organizer": organizer,
        "events": events,
        "venues": venues,
        "total_events": total_events,
        "upcoming_events": upcoming_events,
        "draft_events": draft_events,
    }
    return render(request, "events/manage_events.html", context)


@login_required
def event_create(request):
    """
    Organizer: create a new event from the dashboard.
    """
    organizer, redirect_response = _ensure_approved_organizer(request)
    if redirect_response:
        return redirect_response

    if request.method == "POST":
        form = EventForm(request.POST)
        if form.is_valid():
            event = form.save(commit=False)
            event.organizer = organizer
            event.save()
            messages.success(request, f"Event '{event.title}' created successfully.")
            return redirect("events:manage_events")
    else:
        form = EventForm()

    return render(
        request,
        "events/event_form.html",
        {
            "form": form,
            "mode": "create",
        },
    )


@login_required
def event_edit(request, event_id):
    """
    Organizer: edit an existing event they own.
    """
    organizer, redirect_response = _ensure_approved_organizer(request)
    if redirect_response:
        return redirect_response

    event = get_object_or_404(Event, pk=event_id)

    if event.organizer != organizer:
        messages.error(request, "You do not have permission to edit this event.")
        return redirect("events:manage_events")

    if request.method == "POST":
        form = EventForm(request.POST, instance=event)
        if form.is_valid():
            form.save()
            messages.success(request, f"Event '{event.title}' updated successfully.")
            return redirect("events:manage_events")
    else:
        form = EventForm(instance=event)

    return render(
        request,
        "events/event_form.html",
        {
            "form": form,
            "mode": "edit",
            "event": event,
        },
    )


@login_required
def venue_create(request):
    """
    Organizer: create a new venue from the dashboard.
    (We keep it simple: any APPROVED organizer can create venues.)
    """
    organizer, redirect_response = _ensure_approved_organizer(request)
    if redirect_response:
        return redirect_response

    if request.method == "POST":
        form = OrganizerVenueForm(request.POST)
        if form.is_valid():
            venue = form.save()
            messages.success(request, f"Venue '{venue.name}' created successfully.")
            # After creating a venue, send them to create an event using it
            return redirect("events:event_create")
    else:
        form = OrganizerVenueForm()

    return render(
        request,
        "events/venue_form.html",
        {"form": form},
    )


# ---------- Organizer analytics dashboard ----------

@login_required
def organizer_analytics(request):
    """
    Analytics dashboard for an organizer:
    - summary KPIs (bookings, tickets, revenue)
    - per-event breakdown
    - simple month-by-month trend for the last 6 months
    """
    organizer, redirect_response = _ensure_approved_organizer(request)
    if redirect_response:
        return redirect_response

    now = timezone.now()

    # Events owned by this organizer
    events_qs = Event.objects.filter(organizer=organizer)
    event_ids = list(events_qs.values_list("pk", flat=True))

    # All non-cancelled bookings for these events
    bookings_qs = (
        Booking.objects.filter(
            event_id__in=event_ids,
            status__in=["PENDING", "APPROVED"],
        )
        .select_related("event")
    )

    # Payments for these bookings (for revenue)
    payments_qs = Payment.objects.filter(booking__event_id__in=event_ids)

    # Summary metrics
    total_events = events_qs.count()
    upcoming_events = events_qs.filter(start_time__gte=now, status="PUBLISHED").count()
    total_bookings = bookings_qs.count()
    total_tickets = bookings_qs.aggregate(total=Sum("ticket_qty"))["total"] or 0
    total_revenue = payments_qs.aggregate(total=Sum("amount"))["total"] or 0

    # Per-event stats
    per_event = (
        bookings_qs.values("event__event_id", "event__title")
        .annotate(
            bookings=Count("booking_id"),
            tickets=Sum("ticket_qty"),
            revenue=Sum("total_price"),
        )
        .order_by("-tickets", "event__title")
    )

    # Month-by-month stats for the last 6 months
    six_months_ago = now - timedelta(days=180)
    monthly = (
        bookings_qs.filter(booked_at__gte=six_months_ago)
        .annotate(month=TruncMonth("booked_at"))
        .values("month")
        .annotate(
            bookings=Count("booking_id"),
            tickets=Sum("ticket_qty"),
            revenue=Sum("total_price"),
        )
        .order_by("month")
    )

    context = {
        "organizer": organizer,
        "total_events": total_events,
        "upcoming_events": upcoming_events,
        "total_bookings": total_bookings,
        "total_tickets": total_tickets,
        "total_revenue": total_revenue,
        "per_event": per_event,
        "monthly": monthly,
    }
    return render(request, "events/organizer_analytics.html", context)


==================================================
FILE: ./scripts/__init__.py
==================================================

