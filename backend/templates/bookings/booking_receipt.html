{% extends "base.html" %}

{% block title %}Booking Receipt | EMS{% endblock %}

{% block extra_head %}
<style>
  .hero-card {
    border-radius: 20px;
    padding: 22px 26px;
    background: linear-gradient(135deg, #6C63FF 0%, #00B4D8 100%);
    color: #fff;
    box-shadow: 0 10px 24px rgba(0,0,0,0.15);
  }

  .hero-title {
    font-size: 1.8rem;
    font-weight: 700;
  }

  .receipt-card {
    max-width: 720px;
    margin: 0 auto;
    border-radius: 16px;
    border: none;
    box-shadow: 0 10px 28px rgba(0,0,0,0.08);
  }

  .receipt-label {
    font-size: 0.8rem;
    text-transform: uppercase;
    letter-spacing: 0.08em;
    color: #6c757d;
  }

  .receipt-value {
    font-weight: 500;
  }

  @media print {
    nav, footer, .btn-print, .navbar, .alert {
      display: none !important;
    }
    body {
      background: #ffffff !important;
    }
    .receipt-card {
      box-shadow: none !important;
      border: 1px solid #dee2e6;
    }
  }
</style>
{% endblock %}

{% block content %}

<div class="hero-card mb-4">
  <div class="d-flex justify-content-between align-items-center">
    <div>
      <h1 class="hero-title mb-1">Booking Receipt</h1>
      <p class="mb-0">
        Confirmation for your reservation in
        <strong>{{ booking.event.title }}</strong>.
      </p>
    </div>
    <div class="text-end">
      <span class="badge bg-light text-dark">
        #{{ booking.booking_id }}
      </span>
      <div class="small mt-1">
        Booked on {{ booking.booked_at|date:"M d, Y 路 H:i" }}
      </div>
    </div>
  </div>
</div>

<div class="card receipt-card mb-4">
  <div class="card-body">
    {# Event info #}
    <div class="mb-3">
      <div class="receipt-label">Event</div>
      <div class="receipt-value">
        {{ booking.event.title }}
      </div>
      <div class="text-muted small">
        {{ booking.event.venue.name }}
        路 {{ booking.event.get_event_type_display }}<br>
        {% if booking.event.venue.address %}
          {{ booking.event.venue.address }}<br>
        {% endif %}
        {% if booking.event.venue.city or booking.event.venue.state or booking.event.venue.zipcode %}
          {% if booking.event.venue.city %}{{ booking.event.venue.city }}{% endif %}
          {% if booking.event.venue.city and booking.event.venue.state %}, {% endif %}
          {% if booking.event.venue.state %}{{ booking.event.venue.state }}{% endif %}
          {% if booking.event.venue.zipcode %} {{ booking.event.venue.zipcode }}{% endif %}<br>
        {% endif %}
        {% if booking.event.venue.country %}{{ booking.event.venue.country }}<br>{% endif %}
        {{ booking.event.start_time|date:"M d, Y 路 H:i" }}
      </div>
    </div>

    <hr>

    {# Participant info #}
    <div class="row mb-3">
      <div class="col-md-6">
        <div class="receipt-label">Participant</div>
        <div class="receipt-value">
          {{ booking.customer.name }}
        </div>
        <div class="text-muted small">
          {{ booking.customer.email }}<br>
          {% if booking.customer.phone %}
            {{ booking.customer.phone }}<br>
          {% endif %}
          {% if booking.customer.dob %}
            DOB: {{ booking.customer.dob|date:"M d, Y" }}<br>
          {% endif %}
          {% if booking.customer.address or booking.customer.city or booking.customer.state
                or booking.customer.zipcode or booking.customer.country %}
            {% if booking.customer.address %}{{ booking.customer.address }}<br>{% endif %}
            {% if booking.customer.city or booking.customer.state or booking.customer.zipcode %}
              {% if booking.customer.city %}{{ booking.customer.city }}{% endif %}
              {% if booking.customer.city and booking.customer.state %}, {% endif %}
              {% if booking.customer.state %}{{ booking.customer.state }}{% endif %}
              {% if booking.customer.zipcode %} {{ booking.customer.zipcode }}{% endif %}<br>
            {% endif %}
            {% if booking.customer.country %}{{ booking.customer.country }}{% endif %}
          {% endif %}
        </div>
      </div>
      <div class="col-md-6 mt-3 mt-md-0">
        <div class="receipt-label">Booking status</div>
        <div class="receipt-value">
          {{ booking.status }}
        </div>
        <div class="text-muted small">
          Tickets: {{ booking.ticket_qty }}
        </div>
      </div>
    </div>

    <hr>

    {# Payment info #}
    <div class="row mb-3">
      <div class="col-md-6">
        <div class="receipt-label">Ticket price</div>
        <div class="receipt-value">
          {% if booking.unit_price and booking.unit_price > 0 %}
            ${{ booking.unit_price }}
          {% else %}
            Free
          {% endif %}
        </div>
      </div>
      <div class="col-md-6 mt-3 mt-md-0">
        <div class="receipt-label">Total amount</div>
        <div class="receipt-value">
          {% if booking.total_price and booking.total_price > 0 %}
            ${{ booking.total_price }}
          {% else %}
            Free
          {% endif %}
        </div>
      </div>
    </div>

    {% if payment %}
      <div class="row mb-3">
        <div class="col-md-6">
          <div class="receipt-label">Payment method</div>
          <div class="receipt-value">
            {{ payment.get_method_display }}
          </div>
          {% if payment.card_details %}
            <div class="text-muted small">
              {{ payment.card_details }}
            </div>
          {% endif %}
        </div>
        <div class="col-md-6 mt-3 mt-md-0">
          <div class="receipt-label">Paid at</div>
          <div class="receipt-value">
            {{ payment.paid_at|date:"M d, Y 路 H:i" }}
          </div>
        </div>
      </div>
    {% endif %}

    <hr>

    <div class="small text-muted">
      This receipt confirms your booking in the Event Management System.
      Please keep it for your records or bring a printed copy when attending
      the event.
    </div>
  </div>

  <div class="card-footer d-flex justify-content-between">
    <a href="{% url 'bookings:my_bookings' %}" class="btn btn-outline-secondary btn-sm">
      Back to my bookings
    </a>
    <button type="button" class="btn btn-primary btn-sm btn-print"
            onclick="window.print()">
      Print receipt
    </button>
  </div>
</div>

{% endblock %}
